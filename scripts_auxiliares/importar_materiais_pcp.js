// Script para buscar materiais do PCP e importar para compras_materiaisrequire('dotenv').config();const mysql = require('mysql2/promise');async function buscarEImportarMateriais() {    const conn = await mysql.createConnection({        host: process.env.DB_HOST,        port: process.env.DB_PORT || 3306,        user: process.env.DB_USER,        password: process.env.DB_PASSWORD,        database: process.env.DB_NAME,        charset: 'utf8mb4'    });    try {        await conn.query('SET NAMES utf8mb4');        // Buscar materiais do PCP com termos espec√≠ficos        console.log('üîç Buscando materiais do PCP...');                const [materiais] = await conn.query(`            SELECT DISTINCT                 codigo_material as codigo,                descricao,                unidade_medida as unidade,                quantidade_estoque as estoque_atual,                custo_unitario,                ncm,                cest,                gtin as codigo_barras,                tipo,                ativo            FROM materiais             WHERE (                LOWER(descricao) LIKE '%veia%' OR                 LOWER(descricao) LIKE '%polietileno%' OR                 LOWER(descricao) LIKE '%corda%' OR                 LOWER(descricao) LIKE '%pvc%' OR                 LOWER(descricao) LIKE '%filamento%' OR                LOWER(descricao) LIKE '%multiplex%' OR                LOWER(descricao) LIKE '%fita%' OR                LOWER(descricao) LIKE '%cabo%' OR                LOWER(descricao) LIKE '%parafuso%' OR                LOWER(descricao) LIKE '%bucha%' OR                LOWER(descricao) LIKE '%borracha%' OR                LOWER(descricao) LIKE '%silicone%' OR                LOWER(descricao) LIKE '%cola%' OR                LOWER(descricao) LIKE '%lixa%' OR                LOWER(descricao) LIKE '%disco%' OR                LOWER(descricao) LIKE '%broca%' OR                LOWER(descricao) LIKE '%serra%' OR                LOWER(descricao) LIKE '%solda%' OR                LOWER(descricao) LIKE '%tinta%' OR                LOWER(descricao) LIKE '%primer%' OR                LOWER(descricao) LIKE '%verniz%' OR                LOWER(descricao) LIKE '%thinner%' OR                LOWER(descricao) LIKE '%massa%' OR                LOWER(descricao) LIKE '%espuma%' OR                LOWER(descricao) LIKE '%vedante%' OR                LOWER(descricao) LIKE '%selante%' OR                LOWER(descricao) LIKE '%graxa%' OR                LOWER(descricao) LIKE '%oleo%' OR                LOWER(descricao) LIKE '%lubrificante%' OR                LOWER(descricao) LIKE '%rebite%' OR                LOWER(descricao) LIKE '%porca%' OR                LOWER(descricao) LIKE '%arruela%' OR                LOWER(descricao) LIKE '%chapa%' OR                LOWER(descricao) LIKE '%perfil%' OR                LOWER(descricao) LIKE '%tubo%' OR                LOWER(descricao) LIKE '%cantoneira%' OR                LOWER(descricao) LIKE '%rolamento%' OR                LOWER(descricao) LIKE '%mola%'            )            AND ativo = 1            ORDER BY descricao            LIMIT 200        `);        console.log(`üì¶ Encontrados ${materiais.length} materiais no PCP:`);                // Mostrar amostra        materiais.slice(0, 20).forEach(m => {            console.log(`  - ${m.codigo}: ${m.descricao} [${m.unidade}]`);        });        if (materiais.length > 20) {            console.log(`  ... e mais ${materiais.length - 20} materiais`);        }        // Verificar quais j√° existem em compras_materiais        const [existentes] = await conn.query('SELECT codigo FROM compras_materiais');        const codigosExistentes = new Set(existentes.map(e => e.codigo));        // Filtrar apenas os novos        const novos = materiais.filter(m => !codigosExistentes.has(m.codigo));        console.log(`‚ú® ${novos.length} materiais novos para importar (${materiais.length - novos.length} j√° existem)`);        if (novos.length === 0) {            console.log('Nenhum material novo para importar.');            await conn.end();            return;        }        // Determinar categoria baseado na descri√ß√£o        function determinarCategoria(descricao) {            const desc = descricao.toLowerCase();            if (desc.includes('veia') || desc.includes('cabo') || desc.includes('fio') || desc.includes('multiplex')) return 'Cabos e Fios';            if (desc.includes('polietileno') || desc.includes('pvc') || desc.includes('plastico')) return 'Pl√°sticos';            if (desc.includes('corda') || desc.includes('filamento')) return 'Cordas e Fios';            if (desc.includes('parafuso') || desc.includes('bucha') || desc.includes('porca') || desc.includes('arruela') || desc.includes('rebite')) return 'Fixa√ß√£o';            if (desc.includes('borracha') || desc.includes('vedante') || desc.includes('selante')) return 'Borrachas';            if (desc.includes('silicone') || desc.includes('cola') || desc.includes('adesivo')) return 'Adesivos';            if (desc.includes('lixa') || desc.includes('disco') || desc.includes('broca') || desc.includes('serra')) return 'Ferramentas';            if (desc.includes('solda')) return 'Soldagem';            if (desc.includes('tinta') || desc.includes('primer') || desc.includes('verniz') || desc.includes('thinner')) return 'Pintura';            if (desc.includes('graxa') || desc.includes('oleo') || desc.includes('lubrificante')) return 'Lubrificantes';            if (desc.includes('chapa') || desc.includes('perfil') || desc.includes('tubo') || desc.includes('cantoneira')) return 'Mat√©ria Prima';            if (desc.includes('rolamento') || desc.includes('mola')) return 'Componentes';            if (desc.includes('massa') || desc.includes('espuma')) return 'Qu√≠micos';            if (desc.includes('fita')) return 'Embalagens';            return 'Geral';        }        // Inserir novos materiais        console.log('üì• Importando materiais...');        let importados = 0;        let erros = 0;        for (const m of novos) {            try {                const categoria = determinarCategoria(m.descricao);                await conn.query(`                    INSERT INTO compras_materiais (                        codigo, descricao, categoria, unidade,                         estoque_atual, estoque_min, estoque_max,                        ultimo_preco, ncm, cest, codigo_barras, ativo, sinc_pcp                    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 1, 1)                `, [                    m.codigo,                    m.descricao,                    categoria,                    m.unidade || 'UN',                    m.estoque_atual || 0,                    5, // estoque_min padr√£o                    100, // estoque_max padr√£o                    m.custo_unitario || 0,                    m.ncm || null,                    m.cest || null,                    m.codigo_barras || null                ]);                importados++;            } catch (err) {                if (!err.message.includes('Duplicate')) {                    console.log(`  ‚ö†Ô∏è Erro ao importar ${m.codigo}: ${err.message}`);                }                erros++;            }        }        console.log(`‚úÖ Importa√ß√£o conclu√≠da: ${importados} materiais importados, ${erros} erros/duplicados`);        // Mostrar total atualizado        const [total] = await conn.query('SELECT COUNT(*) as total FROM compras_materiais');        console.log(`üìä Total de materiais em compras_materiais: ${total[0].total}`);    } catch (error) {        console.error('‚ùå Erro:', error.message);    } finally {        await conn.end();    }}buscarEImportarMateriais();