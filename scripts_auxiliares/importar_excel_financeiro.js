const mysql = require('mysql2/promise');const XLSX = require('xlsx');async function importarDados() {    const conn = await mysql.createConnection({        host: 'interchange.proxy.rlwy.net',        port: 19396,        user: 'root',        password: 'iiilOZutDOnPCwxgiTKeMuEaIzSwplcu',        database: 'railway'    });    try {        console.log('=== IMPORTANDO CONTAS CORRENTES ===');                // Ler Excel de contas correntes        const wbContas = XLSX.readFile('ordens-emitidas/Contas Correntes/Contas Correntes.xlsx');        const sheetContas = wbContas.Sheets[wbContas.SheetNames[0]];        const dadosContas = XLSX.utils.sheet_to_json(sheetContas, { header: 1 });                // Pular cabeçalho (3 primeiras linhas)        let contasImportadas = 0;        for (let i = 3; i < dadosContas.length; i++) {            const row = dadosContas[i];            if (!row || !row[1]) continue; // Pular linhas vazias                        const situacao = row[0] || 'Ativo';            const nomeConta = row[1];            const instituicao = row[2] || '';            const tipoConta = row[3] || 'Conta Corrente';            const agencia = row[4] || '';            const contaCorrente = row[5] || '';            const saldoInicial = parseFloat(row[6]) || 0;                        // Mapear código do banco baseado no nome            let codigoBanco = 'outros';            const inst = (instituicao || '').toLowerCase();            if (inst.includes('itaú') || inst.includes('itau')) codigoBanco = 'itau';            else if (inst.includes('bradesco')) codigoBanco = 'bradesco';            else if (inst.includes('santander')) codigoBanco = 'santander';            else if (inst.includes('caixa')) codigoBanco = 'caixa';            else if (inst.includes('brasil') || inst.includes('bb')) codigoBanco = 'bb';            else if (inst.includes('nubank')) codigoBanco = 'nubank';            else if (inst.includes('inter')) codigoBanco = 'inter';            else if (inst.includes('sicoob')) codigoBanco = 'sicoob';            else if (inst.includes('sicredi')) codigoBanco = 'sicredi';                        // Verificar se já existe            const [existing] = await conn.execute(                'SELECT id FROM contas_bancarias WHERE nome = ? OR (agencia = ? AND conta = ? AND agencia != "")',                [nomeConta, agencia, contaCorrente]            );                        if (existing.length === 0) {                await conn.execute(`                    INSERT INTO contas_bancarias (nome, banco, agencia, conta, tipo, saldo_atual, saldo_inicial, ativo, created_at, updated_at)                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, NOW(), NOW())                `, [                    nomeConta,                    instituicao || 'Outros',                    agencia,                    contaCorrente,                    tipoConta,                    saldoInicial,                    saldoInicial,                    situacao === 'Ativo' ? 1 : 0                ]);                contasImportadas++;                console.log(`✅ Conta importada: ${nomeConta}`);            } else {                console.log(`⏭️ Conta já existe: ${nomeConta}`);            }        }                console.log(`✅ Total contas importadas: ${contasImportadas}`);                console.log('=== IMPORTANDO MOVIMENTAÇÕES ===');                // Ler Excel de movimentações        const wbMov = XLSX.readFile('ordens-emitidas/Movimentação da Conta Corrente/Movimentação da Conta Corrente.xlsx');        const sheetMov = wbMov.Sheets[wbMov.SheetNames[0]];        const dadosMov = XLSX.utils.sheet_to_json(sheetMov, { header: 1 });                // Buscar contas para mapear IDs        const [contasBancarias] = await conn.execute('SELECT id, nome FROM contas_bancarias');        const contasMap = {};        contasBancarias.forEach(c => {            contasMap[c.nome.toLowerCase()] = c.id;        });                // Pular cabeçalho (3 primeiras linhas)        let movsImportadas = 0;        for (let i = 3; i < Math.min(dadosMov.length, 1000); i++) {            const row = dadosMov[i];            if (!row || !row[1]) continue;                        // Converter data Excel para JS            let dataExcel = row[1];            let dataJS;            if (typeof dataExcel === 'number') {                // Excel armazena datas como número de dias desde 1/1/1900                dataJS = new Date((dataExcel - 25569) * 86400 * 1000);            } else {                dataJS = new Date(dataExcel);            }                        if (isNaN(dataJS.getTime())) {                continue; // Pular datas inválidas            }                        const dataStr = dataJS.toISOString().split('T')[0];            const clienteFornecedor = row[2] || '';            const contaNome = row[3] || '';            const categoria = row[4] || '';            const valor = parseFloat(row[5]) || 0;            const saldo = parseFloat(row[6]) || 0;            const saldoPrevisto = parseFloat(row[7]) || 0;            const tipoDoc = row[9] || '';            const documento = row[10] || '';            const notaFiscal = row[11] || '';            const parcela = row[12] || '';            const origem = row[14] || '';            const pedidoId = parseInt(row[15]) || null;            const vendedor = row[16] || '';                        // Determinar tipo (entrada ou saída)            const tipo = origem.toLowerCase().includes('receber') ? 'entrada' : 'saida';                        // Buscar conta bancária            const bancoId = contasMap[contaNome.toLowerCase()] || null;                        // Inserir movimentação            try {                await conn.execute(`                    INSERT INTO movimentacoes_bancarias                     (banco_id, tipo, valor, categoria, data, tipo_documento, numero_documento, nota_fiscal, parcela, origem, pedido_id, vendedor, cliente_fornecedor, saldo, saldo_previsto, created_at)                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, NOW())                `, [                    bancoId,                    tipo,                    Math.abs(valor),                    categoria,                    dataStr,                    tipoDoc,                    documento,                    notaFiscal,                    parcela,                    origem,                    pedidoId,                    vendedor,                    clienteFornecedor,                    saldo,                    saldoPrevisto                ]);                movsImportadas++;            } catch (err) {                console.log(`❌ Erro ao importar movimentação linha ${i}: ${err.message}`);            }        }                console.log(`✅ Total movimentações importadas: ${movsImportadas}`);            } catch (error) {        console.error('Erro:', error.message);    } finally {        await conn.end();    }}importarDados();