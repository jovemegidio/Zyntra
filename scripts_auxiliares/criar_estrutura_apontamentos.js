const mysql = require('mysql2/promise');async function main() {    const conn = await mysql.createConnection({        host: 'localhost',        user: 'root',        password: '@dminalu',        database: 'aluforce_vendas'    });        console.log('ðŸ”§ Criando estrutura para apontamentos de produÃ§Ã£o...');    // Criar tabela de etapas de produÃ§Ã£o    await conn.query(`        CREATE TABLE IF NOT EXISTS etapas_producao (            id INT AUTO_INCREMENT PRIMARY KEY,            ordem_producao_id INT NOT NULL,            nome VARCHAR(100) NOT NULL,            sequencia INT DEFAULT 1,            status ENUM('pendente','em_andamento','concluida','pausada') DEFAULT 'pendente',            quantidade_prevista DECIMAL(10,2) DEFAULT 0,            quantidade_produzida DECIMAL(10,2) DEFAULT 0,            tempo_previsto_min INT DEFAULT 0,            tempo_real_min INT DEFAULT 0,            operador_id INT NULL,            operador_nome VARCHAR(100),            maquina VARCHAR(100),            data_inicio DATETIME NULL,            data_fim DATETIME NULL,            observacoes TEXT,            created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,            updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,            FOREIGN KEY (ordem_producao_id) REFERENCES ordens_producao(id) ON DELETE CASCADE        )    `);    console.log('âœ… Tabela etapas_producao criada');    // Adicionar coluna etapa_id na tabela de apontamentos se nÃ£o existir    try {        await conn.query('ALTER TABLE apontamentos_producao ADD COLUMN etapa_id INT NULL AFTER ordem_producao_id');        console.log('âœ… Coluna etapa_id adicionada em apontamentos_producao');    } catch(e) {        if (!e.message.includes('Duplicate')) throw e;        console.log('â­ï¸ Coluna etapa_id jÃ¡ existe');    }    // Adicionar coluna usuario_id    try {        await conn.query('ALTER TABLE apontamentos_producao ADD COLUMN usuario_id INT NULL AFTER operador');        console.log('âœ… Coluna usuario_id adicionada');    } catch(e) {        if (!e.message.includes('Duplicate')) throw e;        console.log('â­ï¸ Coluna usuario_id jÃ¡ existe');    }    // Criar etapas padrÃ£o para OPs existentes que nÃ£o tÃªm etapas    const [ops] = await conn.query(`        SELECT op.id, op.codigo         FROM ordens_producao op         LEFT JOIN etapas_producao ep ON ep.ordem_producao_id = op.id         WHERE ep.id IS NULL    `);    if (ops.length > 0) {        console.log(`ðŸ“‹ Criando etapas padrÃ£o para ${ops.length} OPs...`);                const etapasPadrao = [            { nome: 'Corte', sequencia: 1 },            { nome: 'PreparaÃ§Ã£o', sequencia: 2 },            { nome: 'Montagem', sequencia: 3 },            { nome: 'Acabamento', sequencia: 4 },            { nome: 'InspeÃ§Ã£o', sequencia: 5 }        ];        for (const op of ops) {            for (const etapa of etapasPadrao) {                await conn.query(                    'INSERT INTO etapas_producao (ordem_producao_id, nome, sequencia) VALUES (?, ?, ?)',                    [op.id, etapa.nome, etapa.sequencia]                );            }        }        console.log(`âœ… Etapas criadas para ${ops.length} OPs`);    }    await conn.end();    console.log('âœ… Estrutura de apontamentos pronta!');}main().catch(console.error);