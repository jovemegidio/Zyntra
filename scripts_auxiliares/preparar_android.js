/** * ALUFORCE - Script de PreparaÃ§Ã£o do APK Android *  * Este script prepara todos os recursos necessÃ¡rios para o app Android: * - Copia Ã­cones para as pastas corretas * - Gera splash screens * - Atualiza configuraÃ§Ãµes */const fs = require('fs');const path = require('path');const sharp = require('sharp');// DiretÃ³riosconst ROOT_DIR = __dirname;const PUBLIC_DIR = path.join(ROOT_DIR, 'public');const ANDROID_RES = path.join(ROOT_DIR, 'android', 'app', 'src', 'main', 'res');const ICONS_DIR = path.join(PUBLIC_DIR, 'icons');// ConfiguraÃ§Ãµes de Ã­cones Androidconst ICON_SIZES = {    'mipmap-mdpi': 48,    'mipmap-hdpi': 72,    'mipmap-xhdpi': 96,    'mipmap-xxhdpi': 144,    'mipmap-xxxhdpi': 192};// ConfiguraÃ§Ãµes de splash screensconst SPLASH_SIZES = {    'drawable-port-mdpi': { width: 320, height: 480 },    'drawable-port-hdpi': { width: 480, height: 800 },    'drawable-port-xhdpi': { width: 720, height: 1280 },    'drawable-port-xxhdpi': { width: 1080, height: 1920 },    'drawable-port-xxxhdpi': { width: 1440, height: 2560 },    'drawable-land-mdpi': { width: 480, height: 320 },    'drawable-land-hdpi': { width: 800, height: 480 },    'drawable-land-xhdpi': { width: 1280, height: 720 },    'drawable-land-xxhdpi': { width: 1920, height: 1080 },    'drawable-land-xxxhdpi': { width: 2560, height: 1440 }};// Cores do temaconst THEME_COLOR = '#1a2744';const LOGO_COLOR = '#ffffff';async function generateIcons() {    console.log('ğŸ“± Gerando Ã­cones do app...');        // Usa o Ã­cone 512x512 como base    const sourceIcon = path.join(ICONS_DIR, 'icon-512x512.png');        if (!fs.existsSync(sourceIcon)) {        console.log('âš ï¸  Ãcone fonte nÃ£o encontrado. Gerando Ã­cone padrÃ£o...');        await createDefaultIcon(sourceIcon);    }        for (const [folder, size] of Object.entries(ICON_SIZES)) {        const outputDir = path.join(ANDROID_RES, folder);                if (!fs.existsSync(outputDir)) {            fs.mkdirSync(outputDir, { recursive: true });        }                // Ãcone normal        await sharp(sourceIcon)            .resize(size, size)            .png()            .toFile(path.join(outputDir, 'ic_launcher.png'));                // Ãcone arredondado        await sharp(sourceIcon)            .resize(size, size)            .png()            .toFile(path.join(outputDir, 'ic_launcher_round.png'));                // Foreground para Ã­cones adaptativos        const foregroundSize = Math.round(size * 1.5);        await sharp(sourceIcon)            .resize(Math.round(size * 0.7), Math.round(size * 0.7))            .extend({                top: Math.round(foregroundSize * 0.21),                bottom: Math.round(foregroundSize * 0.29),                left: Math.round(foregroundSize * 0.21),                right: Math.round(foregroundSize * 0.29),                background: { r: 0, g: 0, b: 0, alpha: 0 }            })            .resize(foregroundSize, foregroundSize)            .png()            .toFile(path.join(outputDir, 'ic_launcher_foreground.png'));                console.log(`  âœ“ ${folder}: ${size}x${size}px`);    }        console.log('âœ… Ãcones gerados com sucesso!');}async function generateSplashScreens() {    console.log('ğŸ–¼ï¸  Gerando splash screens...');        const logoPath = path.join(PUBLIC_DIR, 'icons', 'icon-512x512.png');        for (const [folder, dimensions] of Object.entries(SPLASH_SIZES)) {        const outputDir = path.join(ANDROID_RES, folder);                if (!fs.existsSync(outputDir)) {            fs.mkdirSync(outputDir, { recursive: true });        }                const { width, height } = dimensions;        const logoSize = Math.min(width, height) * 0.3;                // Cria imagem de fundo com a cor do tema        const background = await sharp({            create: {                width: width,                height: height,                channels: 4,                background: { r: 26, g: 39, b: 68, alpha: 1 } // #1a2744            }        }).png().toBuffer();                // Redimensiona o logo        const logo = await sharp(logoPath)            .resize(Math.round(logoSize), Math.round(logoSize))            .toBuffer();                // CompÃµe a imagem final        await sharp(background)            .composite([{                input: logo,                gravity: 'center'            }])            .png()            .toFile(path.join(outputDir, 'splash.png'));                console.log(`  âœ“ ${folder}: ${width}x${height}px`);    }        // Splash padrÃ£o na pasta drawable    const defaultSplashDir = path.join(ANDROID_RES, 'drawable');    if (!fs.existsSync(defaultSplashDir)) {        fs.mkdirSync(defaultSplashDir, { recursive: true });    }        await sharp({        create: {            width: 1080,            height: 1920,            channels: 4,            background: { r: 26, g: 39, b: 68, alpha: 1 }        }    })    .composite([{        input: await sharp(logoPath).resize(324, 324).toBuffer(),        gravity: 'center'    }])    .png()    .toFile(path.join(defaultSplashDir, 'splash.png'));        console.log('âœ… Splash screens gerados com sucesso!');}async function createDefaultIcon(outputPath) {    const size = 512;        // Cria um Ã­cone padrÃ£o se nÃ£o existir    await sharp({        create: {            width: size,            height: size,            channels: 4,            background: { r: 26, g: 39, b: 68, alpha: 1 }        }    })    .png()    .toFile(outputPath);        console.log('âœ“ Ãcone padrÃ£o criado');}async function updateAndroidStrings() {    console.log('ğŸ“ Atualizando strings do Android...');        const stringsPath = path.join(ANDROID_RES, 'values', 'strings.xml');        const stringsContent = `<?xml version="1.0" encoding="utf-8"?><resources>    <string name="app_name">ALUFORCE</string>    <string name="title_activity_main">ALUFORCE</string>    <string name="package_name">com.aluforce.sistema</string>    <string name="custom_url_scheme">com.aluforce.sistema</string></resources>`;        fs.writeFileSync(stringsPath, stringsContent);    console.log('âœ“ strings.xml atualizado');}async function updateAndroidColors() {    console.log('ğŸ¨ Atualizando cores do Android...');        const colorsPath = path.join(ANDROID_RES, 'values', 'colors.xml');        const colorsContent = `<?xml version="1.0" encoding="utf-8"?><resources>    <color name="colorPrimary">#1a2744</color>    <color name="colorPrimaryDark">#121c30</color>    <color name="colorAccent">#4a90d9</color>    <color name="splashBackground">#1a2744</color>    <color name="white">#FFFFFF</color>    <color name="black">#000000</color></resources>`;        fs.writeFileSync(colorsPath, colorsContent);    console.log('âœ“ colors.xml atualizado');}async function createAdaptiveIcon() {    console.log('ğŸ¯ Criando Ã­cone adaptativo...');        const drawableDir = path.join(ANDROID_RES, 'drawable');    const mipmapAnydpiDir = path.join(ANDROID_RES, 'mipmap-anydpi-v26');        // Background do Ã­cone adaptativo    const backgroundXml = `<?xml version="1.0" encoding="utf-8"?><shape xmlns:android="http://schemas.android.com/apk/res/android">    <solid android:color="#1a2744"/></shape>`;        // ic_launcher para Android 8.0+ (v26)    const adaptiveIconXml = `<?xml version="1.0" encoding="utf-8"?><adaptive-icon xmlns:android="http://schemas.android.com/apk/res/android">    <background android:drawable="@drawable/ic_launcher_background"/>    <foreground android:drawable="@mipmap/ic_launcher_foreground"/></adaptive-icon>`;        if (!fs.existsSync(drawableDir)) fs.mkdirSync(drawableDir, { recursive: true });    if (!fs.existsSync(mipmapAnydpiDir)) fs.mkdirSync(mipmapAnydpiDir, { recursive: true });        // Background na pasta drawable    fs.writeFileSync(path.join(drawableDir, 'ic_launcher_background.xml'), backgroundXml);        // Remove arquivos XML incorretos da drawable-v24 (se existirem)    const drawableV24Dir = path.join(ANDROID_RES, 'drawable-v24');    const badFile = path.join(drawableV24Dir, 'ic_launcher_foreground.xml');    if (fs.existsSync(badFile)) {        fs.unlinkSync(badFile);        console.log('âœ“ Removido arquivo incorreto de drawable-v24');    }        // Adaptive icon na pasta mipmap-anydpi-v26 (correto para API 26+)    fs.writeFileSync(path.join(mipmapAnydpiDir, 'ic_launcher.xml'), adaptiveIconXml);    fs.writeFileSync(path.join(mipmapAnydpiDir, 'ic_launcher_round.xml'), adaptiveIconXml);        console.log('âœ“ Ãcone adaptativo configurado');}async function main() {    console.log('');    console.log('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');    console.log('â•‘        ğŸš€ ALUFORCE - PREPARAÃ‡ÃO DO APK ANDROID                   â•‘');    console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');    console.log('');        try {        await generateIcons();        await generateSplashScreens();        await updateAndroidStrings();        await updateAndroidColors();        await createAdaptiveIcon();                console.log('â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—');        console.log('â•‘  âœ… PREPARAÃ‡ÃO CONCLUÃDA COM SUCESSO!                            â•‘');        console.log('â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£');        console.log('â•‘  PrÃ³ximos passos:                                                â•‘');        console.log('â•‘  1. Execute: npx cap sync android                               â•‘');        console.log('â•‘  2. Execute: BUILD_APK_ANDROID.bat                              â•‘');        console.log('â•‘  3. Ou abra o Android Studio e faÃ§a o build manual              â•‘');        console.log('â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');            } catch (error) {        console.error('âŒ Erro durante a preparaÃ§Ã£o:', error.message);        process.exit(1);    }}main();