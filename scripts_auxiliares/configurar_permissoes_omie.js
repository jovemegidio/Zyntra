/** * Script para configurar permissÃµes dos usuÃ¡rios baseado no Omie ERP * ALUFORCE - Janeiro 2026 */const mysql = require('mysql2/promise');async function configurarPermissoes() {    const conn = await mysql.createConnection({        host: 'interchange.proxy.rlwy.net',        port: 19396,        user: 'root',        password: 'iiilOZutDOnPCwxgiTKeMuEaIzSwplcu',        database: 'railway'    });    console.log('ğŸ”§ Configurando permissÃµes de usuÃ¡rios baseado no Omie ERP...');    // DefiniÃ§Ã£o de permissÃµes por perfil    const perfis = {        // Administradores - Acesso total (is_admin=1)        admin: {            is_admin: 1,            areas: ['rh', 'vendas', 'pcp', 'compras', 'financeiro', 'nfe', 'ti'],            descricao: 'Acesso total ao sistema'        },                // Clemerson - RH (pÃ¡gina funcionÃ¡rio), PCP, Vendas        clemerson: {            is_admin: 0,            areas: ['rh', 'pcp', 'vendas'],            descricao: 'Acesso a RH (funcionÃ¡rio), PCP e Vendas'        },                // Junior - RH (pÃ¡gina funcionÃ¡rio), Financeiro        junior: {            is_admin: 0,            areas: ['rh', 'financeiro'],            descricao: 'Acesso a RH (funcionÃ¡rio) e Financeiro'        },                // Hellen - RH (pÃ¡gina funcionÃ¡rio), Financeiro        hellen: {            is_admin: 0,            areas: ['rh', 'financeiro'],            descricao: 'Acesso a RH (funcionÃ¡rio) e Financeiro'        },                // Thiago - RH (pÃ¡gina funcionÃ¡rio), NF-e & LogÃ­stica, Vendas        thiago: {            is_admin: 0,            areas: ['rh', 'nfe', 'vendas'],            descricao: 'Acesso a RH (funcionÃ¡rio), NF-e & LogÃ­stica e Vendas'        },                // Guilherme - Compras        guilherme: {            is_admin: 0,            areas: ['rh', 'compras'],            descricao: 'Acesso a RH (funcionÃ¡rio) e Compras'        },                // Vendedores - Augusto, Fabiano, Fabiola, Marcia, Renata        vendedor: {            is_admin: 0,            areas: ['rh', 'vendas'],            descricao: 'Acesso a RH (funcionÃ¡rio) e Vendas'        },                // Consultoria Lumiere - Acesso a relatÃ³rios e anÃ¡lises        consultoria: {            is_admin: 0,            areas: ['rh', 'vendas', 'pcp', 'compras', 'financeiro', 'nfe'],            descricao: 'Acesso de consultoria - visualizaÃ§Ã£o'        },                // NFe & LogÃ­stica        nfe_logistica: {            is_admin: 0,            areas: ['rh', 'nfe'],            descricao: 'Acesso a RH (funcionÃ¡rio) e NF-e & LogÃ­stica'        },                // Financeiro        financeiro: {            is_admin: 0,            areas: ['rh', 'financeiro'],            descricao: 'Acesso a RH (funcionÃ¡rio) e Financeiro'        }    };    // Mapeamento de usuÃ¡rios para seus perfis    const usuariosPerfis = [        // Administradores        { email: 'ti@aluforce.ind.br', perfil: 'admin' },        { email: 'andreia@aluforce.ind.br', perfil: 'admin' },        { email: 'douglas@aluforce.ind.br', perfil: 'admin' },                // Clemerson - PCP, RH, Vendas        { email: 'clemerson.silva@aluforce.ind.br', perfil: 'clemerson' },                // Junior - RH, Financeiro        { email: 'junior@aluforce.ind.br', perfil: 'junior' },                // Hellen - RH, Financeiro        { email: 'hellen@aluforce.ind.br', perfil: 'hellen' },                // Thiago - RH, NFe, Vendas        { email: 'thiago@aluforce.ind.br', perfil: 'thiago' },                // Guilherme - Compras        { email: 'guilherme@aluforce.ind.br', perfil: 'guilherme' },                // Vendedores - Vendas apenas        { email: 'augusto@aluforce.ind.br', perfil: 'vendedor' },        { email: 'fabiano@aluforce.ind.br', perfil: 'vendedor' },        { email: 'fabiola@aluforce.ind.br', perfil: 'vendedor' },        { email: 'marcia@aluforce.ind.br', perfil: 'vendedor' },        { email: 'renata@aluforce.ind.br', perfil: 'vendedor' },                // Consultoria Lumiere        { email: 'mauricio.torrolho@lumiereassessoria.com.br', perfil: 'consultoria' },        { email: 'jamerson.ribeiro@lumiereassessoria.com.br', perfil: 'consultoria' },        { email: 'diego.lucena@lumiereassessoria.com.br', perfil: 'consultoria' }    ];    let atualizados = 0;    let naoEncontrados = [];    let erros = [];    for (const usuario of usuariosPerfis) {        const perfil = perfis[usuario.perfil];                if (!perfil) {            console.log(`âš ï¸ Perfil nÃ£o encontrado: ${usuario.perfil}`);            continue;        }        try {            // Verificar se usuÃ¡rio existe            const [rows] = await conn.query('SELECT id, nome FROM usuarios WHERE email = ?', [usuario.email]);                        if (rows.length === 0) {                naoEncontrados.push(usuario.email);                console.log(`âš ï¸ UsuÃ¡rio nÃ£o encontrado: ${usuario.email}`);                continue;            }            const userId = rows[0].id;            const userName = rows[0].nome;            // Atualizar permissÃµes            await conn.query(                'UPDATE usuarios SET is_admin = ?, areas = ? WHERE id = ?',                [perfil.is_admin, JSON.stringify(perfil.areas), userId]            );            console.log(`âœ… ${userName} (${usuario.email})`);            console.log(`   is_admin: ${perfil.is_admin}, areas: ${perfil.areas.join(', ')}`);            atualizados++;        } catch (err) {            console.error(`âŒ Erro ao atualizar ${usuario.email}:`, err.message);            erros.push({ email: usuario.email, erro: err.message });        }    }    console.log('' + '='.repeat(60));    console.log('ğŸ“Š RESUMO:');    console.log(`   âœ… UsuÃ¡rios atualizados: ${atualizados}`);    console.log(`   âš ï¸ NÃ£o encontrados: ${naoEncontrados.length}`);    if (naoEncontrados.length > 0) {        console.log(`      ${naoEncontrados.join(', ')}`);    }    console.log(`   âŒ Erros: ${erros.length}`);    console.log('='.repeat(60));    // Listar todos os usuÃ¡rios com suas permissÃµes atuais    console.log('ğŸ“‹ LISTA ATUAL DE USUÃRIOS E PERMISSÃ•ES:');    console.log('-'.repeat(60));        const [allUsers] = await conn.query(        'SELECT id, nome, email, is_admin, areas FROM usuarios ORDER BY is_admin DESC, nome'    );        for (const user of allUsers) {        const adminBadge = user.is_admin === 1 ? 'ğŸ‘‘ ADMIN' : 'ğŸ‘¤';        const areasStr = Array.isArray(user.areas) ? user.areas.join(', ') : user.areas || 'Nenhuma';        console.log(`${adminBadge} ${user.nome}`);        console.log(`   Email: ${user.email}`);        console.log(`   Ãreas: ${areasStr}`);        console.log('');    }    await conn.end();    console.log('âœ… ConfiguraÃ§Ã£o de permissÃµes concluÃ­da!');}configurarPermissoes().catch(console.error);