// Script para identificar e remover duplicados de materiaisrequire('dotenv').config();const mysql = require('mysql2/promise');async function limparDuplicados() {    const conn = await mysql.createConnection({        host: process.env.DB_HOST,        port: process.env.DB_PORT || 3306,        user: process.env.DB_USER,        password: process.env.DB_PASSWORD,        database: process.env.DB_NAME,        charset: 'utf8mb4'    });    try {        await conn.query('SET NAMES utf8mb4');                console.log('üîç Identificando materiais duplicados...');                // Encontrar duplicados por descri√ß√£o        const [duplicados] = await conn.query(`            SELECT descricao, COUNT(*) as qtd, GROUP_CONCAT(id) as ids            FROM compras_materiais            GROUP BY descricao            HAVING COUNT(*) > 1            ORDER BY qtd DESC            LIMIT 20        `);        console.log(`üìä Top 20 materiais com mais duplicados:`);        duplicados.forEach((d, i) => {            console.log(`${i+1}. ${d.descricao}`);            console.log(`   Quantidade: ${d.qtd} | IDs: ${d.ids.substring(0, 50)}...`);        });        // Contar total de duplicados        const [total] = await conn.query(`            SELECT SUM(qtd - 1) as total_duplicados            FROM (                SELECT COUNT(*) as qtd                FROM compras_materiais                GROUP BY descricao                HAVING COUNT(*) > 1            ) t        `);        console.log(`üìä Total de registros duplicados: ${total[0].total_duplicados || 0}`);        // Perguntar se quer limpar        if (total[0].total_duplicados > 0) {            console.log('üßπ Removendo duplicados (mantendo o registro mais recente)...');                        // Remover duplicados, mantendo o de menor ID (mais antigo = original)            const [result] = await conn.query(`                DELETE cm1 FROM compras_materiais cm1                INNER JOIN compras_materiais cm2                 WHERE cm1.descricao = cm2.descricao                 AND cm1.id > cm2.id            `);            console.log(`‚úÖ Removidos ${result.affectedRows} duplicados`);            // Total atual            const [novoTotal] = await conn.query('SELECT COUNT(*) as total FROM compras_materiais');            console.log(`üìä Total de materiais ap√≥s limpeza: ${novoTotal[0].total}`);            // Mostrar categorias            const [cats] = await conn.query('SELECT categoria, COUNT(*) as qtd FROM compras_materiais GROUP BY categoria ORDER BY qtd DESC');            console.log('üìä Categorias ap√≥s limpeza:');            cats.forEach(c => console.log(`  - ${c.categoria}: ${c.qtd}`));        }    } catch (error) {        console.error('‚ùå Erro:', error.message);    } finally {        await conn.end();    }}limparDuplicados();