// Script para importar todos os materiais relevantes do PCPrequire('dotenv').config();const mysql = require('mysql2/promise');async function importarTodosMateriais() {    const conn = await mysql.createConnection({        host: process.env.DB_HOST,        port: process.env.DB_PORT || 3306,        user: process.env.DB_USER,        password: process.env.DB_PASSWORD,        database: process.env.DB_NAME,        charset: 'utf8mb4'    });    try {        await conn.query('SET NAMES utf8mb4');        console.log('üîç Buscando todos os materiais do PCP...');                // Buscar TODOS os materiais ativos do PCP        const [materiais] = await conn.query(`            SELECT DISTINCT                 codigo_material as codigo,                descricao,                unidade_medida as unidade,                quantidade_estoque as estoque_atual,                custo_unitario,                ncm,                cest,                gtin as codigo_barras,                ativo            FROM materiais             WHERE ativo = 1            AND descricao IS NOT NULL            AND descricao != ''            ORDER BY descricao        `);        console.log(`üì¶ Encontrados ${materiais.length} materiais no PCP`);        // Verificar quais j√° existem em compras_materiais        const [existentes] = await conn.query('SELECT codigo FROM compras_materiais');        const codigosExistentes = new Set(existentes.map(e => e.codigo));        // Filtrar apenas os novos        const novos = materiais.filter(m => !codigosExistentes.has(m.codigo));        console.log(`‚ú® ${novos.length} materiais novos para importar (${materiais.length - novos.length} j√° existem)`);        if (novos.length === 0) {            console.log('Nenhum material novo para importar.');            await conn.end();            return;        }        // Determinar categoria baseado na descri√ß√£o        function determinarCategoria(descricao) {            if (!descricao) return 'Geral';            const desc = descricao.toUpperCase();                        // Cabos e Veias            if (desc.includes('VEIA') || desc.includes('MULTIPLEX')) return 'Veias e Cabos';            if (desc.includes('CABO DE POTENCIA') || desc.includes('CB DE POTENCIA')) return 'Cabos de Pot√™ncia';            if (desc.includes('CABO') || desc.includes('FIO')) return 'Cabos e Fios';                        // Materiais espec√≠ficos            if (desc.includes('POLIETILENO') || desc.includes('PEAD') || desc.includes('PEBD')) return 'Polietileno';            if (desc.includes('XLPE')) return 'XLPE';            if (desc.includes('PVC')) return 'PVC';            if (desc.includes('CORDA') || desc.includes('CORDAO')) return 'Cordas';            if (desc.includes('FILAMENTO')) return 'Filamentos';                        // Metais            if (desc.includes('ALUM√çNIO') || desc.includes('ALUMINIO')) return 'Alum√≠nio';            if (desc.includes('COBRE')) return 'Cobre';            if (desc.includes('CHAPA')) return 'Chapas';            if (desc.includes('PERFIL')) return 'Perfis';            if (desc.includes('TUBO')) return 'Tubos';            if (desc.includes('CANTONEIRA')) return 'Perfis';                        // Fixa√ß√£o            if (desc.includes('PARAFUSO') || desc.includes('PORCA') || desc.includes('ARRUELA') ||                 desc.includes('REBITE') || desc.includes('BUCHA')) return 'Fixa√ß√£o';                        // Outros            if (desc.includes('BORRACHA') || desc.includes('VEDA√á√çO') || desc.includes('GAXETA')) return 'Borrachas';            if (desc.includes('SILICONE') || desc.includes('COLA') || desc.includes('ADESIVO')) return 'Adesivos';            if (desc.includes('FITA') || desc.includes('FILME') || desc.includes('CAIXA') || desc.includes('EMBALAGEM')) return 'Embalagens';            if (desc.includes('TINTA') || desc.includes('PRIMER') || desc.includes('VERNIZ')) return 'Pintura';            if (desc.includes('LIXA') || desc.includes('DISCO') || desc.includes('BROCA') || desc.includes('SERRA')) return 'Ferramentas';            if (desc.includes('GRAXA') || desc.includes('√ìLEO') || desc.includes('OLEO') || desc.includes('LUBRIFICANTE')) return 'Lubrificantes';            if (desc.includes('VIDRO')) return 'Vidros';            if (desc.includes('DOBRADI√áA') || desc.includes('DOBRADICA') || desc.includes('FECHADURA') ||                 desc.includes('PUXADOR') || desc.includes('ROLDANA') || desc.includes('TRINCO')) return 'Componentes';            if (desc.includes('ROLAMENTO') || desc.includes('MOLA')) return 'Componentes';            if (desc.includes('SOLDA') || desc.includes('ELETRODO')) return 'Soldagem';            if (desc.includes('SERVICO') || desc.includes('SERVI√áO')) return 'Servi√ßos';                        return 'Materiais Diversos';        }        // Inserir novos materiais        console.log('üì• Importando materiais...');        let importados = 0;        let erros = 0;        for (const m of novos) {            try {                const categoria = determinarCategoria(m.descricao);                await conn.query(`                    INSERT INTO compras_materiais (                        codigo, descricao, categoria, unidade,                         estoque_atual, estoque_min, estoque_max,                        ultimo_preco, ncm, cest, codigo_barras, ativo, sinc_pcp                    ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 1, 1)                `, [                    m.codigo,                    m.descricao,                    categoria,                    m.unidade || 'UN',                    m.estoque_atual || 0,                    5, // estoque_min padr√£o                    100, // estoque_max padr√£o                    m.custo_unitario || 0,                    m.ncm || null,                    m.cest || null,                    m.codigo_barras || null                ]);                importados++;            } catch (err) {                if (!err.message.includes('Duplicate')) {                    console.log(`  ‚ö†Ô∏è Erro ao importar ${m.codigo}: ${err.message}`);                }                erros++;            }        }        console.log(`‚úÖ Importa√ß√£o conclu√≠da: ${importados} materiais importados, ${erros} erros/duplicados`);        // Mostrar total atualizado        const [total] = await conn.query('SELECT COUNT(*) as total FROM compras_materiais');        console.log(`üìä Total de materiais em compras_materiais: ${total[0].total}`);        // Mostrar categorias        const [cats] = await conn.query('SELECT categoria, COUNT(*) as qtd FROM compras_materiais GROUP BY categoria ORDER BY qtd DESC');        console.log('üìä Categorias:');        cats.forEach(c => console.log(`  - ${c.categoria}: ${c.qtd}`));    } catch (error) {        console.error('‚ùå Erro:', error.message);    } finally {        await conn.end();    }}importarTodosMateriais();