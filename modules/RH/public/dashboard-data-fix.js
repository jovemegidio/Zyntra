/* =============================================== *//* DASHBOARD FIX - Carregamento dinmico de dados *//* =============================================== */// Funçáo para obter headers de autenticaçáofunction getAuthHeaders(additionalHeaders = {}) {    const token = localStorage.getItem('authToken') || localStorage.getItem('token');    const headers = {        'Authorization': `Bearer ${token}`,        ...additionalHeaders    };    return headers;}// Funçáo para carregar dados do dashboardasync function loadDashboardData() {    try {        console.log('🔄 Carregando dados do dashboard...');                const response = await fetch('/api/dashboard/summary', {            headers: getAuthHeaders({ 'Content-Type': 'application/json' })        });                if (!response.ok) {            throw new Error('Erro ao carregar dados do dashboard');        }                const data = await response.json();        console.log('📊 Dados do dashboard recebidos:', data);                // Atualizar contadores        updateDashboardCounters(data);                // Atualizar listas        updateAniversariantes(data.aniversariantes || []);        updateAvisos(data.avisos || []);                return data;            } catch (error) {        console.error('❌ Erro ao carregar dashboard:', error);        // Usar dados fallback em caso de erro        loadFallbackData();    }}// Funçáo para atualizar contadores dos widgetsfunction updateDashboardCounters(data) {    // Calcular totais baseados nos dados recebidos    const totals = {        funcionarios: data.tempoCasa ? data.tempoCasa.length : 0,        aniversariantes: data.aniversariantes ? data.aniversariantes.length : 0,        avisos: data.avisos ? data.avisos.length : 0,        relatórios: 12, // Valor fixo por enquanto        admissoes: 0    // Valor fixo por enquanto    };        // Mapear para os IDs dos widgets    const widgets = {        'total-funcionarios': totals.funcionarios,        'count-aniversariantes': totals.aniversariantes,        'count-avisos': totals.avisos,        'count-relatórios': totals.relatórios,        'count-admissoes': totals.admissoes    };        // Atualizar cada widget    Object.keys(widgets).forEach(id => {        const element = document.getElementById(id);        if (element) {            element.textContent = widgets[id];            console.log(`✅ Widget ${id} atualizado: ${widgets[id]}`);        }    });}// Funçáo para atualizar lista de aniversariantesfunction updateAniversariantes(aniversariantes) {    const lista = document.getElementById('dashboard-aniversariantes-list');    if (!lista) return;        lista.innerHTML = '';        if (!aniversariantes || aniversariantes.length === 0) {        lista.innerHTML = '<li style="color: var(--gray-500); text-align: center;">Nenhum aniversariante este mês</li>';        return;    }        aniversariantes.forEach(pessoa => {        const li = document.createElement('li');        li.className = 'aniver-item';                const foto = pessoa.foto_thumb_url || pessoa.foto_perfil_url || pessoa.foto_url || 'Interativo-Aluforce.jpg';        const nome = pessoa.nome || 'Nome náo informado';        const dataNasc = pessoa.data_nascimento || pessoa.nascimento;                let diaMes = '-';        if (dataNasc) {            const data = new Date(dataNasc);            diaMes = data.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });        }                li.innerHTML = `            <div class="aniver-avatar">                <img src="${foto}" alt="Avatar de ${nome}" class="aniver-avatar-img"                      onerror="this.onerror=null;this.src='Interativo-Aluforce.jpg';">            </div>            <div class="aniver-info">                <strong>${nome}</strong>                <span>${diaMes}</span>            </div>        `;                lista.appendChild(li);    });        console.log(`✅ Lista de aniversariantes atualizada: ${aniversariantes.length} pessoas`);}// Funçáo para atualizar avisosfunction updateAvisos(avisos) {    const container = document.getElementById('dashboard-avisos-list');    if (!container) return;        if (!avisos || avisos.length === 0) {        container.innerHTML = '<div class="aviso-list"><p style="color: var(--gray-500); text-align: center;">Nenhum aviso publicado</p></div>';        return;    }        const avisosList = document.createElement('div');    avisosList.className = 'aviso-list';        avisos.forEach(aviso => {        const avisoCard = document.createElement('div');        avisoCard.className = 'aviso-card';                const titulo = aviso.titulo || 'Aviso sem título';        const mensagem = aviso.mensagem || aviso.conteudo || 'Conteúdo náo disponível';        const dataPublicacao = aviso.created_at || aviso.data_publicacao;                let dataFormatada = '';        if (dataPublicacao) {            const data = new Date(dataPublicacao);            dataFormatada = data.toLocaleDateString('pt-BR') + ' às ' + data.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });        }                avisoCard.innerHTML = `            <div class="aviso-header">                <h4 class="aviso-title">${titulo}</h4>            </div>            <div class="aviso-content">                <p class="aviso-message">${mensagem}</p>                ${dataFormatada ? `<small class="aviso-date">${dataFormatada}</small>` : ''}            </div>        `;                avisosList.appendChild(avisoCard);    });        container.innerHTML = '';    container.appendChild(avisosList);        console.log(`✅ Lista de avisos atualizada: ${avisos.length} avisos`);}// Funçáo fallback com dados estáticosfunction loadFallbackData() {    console.log('⚠️ Usando dados fallback para o dashboard');        const fallbackData = {        funcionarios: 6,  // Sabemos que temos 6 usuários criados        aniversariantes: 2,        avisos: 3,        relatórios: 12,        admissoes: 0    };        const widgets = {        'total-funcionarios': fallbackData.funcionarios,        'count-aniversariantes': fallbackData.aniversariantes,        'count-avisos': fallbackData.avisos,        'count-relatórios': fallbackData.relatórios,        'count-admissoes': fallbackData.admissoes    };        Object.keys(widgets).forEach(id => {        const element = document.getElementById(id);        if (element) {            element.textContent = widgets[id];            console.log(`✅ Widget ${id} definido com fallback: ${widgets[id]}`);        }    });        // Lista vazia para aniversariantes    const listAniv = document.getElementById('dashboard-aniversariantes-list');    if (listAniv) {        listAniv.innerHTML = '<li style="color: var(--gray-500); text-align: center;">Dados náo disponíveis</li>';    }        // Lista vazia para avisos    const listAvisos = document.getElementById('dashboard-avisos-list');    if (listAvisos) {        listAvisos.innerHTML = '<div class="aviso-list"><p style="color: var(--gray-500); text-align: center;">Dados náo disponíveis</p></div>';    }}// Funçáo para forçar visibilidade do dashboardfunction ensureDashboardVisibility() {    // Garantir que a seçáo do dashboard esteja visível    const dashboardSection = document.getElementById('dashboard-home');    if (dashboardSection) {        dashboardSection.style.display = 'block';        dashboardSection.style.visibility = 'visible';        dashboardSection.style.opacity = '1';    }        // Garantir que o grid esteja visível    const dashboardGrid = document.querySelector('.dashboard-grid');    if (dashboardGrid) {        dashboardGrid.style.display = 'grid';        dashboardGrid.style.visibility = 'visible';        dashboardGrid.style.opacity = '1';    }        // Garantir que todos os widgets estejam visíveis    document.querySelectorAll('.widget').forEach(widget => {        widget.style.display = 'block';        widget.style.visibility = 'visible';        widget.style.opacity = '1';    });        console.log('✅ Visibilidade do dashboard garantida');}// Funçáo para verificar se o usuário está logadofunction isLoggedIn() {    const token = localStorage.getItem('authToken') || localStorage.getItem('token');    return !!token;}// Funçáo principal de inicializaçáofunction initializeDashboard() {    console.log('🚀 Inicializando dashboard...');        // Garantir visibilidade primeiro    ensureDashboardVisibility();        // Verificar se está logado    if (!isLoggedIn()) {        console.warn('⚠️ Usuário náo está logado, redirecionando...');        window.location.href = 'login.html';        return;    }        // Carregar dados    loadDashboardData();}// Event listenersdocument.addEventListener('DOMContentLoaded', function() {    // Aguardar um pouco para garantir que tudo carregou    setTimeout(() => {        initializeDashboard();    }, 500);});// Listener para quando a janela carrega completamentewindow.addEventListener('load', function() {    setTimeout(() => {        ensureDashboardVisibility();        if (isLoggedIn()) {            loadDashboardData();        }    }, 1000);});// Funçáo global para recarregar dashboard (pode ser chamada do console)window.reloadDashboard = function() {    console.log('🔄 Recarregando dashboard manualmente...');    initializeDashboard();};// Funçáo global para debugwindow.debugDashboardData = function() {    console.log('=== 🎯 DEBUG DO DASHBOARD ===');    console.log('Token presente:', !!localStorage.getItem('authToken'));    console.log('Dashboard section:', document.getElementById('dashboard-home'));    console.log('Widgets encontrados:', document.querySelectorAll('.widget').length);    loadDashboardData().then(data => {        console.log('Dados carregados:', data);    });};console.log('📱 Dashboard Data Fix carregado');