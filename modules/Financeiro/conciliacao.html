<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aluforce: Conciliação Bancária</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <script src="/js/auth-unified.js?v=20260211"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="css/fin-layout.css?v=20260215">
    <link rel="stylesheet" href="css/fin-components.css?v=20260215">
    <style>
        :root {
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --bg-gray: #f1f5f9;
            --border-color: #e2e8f0;
            --primary-orange: #f97316;
            --primary-dark: #1e3a5f;
            --sidebar-width: 60px;
            --header-height: 56px;
        }

        

        
        
        

        /* ======================================== SIDEBAR LATERAL ======================================== */
        
        
        
        
        
        
        
        
        
        

        /* ======================================== MAIN CONTENT AREA ======================================== */
        .main-area { flex: 1; display: flex; flex-direction: column; /* overflow: global-header-sidebar.css */ }

        /* ======================================== HEADER SUPERIOR ======================================== */
        
        
        
        
        
        
        
        
        

        /* ======================================== SISTEMA DE NOTIFICAÇÕES ======================================== */
        
        
        
        
        @keyframes pulse-badge { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        
        
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        
        
        
        
        
        .notif-tab { flex: 1; padding: 12px; background: none; border: none; font-size: 12px; color: #666; cursor: pointer; transition: all 0.2s; border-bottom: 2px solid transparent; }
        .notif-tab:hover { color: #f97316; }
        .notif-tab.active { color: #f97316; border-bottom-color: #f97316; font-weight: 600; }
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        

        /* PAGE */
        .page-content { flex: 1; overflow-y: auto; padding: 24px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .page-title-section h1 { font-size: 24px; font-weight: 700; display: flex; align-items: center; gap: 12px; margin-bottom: 4px; }
        .page-title-section h1 i { color: var(--primary-orange); }
        .page-title-section p { font-size: 14px; color: var(--text-secondary); }
        .page-actions { display: flex; gap: 12px; }
        .btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 20px; border-radius: 8px; font-size: 14px; font-weight: 600; border: none; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: var(--primary-orange); color: white; }
        .btn-primary:hover { background: #65a30d; }
        .btn-secondary { background: white; color: var(--text-primary); border: 1px solid var(--border-color); }
        .btn-success { background: var(--success); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }

        /* KPI CARDS */
        .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px; }
        .kpi-card { background: white; border-radius: 16px; padding: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .kpi-card.highlight { background: linear-gradient(135deg, #225cfa 0%, #1a47c4 100%); color: white; }
        .kpi-card.highlight .kpi-content h3 { color: rgba(255,255,255,0.8); }
        .kpi-card.highlight .kpi-icon { background: rgba(255,255,255,0.2); color: white; }
        .kpi-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
        .kpi-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        .kpi-icon.blue { background: rgba(59,130,246,0.1); color: var(--info); }
        .kpi-icon.green { background: rgba(34,197,94,0.1); color: var(--success); }
        .kpi-icon.orange { background: rgba(245,158,11,0.1); color: var(--warning); }
        .kpi-icon.red { background: rgba(239,68,68,0.1); color: var(--danger); }
        .kpi-content h3 { font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; }
        .kpi-value { font-size: 28px; font-weight: 700; }

        /* FILTERS */
        .filters-bar { 
            display: flex; 
            gap: 0; 
            margin-bottom: 24px; 
            background: white; 
            padding: 0; 
            border-radius: 14px; 
            flex-wrap: nowrap; 
            align-items: stretch;
            box-shadow: 0 1px 3px rgba(0,0,0,0.04), 0 4px 16px rgba(0,0,0,0.02);
            border: 1px solid rgba(0,0,0,0.04);
            overflow: hidden;
        }
        .filter-group { 
            display: flex !important; 
            flex-direction: row !important;
            align-items: center !important; 
            gap: 10px; 
            padding: 14px 20px;
            border-right: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        .filter-group:last-of-type { border-right: none; }
        .filter-group label { 
            font-size: 12px; 
            font-weight: 600; 
            color: var(--text-secondary); 
            text-transform: uppercase;
            letter-spacing: 0.3px;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .filter-group label i { font-size: 14px; color: #94a3b8; }
        .filter-group select, .filter-group input[type="date"] { 
            padding: 8px 12px; 
            border: 1.5px solid var(--border-color); 
            border-radius: 8px; 
            font-size: 13px; 
            background: var(--bg-gray);
            transition: all 0.2s;
            font-family: inherit;
        }
        .filter-group select { min-width: 200px; }
        .filter-group input[type="date"] { min-width: 140px; }
        .filter-group select:focus, .filter-group input:focus { 
            outline: none; 
            border-color: var(--primary-orange); 
            background: white;
            box-shadow: 0 0 0 3px rgba(34,92,250,0.1);
        }
        .filter-separator { font-size: 12px; color: var(--text-secondary); font-weight: 500; }
        .filters-bar .btn { 
            margin-left: auto; 
            border-radius: 0; 
            border: none;
            padding: 14px 24px; 
            background: linear-gradient(135deg, var(--primary-orange), #1a47c4);
            color: white;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .filters-bar .btn:hover { filter: brightness(1.1); }

        /* CONCILIAÇÃO GRID */
        .conciliacao-grid { display: grid; grid-template-columns: 1fr 80px 1fr; gap: 24px; margin-bottom: 24px; }
        .conciliacao-panel { background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
        .panel-header { padding: 20px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .panel-header h3 { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .panel-header h3 i { color: var(--primary-orange); }
        .panel-header .saldo { font-size: 18px; font-weight: 700; }
        .panel-header .saldo.positivo { color: var(--success); }
        .panel-header .saldo.negativo { color: var(--danger); }
        .panel-

        /* MATCH COLUMN */
        .match-column { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 16px; padding: 20px 0; }
        .match-btn { width: 60px; height: 60px; border-radius: 50%; border: none; cursor: pointer; font-size: 20px; transition: all 0.3s; }
        .match-btn.link { background: var(--success); color: white; }
        .match-btn.link:hover { transform: scale(1.1); box-shadow: 0 4px 15px rgba(34,197,94,0.4); }
        .match-btn.unlink { background: var(--danger); color: white; }
        .match-btn.auto { background: var(--primary-orange); color: white; }
        .match-info { text-align: center; font-size: 12px; color: var(--text-secondary); }

        /* ITEM LIST */
        .item-list { list-style: none; }
        .item-row { display: flex; align-items: center; padding: 16px 20px; border-bottom: 1px solid #f1f5f9; cursor: pointer; transition: all 0.2s; }
        .item-row:hover { background: var(--bg-gray); }
        .item-row.selected { background: rgba(34,92,250,0.05); border-left: 3px solid var(--primary-orange); }
        .item-row.conciliado { background: rgba(34,197,94,0.05); }
        .item-row.conciliado::after { content: '?'; position: absolute; right: 20px; color: var(--success); font-weight: bold; }
        .item-check { width: 20px; height: 20px; border: 2px solid var(--border-color); border-radius: 4px; margin-right: 12px; display: flex; align-items: center; justify-content: center; }
        .item-check.checked { background: var(--primary-orange); border-color: var(--primary-orange); color: white; }
        .item-info { flex: 1; }
        .item-info .data { font-size: 11px; color: var(--text-secondary); margin-bottom: 4px; }
        .item-info .descricao { font-size: 13px; font-weight: 500; }
        .item-valor { font-size: 14px; font-weight: 600; text-align: right; }
        .item-valor.entrada { color: var(--success); }
        .item-valor.saida { color: var(--danger); }

        /* STATUS BADGES */
        .status-badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .status-badge.pendente { background: rgba(245,158,11,0.1); color: var(--warning); }
        .status-badge.conciliado { background: rgba(34,197,94,0.1); color: var(--success); }
        .status-badge.divergente { background: rgba(239,68,68,0.1); color: var(--danger); }

        /* CARD */
        .card { background: white; border-radius: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); overflow: hidden; }
        .card-header { padding: 20px 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .card-header h3 { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 10px; }
        .card-header h3 i { color: var(--primary-orange); }

        /* TABLE */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { background: var(--bg-gray); padding: 14px 20px; text-align: left; font-size: 11px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; }
        .data-table td { padding: 16px 20px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
        .data-table tr:hover { background: var(--bg-gray); }

        /* MODAL */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal-overlay.active { display: flex; }
        .modal { background: white; border-radius: 20px; width: 100%; max-width: 500px; max-height: 90vh; overflow: hidden; }
        .modal-header { padding: 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 12px; }
        .modal-header h2 i { color: var(--primary-orange); }
        .modal-close { width: 36px; height: 36px; border: none; background: var(--bg-gray); border-radius: 10px; cursor: pointer; font-size: 18px; color: var(--text-secondary); }
        .modal-
        .modal-footer { padding: 20px 24px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 12px; }

        /* MODAL - Classes padrão (Padrão SaaS Empresarial) */
        .modal-overlay-padrao { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(15,23,42,0.7); display: none; align-items: center; justify-content: center; z-index: 99999; -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px); }
        .modal-overlay-padrao.active { display: flex !important; }
        .modal-padrao { display: flex !important; flex-direction: column !important; background: white !important; border-radius: 20px !important; width: 100% !important; max-width: 600px !important; max-height: 90vh !important; overflow: hidden !important; box-shadow: 0 25px 80px rgba(0,0,0,0.25), 0 10px 30px rgba(0,0,0,0.15) !important; animation: modalFadeIn 0.25s ease-out !important; position: relative !important; margin: 16px !important; }
        @keyframes modalFadeIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .modal-header-padrao { padding: 24px 32px !important; background: linear-gradient(135deg, #225cfa 0%, #1a47c4 100%) !important; color: white !important; display: flex !important; justify-content: space-between !important; align-items: center !important; flex-shrink: 0 !important; border-radius: 20px 20px 0 0 !important; }
        .modal-padrao--sm { max-width: 480px !important; }
        .modal-header-content-padrao { display: flex; align-items: center; gap: 14px; }
        .modal-header-icon-padrao { width: 44px; height: 44px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .modal-header-text-padrao h2 { font-size: 20px; font-weight: 700; color: white; margin: 0; }
        .modal-header-text-padrao p { font-size: 13px; color: rgba(255,255,255,0.8); margin: 4px 0 0 0; }
        .modal-close-padrao { width: 40px !important; height: 40px !important; border: none !important; background: rgba(255,255,255,0.2) !important; border-radius: 10px !important; cursor: pointer !important; color: white !important; font-size: 18px !important; transition: all 0.2s !important; display: flex !important; align-items: center !important; justify-content: center !important; }
        .modal-close-padrao:hover { background: rgba(255,255,255,0.3) !important; transform: rotate(90deg) !important; }
        .modal-body-padrao { padding: 28px 32px !important; overflow-y: auto !important; max-height: calc(90vh - 200px) !important; background: #f9fafb !important; flex: 1 !important; }
        .modal-footer-padrao { padding: 20px 32px !important; border-top: 1px solid #e5e7eb !important; display: flex !important; justify-content: flex-end !important; gap: 12px !important; background: #ffffff !important; flex-shrink: 0 !important; }
        .form-section-padrao { background: #ffffff; border-radius: 16px; padding: 24px; border: 1px solid #e5e7eb; margin-bottom: 16px; }
        .form-section-padrao:last-child { margin-bottom: 0; }
        .form-grid-padrao { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 16px; }
        .form-grid-padrao:last-child { margin-bottom: 0; }
        .form-group-padrao { margin-bottom: 16px; }
        .form-group-padrao:last-child { margin-bottom: 0; }
        .form-group-padrao label { display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 8px; }
        .form-group-padrao label i { color: #225cfa; font-size: 14px; }
        .form-group-padrao label .required { color: #ef4444; margin-left: 2px; }
        .form-group-padrao input, .form-group-padrao select, .form-group-padrao textarea { width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 15px; transition: all 0.2s; background: #ffffff; }
        .form-group-padrao input:focus, .form-group-padrao select:focus, .form-group-padrao textarea:focus { outline: none; border-color: #225cfa; box-shadow: 0 0 0 4px rgba(34, 92, 250, 0.1); }
        .btn-padrao-ghost { display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: 1px solid #e5e7eb; background: #ffffff; color: #6b7280; }
        .btn-padrao-ghost:hover { background: #f3f4f6; color: #374151; }
        .btn-padrao-primary { display: inline-flex; align-items: center; gap: 8px; padding: 12px 24px; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; background: linear-gradient(135deg, #225cfa 0%, #1a47c4 100%); color: white; box-shadow: 0 4px 12px rgba(34, 92, 250, 0.35); }
        .btn-padrao-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(34, 92, 250, 0.4); }

        /* UPLOAD AREA */
        .upload-area { border: 2px dashed var(--border-color); border-radius: 16px; padding: 40px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .upload-area:hover { border-color: var(--primary-orange); background: rgba(30,64,175,0.02); }
        .upload-area i { font-size: 48px; color: var(--text-secondary); margin-bottom: 16px; }
        .upload-area h4 { font-size: 16px; margin-bottom: 8px; }
        .upload-area p { font-size: 13px; color: var(--text-secondary); }
        .upload-area input { display: none; }
        .arquivo-info { display: none; margin-top: 16px; padding: 12px 16px; background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 10px; font-size: 13px; color: #0369a1; }
        .arquivo-info i { color: #0284c7; margin-right: 8px; }
        .upload-area.drag-over { border-color: #225cfa; background: rgba(34,92,250,0.05); }

        /* RESPONSIVE */
        @media (max-width: 1400px) { .kpi-grid { grid-template-columns: repeat(2, 1fr); } .conciliacao-grid { grid-template-columns: 1fr; } .match-column { flex-direction: row; padding: 20px; } }
        @media (max-width: 1100px) { .filters-bar { flex-wrap: wrap; } .filter-group { flex: 1; min-width: 250px; } .filters-bar .btn { width: 100%; justify-content: center; border-radius: 0 0 14px 14px; } }
        @media (max-width: 768px) { .kpi-grid { grid-template-columns: 1fr; } .filter-group { flex-direction: column; align-items: flex-start; min-width: 100%; } }
    </style>
    <script src="/js/anti-copy-protection.js"></script>
    <link rel="stylesheet" href="/css/popup-confirmacao.css">
    <link rel="stylesheet" href="/css/modal-fix-global.css?v=20260114-fix4">
    <link rel="stylesheet" href="css/modais-padrao.css?v=20260114-fix3">
    <link rel="stylesheet" href="css/modais-saas-unified.css?v=20260121">
    <link rel="stylesheet" href="css/conciliacao-mobile.css?v=20260201">
    <link rel="stylesheet" href="/css/tooltips-professional.css?v=20260209">
    <script src="/js/tooltips-professional.js?v=20260209"></script>
    <link rel="stylesheet" href="css/fin-header-sidebar.css?v=20260211">
    <link rel="stylesheet" href="/css/global-header-sidebar.css?v=20260216">
        <!-- Chat Widget BOB AI -->
    <link rel="stylesheet" href="/chat/widget.css?v=20260218">
</head>
<body>
    <div class="app-container">

        <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleMobileSidebar()"></div>


        <!-- SIDEBAR - PADRÃO PCP (HTML estático, RBAC via JS) -->
        <aside class="sidebar" id="mobile-sidebar">
            <a href="/dashboard" class="sidebar-logo" title="Voltar ao Painel">
                <i class="fas fa-home"></i>
            </a>

            <nav class="sidebar-nav">
                <a href="index.html" class="sidebar-btn" title="Dashboard">
                    <i class="fas fa-chart-line"></i>
                </a>
                <a href="contas-pagar.html" class="sidebar-btn" title="Contas a Pagar">
                    <i class="fas fa-file-invoice-dollar"></i>
                </a>
                <a href="contas-receber.html" class="sidebar-btn" title="Contas a Receber">
                    <i class="fas fa-hand-holding-usd"></i>
                </a>
                <a href="fluxo-caixa.html" class="sidebar-btn" title="Fluxo de Caixa">
                    <i class="fas fa-chart-area"></i>
                </a>
                <a href="bancos.html" class="sidebar-btn" title="Bancos">
                    <i class="fas fa-university"></i>
                </a>
                <a href="plano-contas.html" class="sidebar-btn" title="Plano de Contas">
                    <i class="fas fa-list-alt"></i>
                </a>
                <a href="orcamentos.html" class="sidebar-btn" title="Orçamentos">
                    <i class="fas fa-calculator"></i>
                </a>
                <a href="conciliacao.html" class="sidebar-btn active" title="Conciliação">
                    <i class="fas fa-balance-scale"></i>
                </a>
                <a href="relatorios.html" class="sidebar-btn" title="Relatórios">
                    <i class="fas fa-chart-bar"></i>
                </a>
            </nav>

            <div class="sidebar-bottom">
                <a href="centros-custo.html" class="sidebar-btn" title="Centros de Custo">
                    <i class="fas fa-sitemap"></i>
                </a>
                <a href="impostos.html" class="sidebar-btn" title="Impostos">
                    <i class="fas fa-percent"></i>
                </a>
                <button class="sidebar-btn" title="Configurações" id="btn-config" onclick="toggleConfiguracoes()">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </aside>

        <!-- Main Area -->
        <main class="main-area">
            <!-- HEADER - PADRÃO PCP (HTML estático) -->
            <header class="header">
                <div class="header-left">
                    <!-- Botao Menu Mobile -->
                    <button class="mobile-menu-btn" onclick="toggleMobileSidebar()" title="Menu">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="header-brand" style="display:flex;align-items:center;gap:10px;">
                        <img src="/images/Logo Monocromatico - Branco - Aluforce.png" alt="ALUFORCE" style="height:22px;object-fit:contain;">
                        <span style="color:rgba(255,255,255,0.2);font-weight:300;font-size:18px;user-select:none;">|</span>
                        <img src="/images/zyntra-branco.png" alt="Zyntra" style="height:22px;object-fit:contain;">
                        <span style="color:rgba(255,255,255,0.18);font-weight:200;font-size:16px;user-select:none;margin:0 2px;"></span>
                        <span style="font-size:13px;font-weight:500;color:rgba(255,255,255,0.85);letter-spacing:0.3px;">Conciliação</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn" title="Atualizar" onclick="location.reload()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <div class="notification-container">
                        <button class="header-btn notification-btn" title="Notificações" onclick="toggleNotificacoes()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notification-count" style="display: none;">0</span>
                        </button>
                        <div class="notification-panel" id="notification-panel">
                            <div class="notification-header">
                                <h3><i class="fas fa-bell"></i> Notificações</h3>
                                <div class="notification-actions">
                                    <button onclick="marcarTodasLidas()" title="Marcar todas como lidas">
                                        <i class="fas fa-check-double"></i>
                                    </button>
                                    <button onclick="limparNotificacoes()" title="Limpar todas">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="notification-list" id="notification-list">
                                <div class="notification-empty">
                                    <i class="fas fa-check-circle"></i>
                                    <p>Nenhuma notificação</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="user-greeting">
                        <span><span id="greeting-text">Bom dia</span>, <strong id="user-name">Usuário</strong></span>
                        <div class="user-avatar" id="user-avatar">
                            <img alt="Foto do usuário" id="user-photo" style="display:none">
                            <span id="user-initials">U</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Main Content - Padrão PCP -->
            <div class="main-content">

            <div class="page-content">
                <!-- Page Header -->
                <div class="page-header">
                    <div class="page-title-section">
                        <h1><i class="fas fa-balance-scale"></i> Conciliação Bancária</h1>
                        <p>Compare e concilie lançamentos do sistema com o extrato bancário</p>
                    </div>
                    <div class="page-actions">
                        <button class="btn btn-secondary" onclick="abrirModalImportar()"><i class="fas fa-file-import"></i> Importar OFX</button>
                        <button class="btn btn-primary" onclick="conciliarAutomatico()"><i class="fas fa-magic"></i> Conciliar Automático</button>
                    </div>
                </div>

                <!-- KPIs -->
                <div class="kpi-grid">
                    <div class="kpi-card highlight">
                        <div class="kpi-header">
                            <div class="kpi-icon"><i class="fas fa-check-double"></i></div>
                        </div>
                        <div class="kpi-content">
                            <h3>Lançamentos Conciliados</h3>
                            <div class="kpi-value" id="totalConciliados">0</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon orange"><i class="fas fa-clock"></i></div>
                        </div>
                        <div class="kpi-content">
                            <h3>Pendentes Sistema</h3>
                            <div class="kpi-value" id="pendentesSistema">0</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon blue"><i class="fas fa-file-alt"></i></div>
                        </div>
                        <div class="kpi-content">
                            <h3>Pendentes Extrato</h3>
                            <div class="kpi-value" id="pendentesExtrato">0</div>
                        </div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon red"><i class="fas fa-exclamation-triangle"></i></div>
                        </div>
                        <div class="kpi-content">
                            <h3>Divergências</h3>
                            <div class="kpi-value" id="divergencias">0</div>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-bar">
                    <div class="filter-group">
                        <label for="filtroBanco"><i class="fas fa-university"></i> Banco</label>
                        <select id="filtroBanco" name="filtroBanco" onchange="aplicarFiltros()">
                            <option value="">Todos os bancos</option>
                            <option value="1" selected>Banco do Brasil - Principal</option>
                            <option value="2">Itaú - Fornecedores</option>
                            <option value="3">Bradesco - Recebimentos</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-calendar-alt"></i> De</label>
                        <input type="date" id="dataInicio" title="Data início">
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-calendar-day"></i> Até</label>
                        <input type="date" id="dataFim" title="Data fim">
                    </div>
                    <button class="btn btn-primary" onclick="aplicarFiltros()"><i class="fas fa-filter"></i> Filtrar</button>
                </div>

                <!-- Conciliação Grid -->
                <div class="conciliacao-grid">
                    <!-- Sistema -->
                    <div class="conciliacao-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-desktop"></i> Lançamentos do Sistema</h3>
                            <div class="saldo positivo" id="saldoSistema">R$ 85.420,50</div>
                        </div>
                        <div class="panel-body">
                            <ul class="item-list" id="listaSistema"></ul>
                        </div>
                    </div>

                    <!-- Match Column -->
                    <div class="match-column">
                        <button class="match-btn link" onclick="conciliarSelecionados()" title="Conciliar Selecionados">
                            <i class="fas fa-link"></i>
                        </button>
                        <button class="match-btn unlink" onclick="desconciliarSelecionados()" title="Desfazer Conciliação">
                            <i class="fas fa-unlink"></i>
                        </button>
                        <button class="match-btn auto" onclick="conciliarAutomatico()" title="Conciliar Automático">
                            <i class="fas fa-magic"></i>
                        </button>
                        <div class="match-info">
                            Selecione itens<br>para conciliar
                        </div>
                    </div>

                    <!-- Extrato -->
                    <div class="conciliacao-panel">
                        <div class="panel-header">
                            <h3><i class="fas fa-file-invoice"></i> Extrato Bancário</h3>
                            <div class="saldo positivo" id="saldoExtrato">R$ 85.420,50</div>
                        </div>
                        <div class="panel-body">
                            <ul class="item-list" id="listaExtrato"></ul>
                        </div>
                    </div>
                </div>

                <!-- Histórico de Conciliações -->
                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-history"></i> Histórico de Conciliações</h3>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Data Conciliação</th>
                                <th>Lançamento Sistema</th>
                                <th>Lançamento Extrato</th>
                                <th>Valor</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="historicoConciliacoes"></tbody>
                    </table>
                </div>
            </div>
            </div> <!-- /main-content -->

        </main>
    </div>

    <!-- Modal Importar OFX -->
    <div class="modal-overlay-padrao" id="modalImportar">
        <div class="modal-padrao modal-padrao--sm">
            <div class="modal-header-padrao">
                <div class="modal-header-content-padrao">
                    <div class="modal-header-icon-padrao">
                        <i class="fas fa-file-import"></i>
                    </div>
                    <div class="modal-header-text-padrao">
                        <h2>Importar Extrato</h2>
                        <p>Importe seu extrato bancário</p>
                    </div>
                </div>
                <button class="modal-close-padrao" onclick="fecharModal('modalImportar')"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-padrao">
                <div class="upload-area" onclick="document.getElementById('arquivoOFX').click()">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <h4>Arraste o arquivo ou clique para selecionar</h4>
                    <p>Formatos aceitos: OFX, QIF, CSV</p>
                    <input type="file" id="arquivoOFX" accept=".ofx,.qif,.csv" onchange="processarArquivo(this)">
                </div>
                <div id="arquivoInfo" class="arquivo-info">
                    <p><i class="fas fa-file"></i> <span id="nomeArquivo"></span></p>
                </div>
            </div>
            <div class="modal-footer-padrao">
                <button class="btn-padrao-ghost" onclick="fecharModal('modalImportar')">Cancelar</button>
                <button class="btn-padrao-primary" onclick="importarExtrato()"><i class="fas fa-upload"></i> Importar</button>
            </div>
        </div>
    </div>

    <script>
        // Toast notification profissional
        function mostrarToastFinanceiro(mensagem, tipo) {
            if (typeof window.mostrarToastFinanceiro === 'function' && window.mostrarToastFinanceiro !== mostrarToastFinanceiro) {
                window.mostrarToastFinanceiro(mensagem, tipo);
                return;
            }
            const existing = document.querySelector('.toast-financeiro-inline');
            if (existing) existing.remove();
            const colors = { success: '#10b981', error: '#ef4444', warning: '#f59e0b', info: '#3b82f6' };
            const icons = { success: 'fa-check-circle', error: 'fa-times-circle', warning: 'fa-exclamation-triangle', info: 'fa-info-circle' };
            const c = colors[tipo] || colors.info;
            const ic = icons[tipo] || icons.info;
            const toast = document.createElement('div');
            toast.className = 'toast-financeiro-inline';
            toast.innerHTML = `<i class="fas ${ic}"></i> ${mensagem}`;
            Object.assign(toast.style, {
                position: 'fixed', bottom: '24px', right: '24px', zIndex: '999999',
                background: c, color: '#fff', padding: '14px 22px', borderRadius: '12px',
                fontSize: '13px', fontFamily: 'Inter, sans-serif', fontWeight: '500',
                boxShadow: '0 8px 24px rgba(0,0,0,0.2)', display: 'flex', alignItems: 'center',
                gap: '10px', opacity: '0', transform: 'translateY(10px)', transition: 'all 0.3s ease',
                maxWidth: '420px'
            });
            document.body.appendChild(toast);
            requestAnimationFrame(() => { toast.style.opacity = '1'; toast.style.transform = 'translateY(0)'; });
            setTimeout(() => { toast.style.opacity = '0'; toast.style.transform = 'translateY(10px)'; setTimeout(() => toast.remove(), 300); }, 4000);
        }

        // Dados
        let lancamentosSistema = [
            { id: 1, data: '2024-12-20', descricao: 'Recebimento Cliente ABC', tipo: 'entrada', valor: 15000, conciliado: false },
            { id: 2, data: '2024-12-19', descricao: 'Pagamento Fornecedor XYZ', tipo: 'saida', valor: 8500, conciliado: true, extratoId: 2 },
            { id: 3, data: '2024-12-18', descricao: 'Venda Projeto Residencial', tipo: 'entrada', valor: 22000, conciliado: true, extratoId: 3 },
            { id: 4, data: '2024-12-17', descricao: 'Conta de Energia', tipo: 'saida', valor: 1850, conciliado: false },
            { id: 5, data: '2024-12-16', descricao: 'Folha de Pagamento', tipo: 'saida', valor: 28750, conciliado: true, extratoId: 5 },
            { id: 6, data: '2024-12-15', descricao: 'Recebimento Parcela', tipo: 'entrada', valor: 8500, conciliado: false },
            { id: 7, data: '2024-12-14', descricao: 'Material de Escritório', tipo: 'saida', valor: 450, conciliado: false },
        ];

        let lancamentosExtrato = [
            { id: 1, data: '2024-12-20', descricao: 'TED RECEBIDA - CLIENTE ABC LTDA', tipo: 'entrada', valor: 15000, conciliado: false },
            { id: 2, data: '2024-12-19', descricao: 'PAG FORNEC XYZ', tipo: 'saida', valor: 8500, conciliado: true, sistemaId: 2 },
            { id: 3, data: '2024-12-18', descricao: 'DEP CHEQUE', tipo: 'entrada', valor: 22000, conciliado: true, sistemaId: 3 },
            { id: 4, data: '2024-12-17', descricao: 'DEB AUT ELETROPAULO', tipo: 'saida', valor: 1850, conciliado: false },
            { id: 5, data: '2024-12-16', descricao: 'TRANSF SALARIOS', tipo: 'saida', valor: 28750, conciliado: true, sistemaId: 5 },
            { id: 6, data: '2024-12-15', descricao: 'TAXA DOC/TED', tipo: 'saida', valor: 12.50, conciliado: false },
            { id: 7, data: '2024-12-14', descricao: 'IOF', tipo: 'saida', valor: 35.80, conciliado: false },
        ];

        let historico = [
            { id: 1, data: '2024-12-19', sistemaDesc: 'Pagamento Fornecedor XYZ', extratoDesc: 'PAG FORNEC XYZ', valor: 8500, status: 'conciliado' },
            { id: 2, data: '2024-12-18', sistemaDesc: 'Venda Projeto Residencial', extratoDesc: 'DEP CHEQUE', valor: 22000, status: 'conciliado' },
            { id: 3, data: '2024-12-16', sistemaDesc: 'Folha de Pagamento', extratoDesc: 'TRANSF SALARIOS', valor: 28750, status: 'conciliado' },
        ];

        let sistemasSelecionados = [];
        let extratosSelecionados = [];

        // Init
        document.addEventListener('DOMContentLoaded', function() {
            // Set date filters to current month
            const now = new Date();
            const y = now.getFullYear();
            const m = String(now.getMonth() + 1).padStart(2, '0');
            const lastDay = new Date(y, now.getMonth() + 1, 0).getDate();
            document.getElementById('dataInicio').value = `${y}-${m}-01`;
            document.getElementById('dataFim').value = `${y}-${m}-${String(lastDay).padStart(2, '0')}`;
            
            carregarUsuario();
            atualizarKPIs();
            renderizarListas();
            renderizarHistorico();
        });

        async function carregarUsuario() {
            try {
                const response = await fetch('/api/me', { credentials: 'include' });
                if (response.ok) {
                    const user = await response.json();
                    // Usar apelido se disponível, senão primeiro nome
                    const userName = user.apelido || user.nome || 'Usuário';
                    const primeiroNome = user.apelido || (user.nome ? user.nome.split(' ')[0] : 'Usuário');

                    // Atualizar Saudação dinâmica baseada na hora
                    const greetingTextEl = document.getElementById('greeting-text');
                    if (greetingTextEl) {
                        const hour = new Date().getHours();
                        let greeting = 'Bom dia';
                        if (hour >= 12 && hour < 18) greeting = 'Boa tarde';
                        else if (hour >= 18 || hour < 5) greeting = 'Boa noite';
                        greetingTextEl.textContent = greeting;
                    }
                    document.getElementById('user-name').textContent = primeiroNome;
                    document.getElementById('user-initials').textContent = primeiroNome.charAt(0).toUpperCase();
                    
                    const fotoUrl = user.avatar || user.foto || user.foto_perfil_url;
                    const foto = document.getElementById('user-photo');
                    const inicialEl = document.getElementById('user-initials');
                    if (fotoUrl && fotoUrl !== '/avatars/default.webp') {
                        foto.src = fotoUrl;
                        foto.onload = () => { foto.style.display = 'block'; foto.classList.add('visible'); if (inicialEl) inicialEl.style.display = 'none'; };
                        foto.onerror = () => { foto.style.display = 'none'; if (inicialEl) { inicialEl.textContent = primeiroNome.charAt(0).toUpperCase(); inicialEl.style.display = 'flex'; } };
                    }
                }
            } catch (e) { console.log('Erro ao carregar usuário'); }
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor);
        }

        function formatarData(data) {
            if (!data) return '-';
            try {
                const d = new Date(data);
                if (!isNaN(d.getTime())) {
                    return d.toLocaleDateString('pt-BR');
                }
                const d2 = new Date(data + 'T00:00:00');
                if (!isNaN(d2.getTime())) {
                    return d2.toLocaleDateString('pt-BR');
                }
                return '-';
            } catch (e) {
                return '-';
            }
        }

        function atualizarKPIs() {
            const conciliados = lancamentosSistema.filter(l => l.conciliado).length;
            const pendentesSistema = lancamentosSistema.filter(l => !l.conciliado).length;
            const pendentesExtrato = lancamentosExtrato.filter(l => !l.conciliado).length;
            
            // Calcular divergências (itens no extrato sem correspondente no sistema)
            const divergencias = lancamentosExtrato.filter(e => !e.conciliado && !lancamentosSistema.some(s => s.valor === e.valor && !s.conciliado)).length;

            document.getElementById('totalConciliados').textContent = conciliados;
            document.getElementById('pendentesSistema').textContent = pendentesSistema;
            document.getElementById('pendentesExtrato').textContent = pendentesExtrato;
            document.getElementById('divergencias').textContent = divergencias;
        }

        function renderizarListas() {
            // Sistema
            const listaSistema = document.getElementById('listaSistema');
            listaSistema.innerHTML = lancamentosSistema.map(item => `
                <li class="item-row ${item.conciliado ? 'conciliado' : ''} ${sistemasSelecionados.includes(item.id) ? 'selected' : ''}" 
                    onclick="toggleSelecaoSistema(${item.id})" style="position: relative;">
                    <div class="item-check ${sistemasSelecionados.includes(item.id) ? 'checked' : ''}">
                        ${sistemasSelecionados.includes(item.id) ? '<i class="fas fa-check" style="font-size:12px;"></i>' : ''}
                    </div>
                    <div class="item-info">
                        <div class="data">${formatarData(item.data)}</div>
                        <div class="descricao">${item.descricao}</div>
                    </div>
                    <div class="item-valor ${item.tipo}">
                        ${item.tipo === 'entrada' ? '+' : '-'}${formatarMoeda(item.valor)}
                    </div>
                </li>
            `).join('');

            // Extrato
            const listaExtrato = document.getElementById('listaExtrato');
            listaExtrato.innerHTML = lancamentosExtrato.map(item => `
                <li class="item-row ${item.conciliado ? 'conciliado' : ''} ${extratosSelecionados.includes(item.id) ? 'selected' : ''}"
                    onclick="toggleSelecaoExtrato(${item.id})" style="position: relative;">
                    <div class="item-check ${extratosSelecionados.includes(item.id) ? 'checked' : ''}">
                        ${extratosSelecionados.includes(item.id) ? '<i class="fas fa-check" style="font-size:12px;"></i>' : ''}
                    </div>
                    <div class="item-info">
                        <div class="data">${formatarData(item.data)}</div>
                        <div class="descricao">${item.descricao}</div>
                    </div>
                    <div class="item-valor ${item.tipo}">
                        ${item.tipo === 'entrada' ? '+' : '-'}${formatarMoeda(item.valor)}
                    </div>
                </li>
            `).join('');
        }

        function renderizarHistorico() {
            const tbody = document.getElementById('historicoConciliacoes');
            tbody.innerHTML = historico.map(item => `
                <tr>
                    <td>${formatarData(item.data)}</td>
                    <td>${item.sistemaDesc}</td>
                    <td>${item.extratoDesc}</td>
                    <td><strong>${formatarMoeda(item.valor)}</strong></td>
                    <td><span class="status-badge ${item.status}">${item.status === 'conciliado' ? 'Conciliado' : 'Divergente'}</span></td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="desconciliar(${item.id})">
                            <i class="fas fa-unlink"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function toggleSelecaoSistema(id) {
            const item = lancamentosSistema.find(l => l.id === id);
            if (item.conciliado) return;
            
            const index = sistemasSelecionados.indexOf(id);
            if (index > -1) {
                sistemasSelecionados.splice(index, 1);
            } else {
                sistemasSelecionados.push(id);
            }
            renderizarListas();
        }

        function toggleSelecaoExtrato(id) {
            const item = lancamentosExtrato.find(l => l.id === id);
            if (item.conciliado) return;
            
            const index = extratosSelecionados.indexOf(id);
            if (index > -1) {
                extratosSelecionados.splice(index, 1);
            } else {
                extratosSelecionados.push(id);
            }
            renderizarListas();
        }

        function conciliarSelecionados() {
            if (sistemasSelecionados.length === 0 || extratosSelecionados.length === 0) {
                mostrarToastFinanceiro('Selecione pelo menos um item de cada lado para conciliar', 'warning');
                return;
            }

            // Conciliar os itens selecionados
            sistemasSelecionados.forEach(sId => {
                const sis = lancamentosSistema.find(l => l.id === sId);
                if (sis) {
                    sis.conciliado = true;
                    sis.extratoId = extratosSelecionados[0];
                }
            });

            extratosSelecionados.forEach(eId => {
                const ext = lancamentosExtrato.find(l => l.id === eId);
                if (ext) {
                    ext.conciliado = true;
                    ext.sistemaId = sistemasSelecionados[0];
                }
            });

            // Adicionar ao historico
            const sis = lancamentosSistema.find(l => l.id === sistemasSelecionados[0]);
            const ext = lancamentosExtrato.find(l => l.id === extratosSelecionados[0]);
            if (sis && ext) {
                historico.unshift({
                    id: historico.length + 1,
                    data: new Date().toISOString().split('T')[0],
                    sistemaDesc: sis.descricao,
                    extratoDesc: ext.descricao,
                    valor: sis.valor,
                    status: 'conciliado'
                });
            }

            // Limpar seleções
            sistemasSelecionados = [];
            extratosSelecionados = [];

            atualizarKPIs();
            renderizarListas();
            renderizarHistorico();
            mostrarToastFinanceiro('Lançamentos conciliados com sucesso!', 'success');
        }

        function desconciliarSelecionados() {
            mostrarToastFinanceiro('Selecione um item conciliado no histórico para desfazer', 'info');
        }

        function conciliarAutomatico() {
            let conciliados = 0;

            // Encontrar correspondências por valor e data próxima
            lancamentosSistema.filter(s => !s.conciliado).forEach(sis => {
                const match = lancamentosExtrato.find(ext => 
                    !ext.conciliado && 
                    ext.valor === sis.valor && 
                    ext.tipo === sis.tipo
                );

                if (match) {
                    sis.conciliado = true;
                    sis.extratoId = match.id;
                    match.conciliado = true;
                    match.sistemaId = sis.id;

                    historico.unshift({
                        id: historico.length + 1,
                        data: new Date().toISOString().split('T')[0],
                        sistemaDesc: sis.descricao,
                        extratoDesc: match.descricao,
                        valor: sis.valor,
                        status: 'conciliado'
                    });

                    conciliados++;
                }
            });

            atualizarKPIs();
            renderizarListas();
            renderizarHistorico();
            mostrarToastFinanceiro(`Conciliação automática concluída! ${conciliados} lançamento(s) conciliado(s).`, conciliados > 0 ? 'success' : 'info');
        }

        async function desconciliar(id) {
            // Modal de confirmação profissional
            const confirmado = await showConfirmModal({
                type: 'warning',
                title: 'Desfazer Conciliação',
                message: 'Deseja realmente desfazer esta conciliação?',
                confirmText: 'Desfazer',
                cancelText: 'Cancelar'
            });
            if (confirmado) {
                const item = historico.find(h => h.id === id);
                if (item) {
                    // Encontrar e desconciliar
                    const sis = lancamentosSistema.find(s => s.descricao === item.sistemaDesc);
                    const ext = lancamentosExtrato.find(e => e.descricao === item.extratoDesc);
                    
                    if (sis) {
                        sis.conciliado = false;
                        delete sis.extratoId;
                    }
                    if (ext) {
                        ext.conciliado = false;
                        delete ext.sistemaId;
                    }

                    // Remover do historico
                    historico = historico.filter(h => h.id !== id);

                    atualizarKPIs();
                    renderizarListas();
                    renderizarHistorico();
                }
            }
        }

        function aplicarFiltros() {
            // Implementar filtros
            console.log('Filtros aplicados');
            renderizarListas();
        }

        function abrirModalImportar() {
            document.getElementById('modalImportar').classList.add('active');
        }

        function fecharModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        function processarArquivo(input) {
            if (input.files.length > 0) {
                document.getElementById('arquivoInfo').style.display = 'block';
                document.getElementById('nomeArquivo').textContent = input.files[0].name;
            }
        }

        function importarExtrato() {
            const arquivo = document.getElementById('arquivoOFX').files[0];
            if (!arquivo) {
                mostrarToastFinanceiro('Selecione um arquivo para importar', 'warning');
                return;
            }

            // Simular importação
            fecharModal('modalImportar');
            mostrarToastFinanceiro('Extrato importado com sucesso!', 'success');
            
            // Adicionar alguns lançamentos de exemplo
            lancamentosExtrato.push(
                { id: 8, data: '2024-12-21', descricao: 'PIX RECEBIDO', tipo: 'entrada', valor: 3500, conciliado: false },
                { id: 9, data: '2024-12-21', descricao: 'TARIFA MANUT CONTA', tipo: 'saida', valor: 28.50, conciliado: false }
            );

            atualizarKPIs();
            renderizarListas();
        }

        // Sistema de Notificações gerenciado pelo NotificationsManager global
    </script>

    <script src="financeiro.js"></script>
    <script src="public/js/financeiro-user-loader.js?v=20251227"></script>
    
    <!-- Sistema de Notificações Global -->
    <script src="/js/notifications-manager.js?v=20251227"></script>
    <script src="/js/notification-button.js?v=20251227"></script>
    
    <!-- Sistema de Chat e Suporte -->
    <script src="/js/chat-suporte-widgets.js?v=20260103"></script>
    
    <!-- Sistema de Monitoramento de Conexão -->
    <script src="../_shared/connection-monitor.js?v=20251227"></script>
    <script src="/js/popup-confirmacao.js"></script>
    <script src="/js/confirm-modal.js?v=20260110"></script>
    <script src="public/js/financeiro-shared.js?v=20260217"></script>
    <!-- Sidebar + Header RBAC Component -->
    <script src="js/financeiro-sidebar.js?v=20260211"></script>
    <script src="/js/mobile-auto-enhance.js?v=20260202" defer></script>
    <!-- Chat Widget BOB AI -->
    <script src="/chat/widget.js?v=20260218" defer></script>
    <script src="/_shared/accessibility-widget.js?v=20260226"></script>
</body>
</html>








