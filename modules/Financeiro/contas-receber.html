<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#1a1a2e">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Aluforce: Contas a Receber</title>

    <!-- Autenticacao -->
    <script src="/js/auth-unified.js?v=20260211" defer></script>

    <!-- Fonte Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">

    <!-- Financeiro Design System -->
    <link rel="stylesheet" href="css/fin-layout.css?v=20260215">
    <link rel="stylesheet" href="css/fin-components.css?v=20260215">

    <!-- XLSX Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
    :root {
        --primary-orange: #225cfa;
        --primary-dark: #1a1a2e;
        --bg-gray: #f8fafc;
        --border-color: #e2e8f0;
        --text-primary: #1e293b;
        --text-secondary: #64748b;
        --success: #22c55e;
        --warning: #f59e0b;
        --danger: #ef4444;
        --info: #3b82f6;
    }

        /* Botão Importar */
        .btn-importar {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }
        .btn-importar:hover {
            background: linear-gradient(135deg, #047857 0%, #065f46 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(5, 150, 105, 0.3);
        }
/* SIDEBAR */
.sidebar-logo i { color: white; font-size: 18px; }
.sidebar-btn { width: 40px; height: 40px; border: none; background: transparent; color: #8b8b9a; border-radius: 10px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 18px; transition: all 0.2s; }
        .sidebar-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .sidebar-btn.active { background: var(--primary-blue); color: white; }
        .sidebar-bottom { margin-top: auto; display: flex; flex-direction: column; gap: 4px; }

        /* MAIN */
/* HEADER */
.header-brand img { height: 24px; }
        .header-brand span { font-size: 14px; font-weight: 600; color: #8b8b9a; }
.header-btn { width: 36px; height: 36px; border: none; background: transparent; color: #8b8b9a; border-radius: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: all 0.2s; position: relative; }
        .header-btn:hover { background: rgba(255,255,255,0.1); color: white; }
        .header-btn .notification-badge { position: absolute; top: 4px; right: 4px; min-width: 16px; height: 16px; background: #ef4444; border-radius: 10px; color: white; font-size: 10px; font-weight: 600; display: flex; align-items: center; justify-content: center; padding: 0 4px; }
        .notification-container { position: relative; }
        .notification-panel { position: absolute; top: calc(100% + 12px); right: 0; width: 380px; max-height: 500px; background: white; border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); z-index: 10000; display: none; overflow: hidden; }
        .notification-panel.active { display: block; }
        .notification-header { display: flex; justify-content: space-between; align-items: center; padding: 16px 20px; background: linear-gradient(135deg, #84cc16, #65a30d); color: white; }
        .notification-header h3 { margin: 0; font-size: 16px; font-weight: 600; }
        .notification-list { max-height: 340px; overflow-y: auto; }
        .notification-item { display: flex; gap: 12px; padding: 14px 20px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: all 0.2s; }
        .notification-item:hover { background: #f8f8f8; }
        .notification-item.unread { background: #f0fdf4; border-left: 3px solid #84cc16; }
        .notification-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .notification-icon.success { background: #dcfce7; color: #22c55e; }
        .notification-icon.warning { background: #fef3c7; color: #f59e0b; }
        .notification-icon.error { background: #fee2e2; color: #ef4444; }
        .notification-icon.info { background: #dbeafe; color: #3b82f6; }
        .notification-content { flex: 1; }
        .notification-title { font-size: 13px; font-weight: 600; color: #333; margin-bottom: 4px; }
        .notification-message { font-size: 12px; color: #666; }
        .notification-time { font-size: 11px; color: #999; margin-top: 6px; }
        .notification-footer { padding: 12px 20px; background: #f8f8f8; text-align: center; border-top: 1px solid #e5e5e5; }
        .notification-footer a { color: #84cc16; text-decoration: none; font-size: 13px; font-weight: 500; }
        .user-greeting { display: flex; align-items: center; gap: 12px; margin-left: 16px; color: #8b8b9a; font-size: 13px; }
        .user-greeting strong { color: white; }
.user-avatar img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .user-avatar img.visible { display: block; }
        .user-avatar .user-initial { display: block; }
        .user-avatar img.visible + .user-initial { display: none; }

        /* PAGE CONTENT - DESIGN PREMIUM */
        .page-content { 
            flex: 1; 
            overflow-y: auto; 
            padding: 28px 32px; 
            background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%);
            animation: fadeInContent 0.4s ease-out;
        }
        @keyframes fadeInContent {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Animação escalonada para KPIs e Cards */
        .kpi-grid .kpi-card { animation: slideInUp 0.5s ease-out backwards; }
        .kpi-grid .kpi-card:nth-child(1) { animation-delay: 0.05s; }
        .kpi-grid .kpi-card:nth-child(2) { animation-delay: 0.1s; }
        .kpi-grid .kpi-card:nth-child(3) { animation-delay: 0.15s; }
        .kpi-grid .kpi-card:nth-child(4) { animation-delay: 0.2s; }
        @keyframes slideInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .filters-section { animation: slideInUp 0.5s ease-out backwards; animation-delay: 0.25s; }
        .table-container { animation: slideInUp 0.5s ease-out backwards; animation-delay: 0.3s; }

        /* PAGE HEADER */
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 28px; }
        .page-title-section h1 { font-size: 26px; font-weight: 700; display: flex; align-items: center; gap: 14px; margin-bottom: 6px; letter-spacing: -0.5px; }
        .page-title-section h1 i { color: var(--success); font-size: 28px; }
        .page-title-section p { font-size: 14px; color: var(--text-secondary); font-weight: 400; }
        .page-actions { display: flex; gap: 14px; }
        .btn { 
            display: inline-flex; 
            align-items: center; 
            gap: 10px; 
            padding: 12px 24px; 
            border-radius: 12px; 
            font-size: 14px; 
            font-weight: 600; 
            border: none; 
            cursor: pointer; 
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); 
            position: relative;
            overflow: hidden;
        }
        .btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.15) 0%, transparent 100%);
            opacity: 0;
            transition: opacity 0.2s;
        }
        .btn:hover::before { opacity: 1; }
        .btn-primary { background: linear-gradient(135deg, var(--primary-blue), #65a30d); color: white; box-shadow: 0 2px 8px rgba(132, 204, 22, 0.25); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(132, 204, 22, 0.4); }
        .btn-success { background: linear-gradient(135deg, var(--success), #16a34a); color: white; box-shadow: 0 2px 8px rgba(34, 197, 94, 0.25); }
        .btn-success:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4); }
        .btn-secondary { 
            background: white; 
            color: var(--text-primary); 
            border: 1px solid var(--border-color); 
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .btn-secondary:hover { 
            background: #f8fafc; 
            border-color: #cbd5e1; 
            transform: translateY(-2px); 
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        /* KPI CARDS - DESIGN PREMIUM - IGUAL AO CONTAS A PAGAR */
        .stats-grid, .kpi-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px; }
        .stat-card, .kpi-card { 
            background: white; 
            border-radius: 20px; 
            padding: 24px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 4px 20px rgba(0,0,0,0.03); 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(0,0,0,0.04);
        }
        .stat-card::before, .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--success), #16a34a);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .stat-card:hover, .kpi-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.12);
        }
        .stat-card:hover::before, .kpi-card:hover::before { opacity: 1; }
        .stat-card h3 { font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 500; letter-spacing: 0.3px; text-transform: uppercase; }
        .stat-card .value, .kpi-value { font-size: 28px; font-weight: 700; letter-spacing: -0.5px; }
        .stat-card .value.green, .kpi-value.green { color: var(--success); }
        .stat-card .value.red, .kpi-value.red { color: var(--danger); }
        .stat-card .value.blue, .kpi-value.blue { color: var(--info); }
        .stat-card .value.yellow, .kpi-value.yellow { color: var(--warning); }
        .kpi-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 16px; }
        .kpi-icon { 
            width: 52px; 
            height: 52px; 
            border-radius: 14px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 22px; 
            transition: transform 0.3s ease;
        }
        .kpi-card:hover .kpi-icon { transform: scale(1.1); }
        .kpi-icon.green { background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(34,197,94,0.05)); color: var(--success); }
        .kpi-icon.red { background: linear-gradient(135deg, rgba(239,68,68,0.15), rgba(239,68,68,0.05)); color: var(--danger); }
        .kpi-icon.orange { background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(245,158,11,0.05)); color: var(--warning); }
        .kpi-icon.blue { background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(59,130,246,0.05)); color: var(--info); }
        .kpi-content h3 { font-size: 13px; color: var(--text-secondary); margin-bottom: 8px; font-weight: 500; letter-spacing: 0.3px; }

        /* FILTERS - DESIGN PREMIUM */
        .filters-section { 
            background: white; 
            border-radius: 16px; 
            padding: 16px 20px; 
            margin-bottom: 20px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 4px 20px rgba(0,0,0,0.03); 
            border: 1px solid rgba(0,0,0,0.04);
        }
        .filters-row { 
            display: flex; 
            gap: 12px; 
            align-items: center; 
            flex-wrap: nowrap; 
        }
        .search-box { 
            display: flex; 
            align-items: center; 
            background: var(--bg-gray); 
            border-radius: 10px; 
            padding: 0 14px; 
            flex: 1; 
            min-width: 180px;
            max-width: 320px; 
            border: 1.5px solid transparent;
            transition: all 0.2s ease;
        }
        .search-box:focus-within { 
            border-color: var(--success); 
            background: white; 
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1);
        }
        .search-box i { color: var(--text-secondary); transition: color 0.2s; font-size: 13px; }
        .search-box:focus-within i { color: var(--success); }
        .search-box input { border: none; background: transparent; padding: 10px 12px; font-size: 13px; width: 100%; outline: none; }
        .filter-group { 
            display: flex !important; 
            flex-direction: row !important; 
            align-items: center !important; 
            gap: 6px; 
            flex-shrink: 0;
        }
        .filter-btn { 
            padding: 8px 14px; 
            border: 1px solid var(--border-color); 
            background: white; 
            border-radius: 8px; 
            font-size: 12.5px; 
            font-weight: 500; 
            cursor: pointer; 
            transition: all 0.2s; 
            display: flex; 
            align-items: center; 
            gap: 6px; 
            white-space: nowrap;
        }
        .filter-btn:hover { background: var(--bg-gray); transform: translateY(-1px); }
        .filter-btn.active { 
            background: linear-gradient(135deg, var(--success), #16a34a); 
            color: white; 
            border-color: transparent; 
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.35);
        }
        .filter-select { 
            padding: 9px 12px; 
            border: 1px solid var(--border-color); 
            border-radius: 8px; 
            font-size: 12.5px; 
            background: white; 
            cursor: pointer; 
            min-width: 160px; 
            transition: all 0.2s;
            margin-left: auto;
            flex-shrink: 0;
        }
        .filter-select:focus { border-color: var(--success); outline: none; box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1); }

        /* Responsive Filters */
        @media (max-width: 1100px) {
            .filters-row { flex-wrap: wrap; }
            .search-box { max-width: 100%; order: 1; flex-basis: 100%; }
            .filter-group { order: 2; }
            .filter-select { order: 3; margin-left: 0; }
        }

        /* TABLE - DESIGN PREMIUM */
        .table-container { 
            background: white; 
            border-radius: 20px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 4px 20px rgba(0,0,0,0.03); 
            overflow: hidden; 
            border: 1px solid rgba(0,0,0,0.04);
        }
        .table-header { 
            padding: 24px 28px; 
            border-bottom: 1px solid var(--border-color); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: linear-gradient(180deg, #fafafa 0%, white 100%);
        }
        .table-header h3 { font-size: 16px; font-weight: 600; display: flex; align-items: center; gap: 12px; color: var(--text-primary); }
        .table-header h3 i { color: var(--success); font-size: 18px; }
        .table-actions { display: flex; gap: 8px; }
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { 
            background: linear-gradient(180deg, #f8fafc 0%, #f1f5f9 100%); 
            padding: 16px 20px; 
            text-align: left; 
            font-size: 11px; 
            font-weight: 600; 
            color: var(--text-secondary); 
            text-transform: uppercase; 
            letter-spacing: 0.5px;
        }
        .data-table td { padding: 18px 20px; border-bottom: 1px solid #f1f5f9; font-size: 13px; }
        .data-table tr { transition: all 0.15s ease; }
        .data-table tr:hover { background: linear-gradient(90deg, rgba(34, 197, 94, 0.03), transparent); }
        .data-table tr:last-child td { border-bottom: none; }

        /* STATUS - DESIGN PREMIUM */
        .status-badge { 
            display: inline-flex; 
            align-items: center; 
            gap: 6px; 
            padding: 8px 14px; 
            border-radius: 10px; 
            font-size: 11px; 
            font-weight: 600; 
            letter-spacing: 0.3px;
            transition: all 0.2s ease;
        }
        .status-badge.pendente { background: linear-gradient(135deg, #fef3c7, #fde68a); color: #92400e; }
        .status-badge.recebido { background: linear-gradient(135deg, #dcfce7, #bbf7d0); color: #166534; }
        .status-badge.vencido { background: linear-gradient(135deg, #fee2e2, #fecaca); color: #991b1b; }
        .status-badge.parcial { background: linear-gradient(135deg, #dbeafe, #bfdbfe); color: #1e40af; }

        /* ========================================
           MODAL VISUALIZAR - DESIGN SAAS EMPRESARIAL
           ======================================== */
        .modal-visualizar-saas {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            animation: modalFadeIn 0.25s ease-out;
        }
        
        .modal-close-saas:hover {
            background: #e5e7eb !important;
        }
        .modal-close-saas:hover i {
            color: #374151 !important;
        }
        
        /* Botes SaaS */
        .btn-saas {
            font-family: inherit;
            transition: all 0.2s ease;
        }
        .btn-saas:hover {
            transform: translateY(-1px);
        }
        .btn-saas-ghost:hover {
            background: #f9fafb !important;
            border-color: #d1d5db !important;
            color: #374151 !important;
        }
        .btn-saas-secondary:hover {
            background: #e5e7eb !important;
            color: #1f2937 !important;
        }
        .btn-saas-primary:hover {
            box-shadow: 0 6px 16px rgba(34, 197, 94, 0.5) !important;
        }
        
        /* Badge de Status SaaS */
        .status-badge-saas {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }
        .status-badge-saas.pendente {
            background: #fef3c7;
            color: #92400e;
        }
        .status-badge-saas.vencido {
            background: #fee2e2;
            color: #991b1b;
        }
        .status-badge-saas.recebido {
            background: #d1fae5;
            color: #065f46;
        }
        .status-badge-saas.parcial {
            background: #e0e7ff;
            color: #3730a3;
        }
        
        /* Animação de entrada do modal */
        @keyframes modalFadeIn {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(-10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* ACTIONS - DESIGN PREMIUM */
        .btn-action { 
            width: 38px; 
            height: 38px; 
            border: none; 
            border-radius: 10px; 
            cursor: pointer; 
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1); 
            margin-right: 6px; 
            position: relative;
            overflow: hidden;
        }
        .btn-action::before {
            content: '';
            position: absolute;
            inset: 0;
            background: currentColor;
            opacity: 0;
            transition: opacity 0.2s;
        }
        .btn-action:hover::before { opacity: 0.1; }
        .btn-action.view { background: linear-gradient(135deg, #dbeafe, #bfdbfe); color: #2563eb; }
        .btn-action.edit { background: linear-gradient(135deg, #fef3c7, #fde68a); color: #d97706; }
        .btn-action.receive { background: linear-gradient(135deg, #dcfce7, #bbf7d0); color: #16a34a; }
        .btn-action.delete { background: linear-gradient(135deg, #fee2e2, #fecaca); color: #dc2626; }
        .btn-action:hover { transform: translateY(-2px) scale(1.08); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }

        /* PAGINATION - DESIGN PREMIUM */
        .table-pagination { 
            padding: 20px 28px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            border-top: 1px solid var(--border-color); 
            background: linear-gradient(180deg, white 0%, #fafafa 100%);
        }
        .pagination-info { font-size: 13px; color: var(--text-secondary); font-weight: 500; }
        .pagination-controls { display: flex; gap: 6px; }
        .pagination-btn { 
            width: 38px; 
            height: 38px; 
            border: 1px solid var(--border-color); 
            background: white; 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 13px; 
            font-weight: 600;
            display: flex; 
            align-items: center; 
            justify-content: center; 
            transition: all 0.2s ease;
        }
        .pagination-btn:hover { background: var(--bg-gray); transform: translateY(-1px); }
        .pagination-btn.active { 
            background: linear-gradient(135deg, var(--success), #16a34a); 
            color: white; 
            border-color: transparent; 
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.35);
        }

        /* MODAL SAAS EMPRESARIAL - ALTA PRIORIDADE */
        #modalConta, #modalReceber, #modalVisualizarConta { position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; bottom: 0 !important; background: rgba(15,23,42,0.7) !important; display: none !important; align-items: center !important; justify-content: center !important; z-index: 99999 !important; backdrop-filter: blur(6px); }
        #modalConta.active, #modalReceber.active, #modalVisualizarConta.active { display: flex !important; }
        #modalConta > .modal, #modalReceber > .modal, #modalVisualizarConta > .modal { position: relative !important; display: flex !important; flex-direction: column !important; background: white !important; border-radius: 20px !important; width: 100% !important; max-width: 720px !important; min-height: 580px !important; max-height: 90vh !important; overflow: hidden !important; margin: 20px !important; inset: auto !important; top: auto !important; left: auto !important; right: auto !important; bottom: auto !important; height: auto !important; box-shadow: 0 25px 80px rgba(0,0,0,0.25), 0 10px 30px rgba(0,0,0,0.15) !important; animation: modalFadeIn 0.25s ease-out !important; }
        #modalReceber > .modal { max-width: 720px !important; min-height: 580px !important; }
        #modalVisualizarConta > .modal { max-width: 720px !important; min-height: 580px !important; }
        @keyframes modalFadeIn { from { opacity: 0; transform: scale(0.95) translateY(-10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        
        /* MODAL HEADER SAAS */
        .modal-header-saas { background: #ffffff; padding: 28px 32px; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; justify-content: space-between; gap: 20px; }
        .modal-header-saas .header-left { display: flex; align-items: center; gap: 16px; flex: 1; }
        .modal-header-saas .header-icon { width: 52px; height: 52px; min-width: 52px; border-radius: 14px; display: flex; align-items: center; justify-content: center; }
        .modal-header-saas .header-icon i { color: white; font-size: 22px; }
        .modal-header-saas h2 { margin: 0; font-size: 20px; font-weight: 700; color: #111827; }
        .modal-header-saas .subtitle { font-size: 14px; color: #6b7280; margin-top: 2px; }
        .modal-close-saas { width: 44px; height: 44px; min-width: 44px; border: none; background: #f3f4f6; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .modal-close-saas:hover { background: #e5e7eb; }
        .modal-close-saas i { color: #6b7280; font-size: 18px; }
        
        /* MODAL BODY/FOOTER SAAS */
        .modal-body-saas { padding: 28px 32px; overflow-y: auto; max-height: calc(92vh - 200px); background: #f9fafb; }
        .modal-footer-saas { padding: 24px 32px; border-top: 1px solid #e5e7eb; display: flex; justify-content: flex-end; gap: 14px; background: #ffffff; }
        
        /* BUTTONS SAAS */
        .btn-saas { padding: 14px 28px; border-radius: 12px; font-size: 15px; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 10px; }
        .btn-saas-ghost { border: 1px solid #e5e7eb; background: #ffffff; color: #6b7280; }
        .btn-saas-ghost:hover { background: #f3f4f6; }
        .btn-saas-primary { border: none; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; box-shadow: 0 4px 14px rgba(34, 197, 94, 0.4); }
        .btn-saas-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(34, 197, 94, 0.5); }
        
        /* FORM SAAS */
        .form-card-saas { background: #ffffff; border-radius: 16px; border: 1px solid #e5e7eb; padding: 24px; margin-bottom: 20px; }
        .form-grid-saas { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        .form-group-saas { margin-bottom: 20px; }
        .form-group-saas label { display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 600; color: #374151; margin-bottom: 10px; }
        .form-group-saas label i { color: #9ca3af; }
        .form-group-saas input, .form-group-saas select, .form-group-saas textarea { width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 15px; font-family: inherit; transition: all 0.2s; box-sizing: border-box; }
        .form-group-saas input:focus, .form-group-saas select:focus, .form-group-saas textarea:focus { outline: none; border-color: #22c55e; box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1); }
        
        /* STATUS BADGES SAAS */
        .status-badge-saas { display: inline-flex; align-items: center; gap: 8px; padding: 10px 16px; border-radius: 10px; font-size: 14px; font-weight: 600; }
        .status-badge-saas.pendente { background: #fef3c7; color: #92400e; }
        .status-badge-saas.vencido { background: #fee2e2; color: #991b1b; }
        .status-badge-saas.recebido, .status-badge-saas.pago { background: #dcfce7; color: #166534; }
        .status-badge-saas.parcial { background: #dbeafe; color: #1e40af; }
        
        /* MODAL ANTIGO - COMPATIBILIDADE */
        .modal-header { padding: 24px; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { font-size: 20px; font-weight: 700; display: flex; align-items: center; gap: 12px; }
        .modal-header h2 i { color: var(--success); }
        .modal-close { width: 36px; height: 36px; border: none; background: var(--bg-gray); border-radius: 8px; cursor: pointer; font-size: 18px; }
        .modal-body { padding: 24px; overflow-y: auto; max-height: calc(90vh - 180px); }
        .modal-footer { padding: 20px 24px; border-top: 1px solid var(--border-color); display: flex; justify-content: flex-end; gap: 12px; }

        /* FORM */
        .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-group.full { grid-column: span 2; }
        .form-group label { font-size: 13px; font-weight: 600; color: var(--text-primary); }
        .form-group input, .form-group select, .form-group textarea { padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; transition: all 0.2s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary-blue); box-shadow: 0 0 0 3px rgba(132,204,22,0.1); }
        .form-group textarea { resize: vertical; min-height: 80px; }

        /* RESPONSIVE */
        @media (max-width: 1400px) { .kpi-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .kpi-grid { grid-template-columns: 1fr; } .form-grid { grid-template-columns: 1fr; } .form-group.full { grid-column: span 1; } }

        /* MODAL PROFISSIONAL NOVA CONTA */
        .modal-conta-profissional { max-width: 800px; }
        .modal-conta-profissional .modal-header {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            padding: 20px 24px;
            border-bottom: none;
        }
        .modal-conta-profissional .modal-header h2 { color: white; font-size: 18px; }
        .modal-conta-profissional .modal-header h2 i { color: white; }
        .modal-conta-profissional .modal-close {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
        }
        .modal-conta-profissional .modal-close:hover {
            background: rgba(255,255,255,0.3);
        }
        .modal-conta-profissional .modal-body { padding: 0; }

        /* MODAL PROFISSIONAL STYLES - VERSO MELHORADA */
        .modal-profissional { max-width: 900px; }
        .modal-profissional .modal-header { 
            padding: 0; 
            background: linear-gradient(135deg, #84cc16 0%, #65a30d 50%, #4d7c0f 100%); 
            color: white; 
            position: relative; 
            overflow: hidden;
            border-bottom: none;
            box-shadow: 0 8px 32px rgba(132, 204, 22, 0.35);
            flex-shrink: 0;
        }
        .modal-profissional .modal-header::before { 
            content: ''; 
            position: absolute; 
            top: -100%; 
            right: -50%; 
            width: 100%; 
            height: 300%; 
            background: radial-gradient(ellipse, rgba(255,255,255,0.12) 0%, transparent 50%); 
            pointer-events: none;
        }
        .modal-profissional .modal-header::after { 
            content: ''; 
            position: absolute; 
            bottom: 0; 
            left: 0; 
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        }
        .modal-header-content { 
            padding: 20px 28px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            position: relative; 
            z-index: 1;
            gap: 16px;
        }
        .modal-header-left { display: flex; align-items: center; gap: 14px; flex: 1; min-width: 0; }
        .modal-header-text { flex: 1; min-width: 0; }
        .modal-header-text h2 { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .modal-header-icon { 
            width: 48px; 
            height: 48px; 
            background: rgba(255,255,255,0.18); 
            border-radius: 12px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 20px; 
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .modal-header-text h2 { font-size: 18px; font-weight: 700; margin: 0 0 2px 0; color: white; letter-spacing: -0.3px; }
        .modal-header-text p { font-size: 12px; color: rgba(255,255,255,0.75); margin: 0; font-weight: 400; }
        .modal-profissional .modal-close { 
            width: 36px; 
            height: 36px; 
            border: none; 
            background: rgba(255,255,255,0.12); 
            border-radius: 10px; 
            cursor: pointer; 
            font-size: 16px; 
            color: rgba(255,255,255,0.9); 
            transition: all 0.2s ease; 
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .modal-profissional .modal-close:hover { 
            background: rgba(255,255,255,0.22); 
            transform: scale(1.05);
            color: white;
        }
        
        /* MODAL STEPS/PROGRESS - VERSO MELHORADA */
        .modal-progress { 
            display: flex; 
            padding: 0; 
            background: rgba(0,0,0,0.12);
        }
        .modal-step, .modal-step-saas { 
            flex: 1; 
            padding: 12px 16px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            gap: 10px; 
            font-size: 12px; 
            font-weight: 600; 
            color: rgba(255,255,255,0.55); 
            cursor: pointer; 
            transition: all 0.2s ease; 
            border-bottom: 2px solid transparent;
            position: relative;
        }
        .modal-step:not(:last-child)::after, .modal-step-saas:not(:last-child)::after {
            content: '';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 50%;
            background: rgba(255,255,255,0.12);
        }
        .modal-step:hover, .modal-step-saas:hover { 
            background: rgba(255,255,255,0.06); 
            color: rgba(255,255,255,0.85);
        }
        .modal-step.active, .modal-step-saas.active { 
            color: white; 
            border-bottom-color: white; 
            background: rgba(255,255,255,0.12);
        }
        .modal-step.completed, .modal-step-saas.completed { 
            color: rgba(255,255,255,0.9); 
        }
        .modal-step-number { 
            width: 24px; 
            height: 24px; 
            border-radius: 50%; 
            background: rgba(255,255,255,0.18); 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 11px;
            font-weight: 700;
            transition: all 0.2s ease;
            border: 1px solid rgba(255,255,255,0.15);
        }
        .modal-step.active .modal-step-number, .modal-step-saas.active .modal-step-number { 
            background: white; 
            color: #4d7c0f; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            border-color: white;
        }
        .modal-step.completed .modal-step-number, .modal-step-saas.completed .modal-step-number { 
            background: rgba(255,255,255,0.9); 
            color: #4d7c0f;
            border-color: rgba(255,255,255,0.5);
        }
        
        /* MODAL BODY */
        .modal-profissional .modal-body { 
            padding: 28px; 
            overflow-y: auto; 
            flex: 1;
            min-height: 0;
            background: #f8fafc;
            scrollbar-width: thin;
            scrollbar-color: #84cc16 #e2e8f0;
        }
        /* Scrollbar Estilizada - Webkit (Chrome, Safari, Edge) */
        .modal-profissional .modal-body::-webkit-scrollbar {
            width: 10px;
        }
        .modal-profissional .modal-body::-webkit-scrollbar-track {
            background: linear-gradient(180deg, #f1f5f9 0%, #e2e8f0 100%);
            border-radius: 10px;
            margin: 8px 0;
        }
        .modal-profissional .modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #84cc16 0%, #65a30d 100%);
            border-radius: 10px;
            border: 2px solid #f1f5f9;
            transition: all 0.3s ease;
        }
        .modal-profissional .modal-body::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #65a30d 0%, #4d7c0f 100%);
            border-color: #e2e8f0;
        }
        .modal-profissional .modal-body::-webkit-scrollbar-thumb:active {
            background: #4d7c0f;
        }
        
        /* MODAL FOOTER */
        .modal-profissional .modal-footer { 
            padding: 20px 28px; 
            border-top: 1px solid #e2e8f0; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            background: white;
            flex-shrink: 0;
        }
        .modal-footer-left { display: flex; align-items: center; gap: 8px; font-size: 12px; color: #64748b; }
        .modal-footer-left i { color: #94a3b8; }
        .modal-footer-right { display: flex; gap: 12px; }
        .modal-profissional .modal-footer .btn { 
            min-width: 140px; 
            padding: 14px 24px; 
            font-weight: 600; 
            border-radius: 10px; 
            transition: all 0.25s; 
            cursor: pointer;
        }
        .modal-profissional .modal-footer .btn-secondary { background: #f1f5f9; color: #475569; border: 1px solid #e2e8f0; }
        .modal-profissional .modal-footer .btn-secondary:hover { background: #e2e8f0; }
        .modal-profissional .modal-footer .btn-primary { 
            background: linear-gradient(135deg, #84cc16, #65a30d); 
            border: none; 
            box-shadow: 0 4px 15px rgba(132, 204, 22, 0.3); 
            color: white; 
        }
        .modal-profissional .modal-footer .btn-primary:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 6px 20px rgba(132, 204, 22, 0.4); 
        }

        /* FORM SECTIONS PROFISSIONAIS */
        .form-section-pro { 
            margin-bottom: 24px; 
            background: white; 
            border-radius: 16px; 
            padding: 24px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.05); 
            border: 1px solid #e2e8f0; 
            transition: all 0.2s; 
        }
        .form-section-pro:hover { border-color: #cbd5e1; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .form-section-pro:last-child { margin-bottom: 0; }
        .form-section-pro-title { 
            display: flex; 
            align-items: center; 
            gap: 14px; 
            margin-bottom: 20px; 
            padding-bottom: 16px; 
            border-bottom: 2px solid #f1f5f9; 
        }
        .form-section-pro-title i { 
            width: 40px; 
            height: 40px; 
            background: linear-gradient(135deg, #22c55e, #16a34a); 
            color: white; 
            border-radius: 12px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 16px; 
            box-shadow: 0 4px 10px rgba(34,197,94,0.25); 
        }
        .form-section-pro-title span { 
            font-size: 15px; 
            font-weight: 700; 
            color: #1e293b; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
        }
        .form-section-pro-title .section-badge { 
            margin-left: auto; 
            font-size: 11px; 
            padding: 5px 12px; 
            background: #dcfce7; 
            color: #16a34a; 
            border-radius: 20px; 
            font-weight: 600; 
            text-transform: none; 
            letter-spacing: 0; 
        }
        
        /* FORM INPUTS PROFISSIONAIS */
        .form-section-pro .form-group label { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            font-size: 13px; 
            font-weight: 600; 
            color: #374151; 
            margin-bottom: 2px; 
        }
        .form-section-pro .form-group label i { 
            color: #9ca3af; 
            font-size: 13px; 
            width: 16px; 
            text-align: center; 
        }
        .form-section-pro .form-group label .required { color: #22c55e; margin-left: 2px; font-weight: 700; }
        .form-section-pro .form-group .field-hint { 
            font-size: 11px; 
            color: #9ca3af; 
            margin-top: 4px; 
            display: flex; 
            align-items: center; 
            gap: 4px; 
        }
        .form-section-pro .form-group input, 
        .form-section-pro .form-group select, 
        .form-section-pro .form-group textarea { 
            padding: 14px 16px; 
            border: 2px solid #e5e7eb; 
            border-radius: 12px; 
            font-size: 14px; 
            transition: all 0.25s;
            background: #fafbfc;
            color: #1e293b;
        }
        .form-section-pro .form-group input:focus, 
        .form-section-pro .form-group select:focus, 
        .form-section-pro .form-group textarea:focus { 
            outline: none; 
            border-color: #22c55e; 
            box-shadow: 0 0 0 4px rgba(34,197,94,0.1); 
            background: white; 
        }
        .form-section-pro .form-group input:valid:not(:placeholder-shown) { 
            border-color: #86efac; 
            background: #f0fdf4; 
        }
        
        /* VALOR DESTAQUE - VERSO PREMIUM */
        .valor-destaque-pro { 
            position: relative;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 4px;
            border: 2px solid #86efac;
            transition: all 0.3s ease;
        }
        .valor-destaque-pro:hover {
            border-color: #22c55e;
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15);
        }
        .valor-destaque-pro:focus-within {
            border-color: #16a34a;
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.1), 0 4px 12px rgba(34, 197, 94, 0.2);
        }
        .valor-destaque-pro input { 
            font-size: 24px; 
            font-weight: 800; 
            color: #16a34a; 
            padding: 16px 16px 16px 55px;
            background: transparent;
            border: none !important;
            box-shadow: none !important;
        }
        .valor-destaque-pro input:focus {
            outline: none;
            background: transparent;
        }
        .valor-destaque-pro input::placeholder {
            color: #86efac;
            font-weight: 600;
        }
        .valor-destaque-pro .currency-symbol { 
            position: absolute; 
            left: 18px; 
            top: 50%; 
            transform: translateY(-50%); 
            font-size: 16px; 
            color: #16a34a; 
            font-weight: 700;
            background: white;
            padding: 6px 10px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        /* PREVIEW/RESUMO DA CONTA */
        .conta-resumo-pro { 
            background: linear-gradient(135deg, #dcfce7, #f0fdf4); 
            border: 2px solid #86efac; 
            border-radius: 16px; 
            padding: 20px; 
            margin-top: 24px; 
        }
        .conta-resumo-pro-header { 
            display: flex; 
            align-items: center; 
            gap: 12px; 
            margin-bottom: 16px; 
            padding-bottom: 12px; 
            border-bottom: 1px dashed #4ade80; 
        }
        .conta-resumo-pro-header i { 
            width: 36px; 
            height: 36px; 
            background: #22c55e; 
            color: white; 
            border-radius: 10px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        .conta-resumo-pro-header span { font-size: 14px; font-weight: 700; color: #166534; }
        .conta-resumo-pro-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }
        .conta-resumo-pro-item { text-align: center; }
        .conta-resumo-pro-item .label { 
            font-size: 11px; 
            color: #166534; 
            text-transform: uppercase; 
            font-weight: 600; 
            letter-spacing: 0.5px; 
            margin-bottom: 4px; 
        }
        .conta-resumo-pro-item .value { font-size: 16px; font-weight: 700; color: #16a34a; }
        .conta-resumo-pro-item .value.big { font-size: 24px; }
        
        /* TOAST DE SUCESSO */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .toast {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            min-width: 320px;
            transform: translateX(120%);
            transition: transform 0.3s ease;
        }
        .toast.show { transform: translateX(0); }
        .toast.success {
            border-left: 4px solid #22c55e;
        }
        .toast.error {
            border-left: 4px solid #ef4444;
        }
        .toast.warning {
            border-left: 4px solid #f59e0b;
        }
        .toast-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        .toast.success .toast-icon { background: #dcfce7; color: #22c55e; }
        .toast.error .toast-icon { background: #fee2e2; color: #ef4444; }
        .toast.warning .toast-icon { background: #fef3c7; color: #f59e0b; }
        .toast-content { flex: 1; }
        .toast-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        .toast-message {
            font-size: 12px;
            color: var(--text-secondary);
        }
        .toast-close {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .toast-close:hover { background: var(--bg-gray); }

        /* MODAL - Classes Padrão (Padrão SaaS Empresarial) */
        .modal-overlay-padrão { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(15,23,42,0.7); display: none; align-items: center; justify-content: center; z-index: 99999; backdrop-filter: blur(8px); }
        .modal-overlay-padrão.active { display: flex !important; }
        .modal-padrão { display: flex !important; flex-direction: column !important; background: white !important; border-radius: 20px !important; width: 100% !important; max-width: 900px !important; max-height: 92vh !important; overflow: hidden !important; box-shadow: 0 25px 80px rgba(0,0,0,0.25), 0 10px 30px rgba(0,0,0,0.15) !important; animation: modalFadeInReceber 0.25s ease-out !important; position: relative !important; margin: 16px !important; }
        @keyframes modalFadeInReceber { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .modal-header-padrão { padding: 0 !important; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%) !important; color: white !important; position: relative !important; overflow: hidden !important; flex-shrink: 0 !important; border-radius: 20px 20px 0 0 !important; }
        .modal-header-padrão::before { content: ''; position: absolute; top: -100%; right: -50%; width: 100%; height: 300%; background: radial-gradient(ellipse, rgba(255,255,255,0.12) 0%, transparent 50%); pointer-events: none; }
        .modal-header-content-padrão { display: flex; align-items: center; gap: 16px; padding: 24px 28px; position: relative; z-index: 1; }
        .modal-header-icon-padrão { width: 52px; height: 52px; min-width: 52px; background: rgba(255,255,255,0.2); border-radius: 14px; display: flex; align-items: center; justify-content: center; }
        .modal-header-icon-padrão i { color: white; font-size: 22px; }
        .modal-header-text-padrão { flex: 1; }
        .modal-header-text-padrão h2 { margin: 0; font-size: 20px; font-weight: 700; color: white; }
        .modal-header-text-padrão p { margin: 4px 0 0; font-size: 14px; color: rgba(255,255,255,0.85); }
        .modal-close-padrão { width: 40px !important; height: 40px !important; min-width: 40px !important; border: none !important; background: rgba(255,255,255,0.15) !important; border-radius: 10px !important; cursor: pointer !important; display: flex !important; align-items: center !important; justify-content: center !important; transition: all 0.2s !important; margin-left: auto !important; }
        .modal-close-padrão:hover { background: rgba(255,255,255,0.25) !important; transform: rotate(90deg) !important; }
        .modal-close-padrão i { color: white; font-size: 16px; }
        .modal-progress-padrão { display: flex; gap: 8px; padding: 16px 28px; background: rgba(0,0,0,0.1); }
        .modal-step-padrão { display: flex; align-items: center; gap: 10px; padding: 10px 18px; background: rgba(255,255,255,0.1); border-radius: 10px; transition: all 0.2s; cursor: pointer; }
        .modal-step-padrão.active { background: rgba(255,255,255,0.25); }
        .modal-step-number-padrão { width: 28px; height: 28px; border-radius: 50%; background: rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; color: white; }
        .modal-step-padrão.active .modal-step-number-padrão { background: white; color: #16a34a; }
        .modal-step-padrão span { font-size: 13px; font-weight: 500; color: rgba(255,255,255,0.9); }
        .modal-body-padrão { padding: 28px !important; overflow-y: auto !important; flex: 1 !important; min-height: 0 !important; background: #f8fafc !important; }
        .modal-footer-padrão { padding: 20px 28px !important; border-top: 1px solid #e2e8f0 !important; display: flex !important; justify-content: space-between !important; align-items: center !important; background: white !important; flex-shrink: 0 !important; }
        .modal-footer-padrão .modal-footer-left { display: flex; align-items: center; gap: 8px; font-size: 12px; color: #64748b; }
        .modal-footer-padrão .modal-footer-right { display: flex; gap: 12px; }
        .modal-footer-left-padrão { display: flex; align-items: center; }
        .modal-footer-left-padrão .footer-info { display: flex; align-items: center; gap: 6px; font-size: 12px; color: #9ca3af; }
        .modal-footer-left-padrão .footer-info i { color: #22c55e; }
        .modal-footer-right-padrão { display: flex; gap: 12px; margin-left: auto; }
        .form-section-padrão { background: #ffffff; border-radius: 16px; padding: 24px; border: 1px solid #e2e8f0; margin-bottom: 24px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); transition: all 0.2s; }
        .form-section-padrão:hover { border-color: #cbd5e1; box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .form-section-padrão:last-child { margin-bottom: 0; }
        .form-section-title-padrão { display: flex; align-items: center; gap: 12px; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid #f1f5f9; }
        .form-section-title-padrão i { width: 40px; height: 40px; background: linear-gradient(135deg, #22c55e, #16a34a); color: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
        .form-section-title-padrão span { font-size: 15px; font-weight: 700; color: #1e293b; text-transform: uppercase; letter-spacing: 0.5px; }
        .section-badge-padrão { margin-left: auto; font-size: 11px; padding: 5px 12px; border-radius: 20px; font-weight: 600; background: #fee2e2; color: #dc2626; }
        .form-grid-padrão { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .form-group-padrão { display: flex; flex-direction: column; gap: 8px; }
        .form-group-padrão.full { grid-column: span 2; }
        .form-group-padrão label { display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 600; color: #374151; }
        .form-group-padrão label i { color: #22c55e; font-size: 14px; }
        .form-group-padrão label .required { color: #ef4444; margin-left: 2px; }
        .form-group-padrão input, .form-group-padrão select, .form-group-padrão textarea { width: 100%; padding: 14px 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 15px; font-family: inherit; transition: all 0.2s; background: #ffffff; }
        .form-group-padrão input:focus, .form-group-padrão select:focus, .form-group-padrão textarea:focus { outline: none; border-color: #22c55e; box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.15); }
        .field-hint { display: flex; align-items: center; gap: 6px; font-size: 12px; color: #9ca3af; margin-top: 6px; }
        .field-hint i { font-size: 11px; }
        .btn-padrão-ghost { display: inline-flex; align-items: center; gap: 8px; padding: 14px 24px; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: 1px solid #e5e7eb; background: #ffffff; color: #6b7280; }
        .btn-padrão-ghost:hover { background: #f3f4f6; }
        .btn-padrão-primary { display: inline-flex; align-items: center; gap: 8px; padding: 14px 24px; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.2s; border: none; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color: white; box-shadow: 0 4px 14px rgba(34, 197, 94, 0.4); }
        .btn-padrão-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(34, 197, 94, 0.5); }

        /* ================================================================================
           CSS MODAIS ESTILO OMIE - CONTAS A RECEBER
           ================================================================================ */
        
        /* ========== OVERLAY PADRáO OMIE ========== */
        .modal-overlay-omie {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15,23,42,0.65);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay-omie.active { display: flex; }
        
        /* ========== MODAL BASE OMIE ========== */
        .modal-omie {
            background: #fff;
            border-radius: 12px;
            max-height: 95vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-shadow: 0 25px 80px rgba(0,0,0,0.25);
            animation: crSlideIn 0.25s ease-out;
        }
        @keyframes crSlideIn {
            from { opacity: 0; transform: translateY(-20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .modal-header-omie {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 24px;
            background: #fff;
            border-bottom: 1px solid #e5e7eb;
        }
        .modal-header-omie h2 {
            font-size: 18px;
            font-weight: 700;
            color: #22c55e;
            margin: 0;
            letter-spacing: -0.3px;
        }
        .btn-fechar-omie {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            color: #6b7280;
            font-size: 13px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 8px;
            transition: all 0.2s;
            font-weight: 500;
        }
        .btn-fechar-omie:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
            color: #111827;
        }
        
        /* ========== MODAL BODY OMIE ========== */
        .modal-body-omie {
            padding: 24px;
            background: #fafafa;
        }
        
        /* ========== MODAL ESCOLHA MÉTODO ========== */
        .modal-escolha {
            width: 640px;
            max-width: 96vw;
        }
        .modal-escolha .modal-body-omie {
            padding: 28px;
        }
        .opcao-metodo {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.2s;
            background: #fff;
        }
        .opcao-metodo:hover {
            border-color: #22c55e;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15);
        }
        .opcao-metodo:last-child { margin-bottom: 0; }
        .opcao-titulo {
            font-size: 15px;
            font-weight: 700;
            color: #fff;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            padding: 10px 18px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: inline-block;
            box-shadow: 0 2px 6px rgba(34, 197, 94, 0.3);
        }
        .opcao-info p {
            font-size: 13px;
            color: #6b7280;
            margin: 0;
            max-width: 400px;
            line-height: 1.5;
        }
        .opcao-icone {
            width: 48px;
            height: 48px;
            background: #f3f4f6;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #9ca3af;
            font-size: 20px;
            transition: all 0.2s;
        }
        .opcao-metodo:hover .opcao-icone {
            background: #22c55e;
            color: #fff;
        }
        
        /* ========== MODAL NF-e ========== */
        .modal-nfe {
            width: 720px;
            max-width: 96vw;
        }
        .nfe-input-section {
            margin-bottom: 24px;
        }
        .nfe-input-section label {
            display: block;
            font-size: 13px;
            color: #374151;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .nfe-input-row {
            display: flex;
            gap: 12px;
        }
        .nfe-input-row input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
        }
        .nfe-input-row input:focus {
            outline: none;
            border-color: #22c55e;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.15);
        }
        .btn-pesquisar-nfe {
            padding: 12px 24px;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }
        .btn-pesquisar-nfe:hover {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            transform: translateY(-1px);
        }
        .nfe-demo {
            display: flex;
            gap: 24px;
            padding: 24px;
            background: #fff;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }
        .nfe-demo-danfe { flex: 1; }
        .nfe-demo-info { flex: 1; }
        .link-upload-nfe {
            color: #22c55e;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }
        .link-upload-nfe:hover { text-decoration: underline; }
        
        /* ========== MODAL CÓDIGO DE BARRAS ========== */
        .modal-codigo-barras {
            width: 540px;
            max-width: 96vw;
        }
        .link-upload-boleto {
            color: #22c55e;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }
        .link-upload-boleto:hover { text-decoration: underline; }
        .btn-continuar-omie {
            padding: 14px 32px;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }
        .btn-continuar-omie:hover {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            transform: translateY(-1px);
        }
        
        /* ========== MODAL CONTA A RECEBER (PRINCIPAL COM ABAS) ========== */
        .modal-conta-receber {
            width: 96vw;
            max-width: 1150px;
            height: 92vh;
            max-height: 800px;
            display: flex;
            flex-direction: row;
            position: relative;
            border-radius: 16px;
        }
        
        /* Header da Conta */
        .modal-header-conta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 24px;
            background: #fff;
            border-bottom: 1px solid #e5e7eb;
            position: absolute;
            top: 0;
            left: 0;
            right: 100px;
            z-index: 10;
            border-radius: 16px 0 0 0;
        }
        .modal-header-left-conta {
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .modal-avatar-conta {
            width: 46px;
            height: 46px;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #22c55e;
            font-size: 20px;
            border: 2px solid #bbf7d0;
        }
        .modal-titulo-conta h2 {
            font-size: 18px;
            font-weight: 700;
            color: #22c55e;
            margin: 0;
            letter-spacing: -0.3px;
        }
        
        /* Body da Conta */
        .modal-body-conta {
            flex: 1;
            overflow-y: auto;
            padding: 0;
            padding-top: 82px;
            padding-right: 100px;
            background: #fafafa;
            border-radius: 16px 0 0 16px;
        }
        
        /* Seção Principal do Formulário */
        .form-principal-conta {
            padding: 24px;
            background: #fff;
            border-bottom: 1px solid #e5e7eb;
        }
        .form-row-conta {
            display: flex;
            gap: 16px;
            margin-bottom: 18px;
            align-items: flex-end;
        }
        .form-row-conta:last-child { margin-bottom: 0; }
        .form-group-conta {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .form-group-conta label {
            font-size: 12px;
            color: #374151;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .form-group-conta input,
        .form-group-conta select,
        .form-group-conta textarea {
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            color: #111827;
            background: #fff;
            transition: all 0.2s;
        }
        .form-group-conta input::placeholder { color: #9ca3af; }
        .form-group-conta input:focus,
        .form-group-conta select:focus,
        .form-group-conta textarea:focus {
            outline: none;
            border-color: #22c55e;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.15);
            background: #fefffe;
        }
        .form-group-conta textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        /* Input com ícone */
        .input-icon-conta, .input-search-conta {
            position: relative;
        }
        .input-icon-conta input, .input-search-conta input {
            padding-right: 40px;
            width: 100%;
        }
        .input-icon-conta i, .input-search-conta i {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 14px;
        }
        
        /* Links */
        .link-adicionar {
            font-size: 12px;
            color: #22c55e;
            text-decoration: none;
            font-weight: 500;
        }
        .link-adicionar:hover { text-decoration: underline; }
        .link-icon {
            color: #22c55e;
            font-size: 11px;
            margin-left: 4px;
        }
        .parcela-info {
            font-size: 11px;
            color: #9ca3af;
            margin-left: auto;
        }
        
        /* ========== ABAS (TABS) ========== */
        .tabs-conta {
            display: flex;
            border-bottom: 1px solid #e5e7eb;
            background: #fff;
            padding: 0 24px;
            gap: 4px;
            overflow-x: auto;
        }
        .tab-conta {
            padding: 14px 18px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.2s;
            margin-bottom: -1px;
        }
        .tab-conta:hover {
            color: #374151;
            background: #f9fafb;
            border-radius: 8px 8px 0 0;
        }
        .tab-conta.active {
            color: #22c55e;
            border-bottom-color: #22c55e;
            background: #f0fdf4;
            border-radius: 8px 8px 0 0;
        }
        
        /* Conteúdo das abas */
        .tab-content-conta {
            padding: 24px;
            min-height: 200px;
            background: #fff;
        }
        .tab-pane-conta {
            display: none;
        }
        .tab-pane-conta.active {
            display: block;
            animation: crFadeIn 0.2s ease;
        }
        @keyframes crFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Empty state */
        .empty-state-conta {
            text-align: center;
            padding: 48px 24px;
            color: #6b7280;
            background: #fafafa;
            border-radius: 8px;
            border: 1px dashed #e5e7eb;
        }
        .empty-state-conta span {
            font-size: 32px;
            display: block;
            margin-bottom: 12px;
        }
        .empty-state-conta p {
            font-size: 14px;
            margin-bottom: 8px;
            color: #6b7280;
        }
        .link-acao {
            color: #22c55e;
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
        }
        .link-acao:hover { text-decoration: underline; }
        
        /* Checkbox */
        .checkbox-conta {
            justify-content: flex-end;
            padding-bottom: 10px;
        }
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #4b5563;
            cursor: pointer;
        }
        .checkbox-label input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #22c55e;
        }
        
        /* Input valor imposto */
        .input-valor-imposto input {
            text-align: right;
            width: 100%;
        }
        
        /* ========== RECEBIMENTOS LAYOUT ========== */
        .recebimentos-layout {
            display: flex;
            gap: 24px;
        }
        .recebimentos-tabela {
            flex: 2;
        }
        .recebimentos-resumo {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .recebimentos-header-info {
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        .drag-info {
            font-size: 12px;
            color: #9ca3af;
            background: #f3f4f6;
            padding: 10px;
            text-align: center;
            margin-bottom: 8px;
            border-radius: 6px;
        }
        .tabela-recebimentos {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        .tabela-recebimentos th {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            color: white;
            padding: 10px 12px;
            text-align: left;
            font-weight: 600;
        }
        .tabela-recebimentos th:first-child { border-radius: 8px 0 0 0; }
        .tabela-recebimentos th:last-child { border-radius: 0 8px 0 0; }
        .tabela-recebimentos td {
            padding: 10px 12px;
            border-bottom: 1px solid #e5e7eb;
        }
        .recebimentos-pagination {
            display: flex;
            justify-content: center;
            gap: 12px;
            padding: 10px;
            font-size: 12px;
            color: #6b7280;
        }
        .page-number {
            background: #22c55e;
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        .recebimentos-botoes {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            justify-content: center;
        }
        .btn-cancelar-recebimento {
            padding: 10px 20px;
            background: #fee2e2;
            color: #dc2626;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-cancelar-recebimento:hover {
            background: #fecaca;
        }
        .btn-registrar-recebimento {
            padding: 10px 20px;
            background: #dcfce7;
            color: #16a34a;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-registrar-recebimento:hover {
            background: #bbf7d0;
        }
        .resumo-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        .resumo-item label {
            font-size: 12px;
            color: #6b7280;
            font-weight: 500;
        }
        .resumo-item input {
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            text-align: right;
            font-size: 14px;
            background: #f9fafb;
        }
        .resumo-item.destaque input {
            background: #dcfce7;
            border-color: #22c55e;
            font-weight: 700;
            color: #16a34a;
        }
        
        /* ========== PAINEL LATERAL SALVAR ========== */
        .painel-lateral-salvar {
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100%;
            background: linear-gradient(to top, #f3f4f6, #f9fafb);
            border-left: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 100px;
            gap: 16px;
            border-radius: 0 16px 16px 0;
        }
        .btn-salvar-lateral {
            padding: 14px 18px;
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
            border: none;
            color: white;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.3);
        }
        .btn-salvar-lateral:hover {
            background: linear-gradient(135deg, #16a34a 0%, #15803d 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);
        }
        .btn-avancar-lateral {
            width: 44px;
            height: 44px;
            background: #fff;
            border: 2px solid #22c55e;
            color: #22c55e;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.2s;
        }
        .btn-avancar-lateral:hover {
            background: #22c55e;
            color: white;
        }
        
        @media (max-width: 768px) {
            .modal-conta-receber {
                width: 100%;
                height: 100vh;
                max-height: none;
                border-radius: 0;
            }
            .modal-body-conta {
                padding-right: 0;
                border-radius: 0;
            }
            .painel-lateral-salvar {
                display: none;
            }
            .modal-header-conta {
                right: 0;
                border-radius: 0;
            }
            .form-row-conta {
                flex-direction: column;
            }
            .form-group-conta {
                max-width: none !important;
            }
            .tabs-conta {
                overflow-x: auto;
                padding: 0 16px;
            }
            .recebimentos-layout {
                flex-direction: column;
            }
            .modal-escolha, .modal-nfe, .modal-codigo-barras {
                width: 100%;
                max-width: none;
                border-radius: 0;
                height: 100vh;
                max-height: none;
            }
        }
    </style>
    <!-- Tooltips Profissionais -->
    <link rel="stylesheet" href="/css/tooltips-professional.css?v=20260209">
    <script src="/js/tooltips-professional.js?v=20260209"></script>

    <!-- Header & Sidebar refinado -->
    <link rel="stylesheet" href="css/fin-header-sidebar.css?v=20260215">
    <!-- Global Header & Sidebar - override final unificado -->
    <link rel="stylesheet" href="/css/global-header-sidebar.css?v=20260216">
    <script src="/js/anti-copy-protection.js"></script>
    <link rel="stylesheet" href="/css/popup-confirmacao.css">
    <link rel="stylesheet" href="/css/modal-fix-global.css?v=20260114-fix4">
    <link rel="stylesheet" href="css/modais-padrao.css?v=20260114-fix3">
    <!-- CSS Unificado de Modais SaaS -->
    <link rel="stylesheet" href="css/modais-saas-unified.css?v=20260121">

    <!-- Declaração antecipada de funções para onclick -->
    <script>
        // Funções serão redefinidas completamente no script principal
        function abrirModalNovo() {
            console.log('Abrindo modal de escolha do método...');
            const modal = document.getElementById('modalEscolhaMetodo');
            if (modal) modal.classList.add('active');
        }
        function exportarDados() {
            console.log('Preparando exportação...');
        }
    </script>

    <!-- Chat Widget BOB AI -->
    <link rel="stylesheet" href="/chat/widget.css?v=20260218">
</head>
<body>
    <div class="app-container">
        <!-- Overlay para fechar sidebar em mobile -->
        <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleMobileSidebar()"></div>

        <!-- SIDEBAR -->
        <aside class="sidebar" id="mobile-sidebar">
            <a href="/dashboard" class="sidebar-logo" title="Voltar ao Painel">
                <i class="fas fa-home"></i>
            </a>

            <nav class="sidebar-nav">
                <a href="index.html" class="sidebar-btn" title="Dashboard">
                    <i class="fas fa-chart-line"></i>
                </a>
                <a href="contas-pagar.html" class="sidebar-btn" title="Contas a Pagar">
                    <i class="fas fa-file-invoice-dollar"></i>
                </a>
                <a href="contas-receber.html" class="sidebar-btn active" title="Contas a Receber">
                    <i class="fas fa-hand-holding-usd"></i>
                </a>
                <a href="fluxo-caixa.html" class="sidebar-btn" title="Fluxo de Caixa">
                    <i class="fas fa-chart-area"></i>
                </a>
                <a href="bancos.html" class="sidebar-btn" title="Bancos">
                    <i class="fas fa-university"></i>
                </a>
                <a href="plano-contas.html" class="sidebar-btn" title="Plano de Contas">
                    <i class="fas fa-list-alt"></i>
                </a>
                <a href="orcamentos.html" class="sidebar-btn" title="Orçamentos">
                    <i class="fas fa-calculator"></i>
                </a>
                <a href="conciliacao.html" class="sidebar-btn" title="Conciliação">
                    <i class="fas fa-balance-scale"></i>
                </a>
                <a href="relatorios.html" class="sidebar-btn" title="Relatórios">
                    <i class="fas fa-chart-bar"></i>
                </a>
            </nav>

            <div class="sidebar-bottom">
                <a href="centros-custo.html" class="sidebar-btn" title="Centros de Custo">
                    <i class="fas fa-sitemap"></i>
                </a>
                <a href="impostos.html" class="sidebar-btn" title="Impostos">
                    <i class="fas fa-percent"></i>
                </a>
                <button class="sidebar-btn" title="Configurações" id="btn-config" onclick="toggleConfiguracoes()">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </aside>

        <!-- MAIN -->
        <main class="main-area">
            <header class="header">
                <div class="header-left">
                    <!-- Botao Menu Mobile -->
                    <button class="mobile-menu-btn" onclick="toggleMobileSidebar()" title="Menu">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="header-brand" style="display:flex;align-items:center;gap:10px;">
                        <img src="/images/Logo Monocromatico - Branco - Aluforce.png" alt="ALUFORCE" style="height:22px;object-fit:contain;">
                        <span style="color:rgba(255,255,255,0.2);font-weight:300;font-size:18px;user-select:none;">|</span>
                        <img src="/images/zyntra-branco.png" alt="Zyntra" style="height:22px;object-fit:contain;">
                        <span style="color:rgba(255,255,255,0.18);font-weight:200;font-size:16px;user-select:none;margin:0 2px;"></span>
                        <span style="font-size:13px;font-weight:500;color:rgba(255,255,255,0.85);letter-spacing:0.3px;">Contas a Receber</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn" title="Atualizar" onclick="location.reload()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <div class="notification-container">
                        <button class="header-btn notification-btn" title="Notificações" onclick="toggleNotificacoes()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notification-count" style="display: none;">0</span>
                        </button>
                        <div class="notification-panel" id="notification-panel">
                            <div class="notification-header">
                                <h3><i class="fas fa-bell"></i> Notificações</h3>
                                <div class="notification-actions">
                                    <button onclick="marcarTodasLidas()" title="Marcar todas como lidas">
                                        <i class="fas fa-check-double"></i>
                                    </button>
                                    <button onclick="limparNotificacoes()" title="Limpar todas">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="notification-list" id="notification-list">
                                <div class="notification-empty">
                                    <i class="fas fa-check-circle"></i>
                                    <p>Nenhuma notificação</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="user-greeting">
                        <span><span id="greeting-text">Bom dia</span>, <strong id="user-name">Usuário</strong></span>
                        <div class="user-avatar" id="user-avatar">
                            <img alt="Foto do usuário" id="user-photo" style="display:none">
                            <span id="user-initials">U</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- CONTENT -->
            <div class="main-content">

            <div class="page-content">
                <!-- Page Header -->
                <div class="page-header" style="justify-content: flex-end;">
                    <div class="page-actions">
                        <button class="btn-importar" onclick="abrirModalImportar('contas-receber')"><i class="fas fa-file-excel"></i> Importar XLSX</button>
                        <button class="btn btn-secondary" onclick="exportarDados()"><i class="fas fa-download"></i> Exportar</button>
                        <button class="btn btn-success" onclick="abrirModalNovo()"><i class="fas fa-plus"></i> Nova Conta</button>
                    </div>
                </div>

                <!-- Stats - Igual ao Contas a Pagar -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total a Receber</h3>
                        <div class="value green" id="totalReceber">R$ 0,00</div>
                    </div>
                    <div class="stat-card">
                        <h3>Vence Hoje</h3>
                        <div class="value yellow" id="venceHoje">R$ 0,00</div>
                    </div>
                    <div class="stat-card">
                        <h3>Vencidas</h3>
                        <div class="value red" id="vencidas">R$ 0,00</div>
                    </div>
                    <div class="stat-card">
                        <h3>Recebido no Mês</h3>
                        <div class="value green" id="recebidoMes">R$ 0,00</div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="filters-section">
                    <div class="filters-row">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="searchInput" placeholder="Buscar por cliente, descrição..." oninput="filtrarContas()">
                        </div>
                        <div class="filter-group">
                            <button class="filter-btn active" onclick="filtrarStatus('todas', this)"><i class="fas fa-list"></i> Todas</button>
                            <button class="filter-btn" onclick="filtrarStatus('pendente', this)"><i class="fas fa-clock"></i> Pendentes</button>
                            <button class="filter-btn" onclick="filtrarStatus('vencido', this)"><i class="fas fa-exclamation"></i> Vencidas</button>
                            <button class="filter-btn" onclick="filtrarStatus('recebido', this)"><i class="fas fa-check"></i> Recebidas</button>
                        </div>
                        <select class="filter-select" id="filterPeriodo" onchange="filtrarContas()">
                            <option value="">Todos os períodos</option>
                            <option value="hoje">Hoje</option>
                            <option value="semana">Esta Semana</option>
                            <option value="mes">Este Mês</option>
                            <option value="proximo">Próximos 30 dias</option>
                        </select>
                    </div>
                </div>

                <!-- Table -->
                <div class="table-container">
                    <div class="table-header">
                        <h3><i class="fas fa-table"></i> Lista de Contas a Receber</h3>
                        <div class="table-actions">
                            <button class="btn btn-secondary" onclick="toggleSelectAll()"><i class="fas fa-check-square"></i></button>
                            <button class="btn btn-secondary" onclick="excluirSelecionados()"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                                <th>Documento</th>
                                <th>Cliente</th>
                                <th>Categoria</th>
                                <th>Venc. Original</th>
                                <th>Venc. Atualizado</th>
                                <th>VL. Atualizado</th>
                                <th>Pago</th>
                                <th>Saldo</th>
                                <th>Status</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="contasTableBody"></tbody>
                    </table>
                    <div class="table-pagination">
                        <div class="pagination-info">Mostrando <strong id="paginaAtual">1-10</strong> de <strong id="totalRegistros">0</strong></div>
                        <div class="pagination-controls" id="paginationControls"></div>
                    </div>
                </div>
            </div>
        
            </div> <!-- /main-content -->
</main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- ================================================================================
         MODAL INICIAL - INCLUIR CONTA A RECEBER (ESCOLHA DO MÉTODO)
         ================================================================================ -->
    <div class="modal-overlay-omie" id="modalEscolhaMetodo" onclick="if(event.target === this) fecharModalEscolha()">
        <div class="modal-omie modal-escolha">
            <div class="modal-header-omie">
                <h2>Incluir Conta a Receber</h2>
                <button class="btn-fechar-omie" onclick="fecharModalEscolha()">Fechar <i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-omie">
                <!-- Opção 1: Nota Fiscal Eletrônica -->
                <div class="opcao-metodo" onclick="abrirModalNFe()">
                    <div class="opcao-info">
                        <div class="opcao-titulo">Nota Fiscal Eletrônica</div>
                        <p>Importe o arquivo XML de uma Nota Fiscal Eletrônica (NF-e) com as informações para Contas a Receber. Válido para a NF-e âmbito nacional.</p>
                    </div>
                    <div class="opcao-icone">
                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='80' fill='%2322c55e' opacity='0.3'%3E📄%3C/text%3E%3C/svg%3E" alt="NF-e" style="width: 80px; opacity: 0.5;">
                    </div>
                </div>
                
                <!-- Opção 2: Código de Barras -->
                <div class="opcao-metodo" onclick="abrirModalCodigoBarras()">
                    <div class="opcao-info">
                        <div class="opcao-titulo">Código de Barras</div>
                        <p>Informe boletos de cobrança para leitura automática dos dados de recebimento.</p>
                    </div>
                    <div class="opcao-icone">
                        <svg width="80" height="50" style="opacity: 0.3;">
                            <rect x="0" y="0" width="3" height="50" fill="#22c55e"/>
                            <rect x="5" y="0" width="1" height="50" fill="#22c55e"/>
                            <rect x="8" y="0" width="4" height="50" fill="#22c55e"/>
                            <rect x="14" y="0" width="2" height="50" fill="#22c55e"/>
                            <rect x="18" y="0" width="1" height="50" fill="#22c55e"/>
                            <rect x="22" y="0" width="3" height="50" fill="#22c55e"/>
                            <rect x="28" y="0" width="1" height="50" fill="#22c55e"/>
                            <rect x="32" y="0" width="2" height="50" fill="#22c55e"/>
                            <rect x="36" y="0" width="4" height="50" fill="#22c55e"/>
                            <rect x="42" y="0" width="1" height="50" fill="#22c55e"/>
                            <rect x="46" y="0" width="2" height="50" fill="#22c55e"/>
                            <rect x="50" y="0" width="3" height="50" fill="#22c55e"/>
                            <rect x="56" y="0" width="1" height="50" fill="#22c55e"/>
                            <rect x="60" y="0" width="2" height="50" fill="#22c55e"/>
                            <rect x="65" y="0" width="4" height="50" fill="#22c55e"/>
                            <rect x="72" y="0" width="1" height="50" fill="#22c55e"/>
                            <rect x="76" y="0" width="3" height="50" fill="#22c55e"/>
                        </svg>
                    </div>
                </div>
                
                <!-- Opção 3: Inserção Manual -->
                <div class="opcao-metodo" onclick="abrirModalManual()">
                    <div class="opcao-info">
                        <div class="opcao-titulo">Inserção Manual</div>
                        <p>Digite manualmente a Conta a Receber</p>
                    </div>
                    <div class="opcao-icone">
                        <i class="fas fa-edit" style="font-size: 40px; color: #22c55e; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ================================================================================
         MODAL IMPORTAR NF-e
         ================================================================================ -->
    <div class="modal-overlay-omie" id="modalNFe" onclick="if(event.target === this) fecharModalNFe()">
        <div class="modal-omie modal-nfe">
            <div class="modal-header-omie">
                <h2>Importar Nota Fiscal Eletrônica</h2>
                <button class="btn-fechar-omie" onclick="fecharModalNFe()">Fechar <i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-omie" style="padding: 24px;">
                <div class="nfe-input-section">
                    <label>Digite aqui a chave de acesso da Nota Fiscal Eletrônica (NF-e)</label>
                    <div class="nfe-input-row">
                        <input type="text" id="chaveNFe" placeholder="Chave de 44 dígitos" maxlength="44">
                        <button class="btn-pesquisar-nfe" onclick="pesquisarNFe()">
                            <i class="fas fa-search"></i> Pesquisar NF-e
                        </button>
                    </div>
                </div>
                <div class="nfe-demo">
                    <div class="nfe-demo-danfe">
                        <div style="border: 1px dashed #ccc; padding: 20px; text-align: center; color: #999;">
                            <i class="fas fa-file-alt" style="font-size: 48px; margin-bottom: 10px;"></i>
                            <p>(Demonstrativo DANFE)</p>
                        </div>
                    </div>
                    <div class="nfe-demo-info">
                        <div style="border: 1px solid #ccc; padding: 10px; margin-bottom: 10px;">
                            <svg width="100%" height="40">
                                <rect x="0" y="0" width="100%" height="40" fill="url(#barcode)"/>
                            </svg>
                        </div>
                        <div style="border: 2px solid #22c55e; padding: 10px; background: #f0fdf4;">
                            <small style="color: #22c55e; font-weight: bold;">CHAVE DE ACESSO</small>
                            <p style="font-family: monospace; font-size: 11px; color: #22c55e;">0000 0000 0000 0000 0000 0000 0000 0000 0000 0000 0000</p>
                        </div>
                        <p style="text-align: center; font-size: 11px; color: #666; margin-top: 10px;">(Identificação da chave de acesso no DANFE)</p>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <a href="#" class="link-upload-nfe" onclick="uploadArquivoNFe()">
                        <i class="fas fa-upload"></i> Ou clique aqui para selecionar o arquivo da NF-e.
                    </a>
                    <input type="file" id="inputArquivoNFe" accept=".xml" style="display: none;" onchange="processarArquivoNFe(this)">
                </div>
            </div>
        </div>
    </div>

    <!-- ================================================================================
         MODAL CÓDIGO DE BARRAS
         ================================================================================ -->
    <div class="modal-overlay-omie" id="modalCodigoBarras" onclick="if(event.target === this) fecharModalCodigoBarras()">
        <div class="modal-omie modal-codigo-barras">
            <div class="modal-header-omie">
                <h2>Informar o Código de Barras</h2>
                <button class="btn-fechar-omie" onclick="fecharModalCodigoBarras()">Fechar <i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body-omie" style="padding: 40px; text-align: center;">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; text-align: left; margin-bottom: 8px; color: #666;">Digite o código de barras aqui</label>
                    <input type="text" id="codigoBarrasInput" style="width: 100%; max-width: 400px; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;" placeholder="">
                </div>
                <div style="margin-bottom: 30px;">
                    <a href="#" class="link-upload-boleto" onclick="uploadBoleto()">
                        <i class="fas fa-camera"></i> Ou clique aqui para fazer o <strong>upload do boleto</strong>
                    </a>
                    <input type="file" id="inputBoleto" accept="image/*,.pdf" style="display: none;" onchange="processarBoleto(this)">
                </div>
                <button class="btn-continuar-omie" onclick="processarCodigoBarras()">
                    <i class="fas fa-check"></i> Continuar
                </button>
            </div>
        </div>
    </div>

    <!-- ================================================================================
         MODAL NOVA CONTA A RECEBER - INSERÇáO MANUAL (ESTILO OMIE COM ABAS)
         ================================================================================ -->
    <div class="modal-overlay-omie" id="modalConta" onclick="if(event.target === this) fecharModal()">
        <div class="modal-omie modal-conta-receber">
            <!-- HEADER -->
            <div class="modal-header-conta">
                <div class="modal-header-left-conta">
                    <div class="modal-avatar-conta">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="modal-titulo-conta">
                        <h2 id="modalTitle">Nova Conta a Receber</h2>
                    </div>
                </div>
                <div class="modal-header-right-conta">
                    <button class="btn-fechar-omie" type="button" onclick="fecharModal()">
                        Fechar <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            
            <!-- BODY -->
            <div class="modal-body-conta">
                <form id="formConta">
                    <input type="hidden" id="contaId">
                    
                    <!-- SEÇáO PRINCIPAL (SEMPRE VISÍVEL) -->
                    <div class="form-principal-conta">
                        <div class="form-row-conta">
                            <div class="form-group-conta" style="flex: 2;">
                                <label>Cliente / Pagador <i class="fas fa-external-link-alt link-icon"></i></label>
                                <div class="input-search-conta">
                                    <input type="text" id="cliente" placeholder="Digite para buscar..." required>
                                    <i class="fas fa-search"></i>
                                </div>
                            </div>
                            <div class="form-group-conta">
                                <label>Vencimento</label>
                                <div class="input-icon-conta">
                                    <input type="date" id="vencimento" required>
                                    <i class="fas fa-calendar"></i>
                                </div>
                            </div>
                            <div class="form-group-conta" style="max-width: 150px;">
                                <label>Valor da Conta <span class="parcela-info">001/001</span></label>
                                <input type="text" id="valor" placeholder="0,00" oninput="formatarMoedaInput(this)" required style="text-align: right;">
                            </div>
                        </div>
                        <div class="form-row-conta">
                            <div class="form-group-conta">
                                <label>Categoria <a href="#" class="link-adicionar"><i class="fas fa-plus"></i></a></label>
                                <select id="categoria">
                                    <option value="">Selecione...</option>
                                    <option value="vendas">Vendas de Produtos</option>
                                    <option value="projetos">Projetos e Obras</option>
                                    <option value="servicos">Serviços Prestados</option>
                                    <option value="comissoes">Comissões</option>
                                    <option value="juros">Juros e Rendimentos</option>
                                    <option value="outros">Outros</option>
                                </select>
                            </div>
                            <div class="form-group-conta">
                                <label>Previsão de Recebimento</label>
                                <div class="input-icon-conta">
                                    <input type="date" id="previsaoRecebimento">
                                    <i class="fas fa-calendar"></i>
                                </div>
                            </div>
                            <div class="form-group-conta">
                                <label>Conta Corrente</label>
                                <select id="contaBancaria">
                                    <option value="">Selecione...</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- ABAS (TABS) -->
                    <div class="tabs-conta">
                        <button type="button" class="tab-conta active" data-tab="detalhes">Detalhes</button>
                        <button type="button" class="tab-conta" data-tab="impostos">Impostos Retidos</button>
                        <button type="button" class="tab-conta" data-tab="departamentos">Departamentos</button>
                        <button type="button" class="tab-conta" data-tab="repeticao">Repetição</button>
                        <button type="button" class="tab-conta" data-tab="recebimentos">Recebimentos</button>
                        <button type="button" class="tab-conta" data-tab="diversos">Diversos</button>
                    </div>
                    
                    <!-- CONTEÚDO DAS ABAS -->
                    <div class="tab-content-conta">
                        <!-- ABA: DETALHES -->
                        <div class="tab-pane-conta active" id="tab-detalhes">
                            <div class="form-row-conta">
                                <div class="form-group-conta" style="max-width: 150px;">
                                    <label>Nota Fiscal</label>
                                    <input type="text" id="numeroDoc" placeholder="">
                                </div>
                                <div class="form-group-conta">
                                    <label>Data de Emissão</label>
                                    <div class="input-icon-conta">
                                        <input type="date" id="dataEmissao">
                                        <i class="fas fa-calendar"></i>
                                    </div>
                                </div>
                                <div class="form-group-conta">
                                    <label>Data de Registro</label>
                                    <div class="input-icon-conta">
                                        <input type="date" id="dataRegistro">
                                        <i class="fas fa-calendar"></i>
                                    </div>
                                </div>
                                <div class="form-group-conta">
                                    <label>Projeto <a href="#" class="link-adicionar"><i class="fas fa-plus"></i></a></label>
                                    <div class="input-search-conta">
                                        <input type="text" id="projeto" placeholder="">
                                        <i class="fas fa-search"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="form-row-conta">
                                <div class="form-group-conta" style="flex: 1;">
                                    <label>Observações</label>
                                    <textarea id="observacoes" rows="4" placeholder=""></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ABA: IMPOSTOS RETIDOS -->
                        <div class="tab-pane-conta" id="tab-impostos">
                            <div class="form-row-conta">
                                <div class="form-group-conta" style="max-width: 150px;">
                                    <label>Valor PIS</label>
                                    <div class="input-valor-imposto">
                                        <input type="text" id="valorPis" placeholder="0,00" oninput="formatarMoedaInput(this)">
                                    </div>
                                </div>
                                <div class="form-group-conta checkbox-conta">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="reterPis">
                                        <span>Reter</span>
                                    </label>
                                </div>
                                <div class="form-group-conta" style="max-width: 150px;">
                                    <label>Valor COFINS</label>
                                    <div class="input-valor-imposto">
                                        <input type="text" id="valorCofins" placeholder="0,00" oninput="formatarMoedaInput(this)">
                                    </div>
                                </div>
                                <div class="form-group-conta checkbox-conta">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="reterCofins">
                                        <span>Reter</span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-row-conta">
                                <div class="form-group-conta" style="max-width: 150px;">
                                    <label>Valor CSLL</label>
                                    <div class="input-valor-imposto">
                                        <input type="text" id="valorCsll" placeholder="0,00" oninput="formatarMoedaInput(this)">
                                    </div>
                                </div>
                                <div class="form-group-conta checkbox-conta">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="reterCsll">
                                        <span>Reter</span>
                                    </label>
                                </div>
                                <div class="form-group-conta" style="max-width: 150px;">
                                    <label>Valor IR</label>
                                    <div class="input-valor-imposto">
                                        <input type="text" id="valorIr" placeholder="0,00" oninput="formatarMoedaInput(this)">
                                    </div>
                                </div>
                                <div class="form-group-conta checkbox-conta">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="reterIr">
                                        <span>Reter</span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-row-conta">
                                <div class="form-group-conta" style="max-width: 150px;">
                                    <label>Valor ISS</label>
                                    <div class="input-valor-imposto">
                                        <input type="text" id="valorIss" placeholder="0,00" oninput="formatarMoedaInput(this)">
                                    </div>
                                </div>
                                <div class="form-group-conta checkbox-conta">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="reterIss">
                                        <span>Reter</span>
                                    </label>
                                </div>
                                <div class="form-group-conta" style="max-width: 150px;">
                                    <label>Valor INSS</label>
                                    <div class="input-valor-imposto">
                                        <input type="text" id="valorInss" placeholder="0,00" oninput="formatarMoedaInput(this)">
                                    </div>
                                </div>
                                <div class="form-group-conta checkbox-conta">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="reterInss">
                                        <span>Reter</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ABA: DEPARTAMENTOS -->
                        <div class="tab-pane-conta" id="tab-departamentos">
                            <div class="empty-state-conta">
                                <span>=\(</span>
                                <p>Ainda não foi informada nenhuma distribuição por departamentos para esta conta.</p>
                                <a href="#" class="link-acao">Clique aqui para fazer a distribuição agora.</a>
                            </div>
                        </div>
                        
                        <!-- ABA: REPETIÇáO -->
                        <div class="tab-pane-conta" id="tab-repeticao">
                            <div class="empty-state-conta">
                                <span>=\(</span>
                                <p>Ainda não foi informada nenhuma repetição para esta conta.</p>
                                <a href="#" class="link-acao">Clique aqui para incluir repetições agora.</a>
                            </div>
                        </div>
                        
                        <!-- ABA: RECEBIMENTOS -->
                        <div class="tab-pane-conta" id="tab-recebimentos">
                            <div class="recebimentos-layout">
                                <div class="recebimentos-tabela">
                                    <div class="recebimentos-header-info">Recebimentos Realizados</div>
                                    <div class="drag-info">Arraste uma ou mais colunas aqui para agrupar</div>
                                    <table class="tabela-recebimentos">
                                        <thead>
                                            <tr>
                                                <th>Data do Receb... <i class="fas fa-sort"></i></th>
                                                <th>Valor Recebido <i class="fas fa-sort"></i></th>
                                                <th>Descon... <i class="fas fa-sort"></i></th>
                                                <th>Juros <i class="fas fa-sort"></i></th>
                                                <th>Multa <i class="fas fa-sort"></i></th>
                                                <th>Banco <i class="fas fa-sort"></i></th>
                                                <th>Data de Créd... <i class="fas fa-sort"></i></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td colspan="7" style="text-align: center; padding: 20px; color: #999;">
                                                    Nenhum registro encontrado
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="recebimentos-pagination" id="paginacaoRecebimentos" style="display: none;">
                                        <span>|&#9664;</span> <span>&#9664; anterior</span>
                                        <span class="page-number">1</span>
                                        <span>próxima &#9654;</span> <span>&#9654;|</span>
                                    </div>
                                    <div class="recebimentos-botoes">
                                        <button type="button" class="btn-cancelar-recebimento">
                                            <i class="fas fa-times"></i> Cancelar Recebimento
                                        </button>
                                        <button type="button" class="btn-registrar-recebimento" onclick="abrirModalRecebimentoInterno()">
                                            <i class="fas fa-dollar-sign"></i> Registrar Recebimento
                                        </button>
                                    </div>
                                </div>
                                <div class="recebimentos-resumo">
                                    <div class="resumo-item">
                                        <label>Total já Recebido da Conta</label>
                                        <input type="text" value="0,00" readonly>
                                    </div>
                                    <div class="resumo-item">
                                        <label>Total de Descontos</label>
                                        <input type="text" value="0,00" readonly>
                                    </div>
                                    <div class="resumo-item">
                                        <label>Total de Juros e Multas</label>
                                        <input type="text" value="0,00" readonly>
                                    </div>
                                    <div class="resumo-item destaque">
                                        <label>$ A Receber da Conta</label>
                                        <input type="text" value="0,00" readonly class="valor-a-receber">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ABA: DIVERSOS -->
                        <div class="tab-pane-conta" id="tab-diversos">
                            <div class="form-row-conta">
                                <div class="form-group-conta" style="max-width: 150px;">
                                    <label>Número do Pedido</label>
                                    <input type="text" id="numeroPedido">
                                </div>
                                <div class="form-group-conta">
                                    <label>Tipo de Documento</label>
                                    <select id="tipoDocumento">
                                        <option value="outros">Outros</option>
                                        <option value="nf">Nota Fiscal</option>
                                        <option value="boleto">Boleto</option>
                                        <option value="recibo">Recibo</option>
                                        <option value="contrato">Contrato</option>
                                    </select>
                                </div>
                                <div class="form-group-conta" style="max-width: 150px;">
                                    <label>Número do Documento</label>
                                    <input type="text" id="numDocumento">
                                </div>
                                <div class="form-group-conta" style="max-width: 120px;">
                                    <label>Número da Parcela</label>
                                    <input type="text" id="parcela" value="001/001">
                                </div>
                            </div>
                            <div class="form-row-conta">
                                <div class="form-group-conta">
                                    <label>Chave da NF-e</label>
                                    <input type="text" id="chaveNFeForm" placeholder="">
                                </div>
                                <div class="form-group-conta">
                                    <label>Código de Barras</label>
                                    <input type="text" id="codigoBarrasForm" placeholder="">
                                </div>
                            </div>
                            <div class="form-row-conta">
                                <div class="form-group-conta">
                                    <label>Vendedor <a href="#" class="link-adicionar"><i class="fas fa-plus"></i></a></label>
                                    <div class="input-search-conta">
                                        <input type="text" id="vendedor" placeholder="">
                                        <i class="fas fa-search"></i>
                                    </div>
                                </div>
                                <div class="form-group-conta">
                                    <label>Origem</label>
                                    <div class="input-search-conta">
                                        <input type="text" id="origem" value="Conta a Receber">
                                        <i class="fas fa-search"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            
            <!-- PAINEL LATERAL SALVAR -->
            <div class="painel-lateral-salvar">
                <button type="button" class="btn-salvar-lateral" onclick="salvarContaLocal()">
                    <i class="fas fa-cloud-upload-alt"></i> Salvar
                </button>
                <button type="button" class="btn-avancar-lateral" onclick="salvarContaLocal()">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Script para controle das abas e modais -->
    <script>
        // Controle das abas do modal de conta
        document.addEventListener('DOMContentLoaded', function() {
            const tabs = document.querySelectorAll('.tab-conta');
            const panes = document.querySelectorAll('.tab-pane-conta');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetTab = this.getAttribute('data-tab');
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    panes.forEach(p => p.classList.remove('active'));
                    
                    this.classList.add('active');
                    document.getElementById('tab-' + targetTab).classList.add('active');
                });
            });
        });
        
        // Funções dos modais de escolha
        function abrirModalEscolhaMetodo() {
            document.getElementById('modalEscolhaMetodo').classList.add('active');
        }
        function fecharModalEscolha() {
            document.getElementById('modalEscolhaMetodo').classList.remove('active');
        }
        function abrirModalNFe() {
            fecharModalEscolha();
            document.getElementById('modalNFe').classList.add('active');
        }
        function fecharModalNFe() {
            document.getElementById('modalNFe').classList.remove('active');
        }
        function abrirModalCodigoBarras() {
            fecharModalEscolha();
            document.getElementById('modalCodigoBarras').classList.add('active');
        }
        function fecharModalCodigoBarras() {
            document.getElementById('modalCodigoBarras').classList.remove('active');
        }
        function abrirModalManual() {
            fecharModalEscolha();
            abrirModalContaPrincipal();
        }
        
        // Funções auxiliares
        function pesquisarNFe() {
            const chave = document.getElementById('chaveNFe').value;
            if (chave.length !== 44) {
                alert('A chave de acesso deve ter 44 dígitos');
                return;
            }
            alert('Pesquisando NF-e: ' + chave);
        }
        function uploadArquivoNFe() {
            document.getElementById('inputArquivoNFe').click();
        }
        function processarArquivoNFe(input) {
            if (!input.files || !input.files[0]) return;
            const file = input.files[0];
            const ext = file.name.split('.').pop().toLowerCase();
            
            if (ext === 'xml') {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const parser = new DOMParser();
                        const xmlDoc = parser.parseFromString(e.target.result, 'text/xml');
                        const ns = 'http://www.portalfiscal.inf.br/nfe';
                        
                        const getTag = (tag) => {
                            const el = xmlDoc.getElementsByTagNameNS(ns, tag)[0] || xmlDoc.getElementsByTagName(tag)[0];
                            return el ? el.textContent.trim() : '';
                        };
                        
                        fecharModalNFe();
                        abrirModalContaPrincipal();
                        
                        // Preencher cliente (destinatário)
                        const dest = xmlDoc.getElementsByTagNameNS(ns, 'dest')[0] || xmlDoc.getElementsByTagName('dest')[0];
                        if (dest) {
                            const xNomeDest = dest.getElementsByTagNameNS(ns, 'xNome')[0] || dest.getElementsByTagName('xNome')[0];
                            if (xNomeDest) {
                                const clienteInput = document.getElementById('clienteForm') || document.getElementById('conta-cliente');
                                if (clienteInput) clienteInput.value = xNomeDest.textContent.trim();
                            }
                        }
                        
                        const docInput = document.getElementById('documentoForm') || document.getElementById('conta-documento');
                        if (docInput) docInput.value = getTag('nNF') || '';
                        const vNF = getTag('vNF') || getTag('vLiq');
                        const valorInput = document.getElementById('valorForm') || document.getElementById('conta-valor');
                        if (vNF && valorInput) valorInput.value = parseFloat(vNF).toFixed(2).replace('.', ',');
                        const dhEmi = getTag('dhEmi') || getTag('dEmi');
                        const emissaoInput = document.getElementById('emissaoForm') || document.getElementById('conta-emissao');
                        if (dhEmi && emissaoInput) emissaoInput.value = dhEmi.substring(0, 10);
                        
                        showToast('success', 'NF-e Importada!', 'Dados da NF-e preenchidos. Verifique e complete os campos.');
                    } catch (err) {
                        console.error('Erro ao parsear XML:', err);
                        showToast('error', 'Erro', 'Erro ao ler o arquivo XML da NF-e.');
                    }
                };
                reader.readAsText(file);
            } else {
                showToast('warning', 'Atenção', 'Para importação automática, envie o arquivo XML da NF-e.');
                fecharModalNFe();
                abrirModalContaPrincipal();
            }
            input.value = '';
        }
        function uploadBoleto() {
            document.getElementById('inputBoleto').click();
        }
        function processarBoleto(input) {
            if (!input.files || !input.files[0]) return;
            showToast('info', 'Boleto Anexado', 'Boleto "' + input.files[0].name + '" anexado. Preencha os dados ou use o código de barras.');
            input.value = '';
        }
        function processarCodigoBarras() {
            const codigo = document.getElementById('codigoBarrasInput').value;
            if (!codigo) {
                alert('Digite o código de barras');
                return;
            }
            fecharModalCodigoBarras();
            abrirModalContaPrincipal();
            document.getElementById('codigoBarrasForm').value = codigo;
        }
        function abrirModalRecebimentoInterno() {
            // Abre modal de recebimento interno
            alert('Funcionalidade de registrar recebimento');
        }
        
        // Função para abrir o modal principal de conta
        function abrirModalContaPrincipal() {
            contaEditando = null;
            document.getElementById('modalTitle').textContent = 'Nova Conta a Receber';
            document.getElementById('formConta').reset();
            document.getElementById('contaId').value = '';
            document.getElementById('dataEmissao').value = new Date().toISOString().split('T')[0];
            document.getElementById('dataRegistro').value = new Date().toISOString().split('T')[0];
            document.getElementById('modalConta').classList.add('active');
            
            // Resetar para primeira aba
            document.querySelectorAll('.tab-conta').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-pane-conta').forEach(p => p.classList.remove('active'));
            document.querySelector('.tab-conta[data-tab="detalhes"]').classList.add('active');
            document.getElementById('tab-detalhes').classList.add('active');
        }
    </script>

    <!-- Modal Receber - Design SaaS Empresarial -->
    <div class="modal-overlay modal-overlay-padrão" id="modalReceber">
        <div class="modal modal-padrão" style="max-width: 900px; width: 95%;">
            <!-- Header SaaS - Verde Lima -->
            <div class="modal-header-padrão">
                <div class="header-left">
                    <div class="header-icon">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div>
                        <h2>Registrar Recebimento</h2>
                        <p class="subtitle">Confirme os dados do recebimento</p>
                    </div>
                </div>
                <button class="modal-close-padrão" onclick="fecharModalReceber()" type="button" title="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <!-- Body SaaS -->
            <div class="modal-body-padrão" style="padding: 0;">
                <!-- Card Principal com Cliente e Valor -->
                <div style="padding: 40px 48px; background: #ffffff;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 32px;">
                        <div>
                            <span style="font-size: 13px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Cliente</span>
                            <div id="receberCliente" style="font-size: 20px; font-weight: 600; color: #374151; margin-top: 10px;"></div>
                        </div>
                        <div style="text-align: right;">
                            <span style="font-size: 13px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Valor Original</span>
                            <div id="receberValorOriginal" style="font-size: 42px; font-weight: 700; color: #65a30d; margin-top: 8px; font-family: 'Inter', system-ui, sans-serif;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Seo de Detalhes do Recebimento -->
                <div style="padding: 32px 48px;">
                    <span style="font-size: 13px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; display: block; margin-bottom: 20px;">Dados do Recebimento</span>
                    
                    <div style="background: #ffffff; border-radius: 20px; border: 1px solid #e5e7eb; overflow: hidden;">
                        <!-- Grid 2x2 para campos do formulrio -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr;">
                            <!-- Valor Recebido -->
                            <div style="padding: 24px 28px; border-bottom: 1px solid #f3f4f6; border-right: 1px solid #f3f4f6;">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                    <div style="width: 44px; height: 44px; background: #f7fee7; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-money-bill-wave" style="color: #65a30d; font-size: 18px;"></i>
                                    </div>
                                    <label style="font-size: 13px; font-weight: 600; color: #374151;">Valor Recebido <span style="color: #ef4444;">*</span></label>
                                </div>
                                <div style="position: relative;">
                                    <span style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); font-size: 16px; font-weight: 600; color: #65a30d;">R$</span>
                                    <input type="text" id="receberValor" placeholder="0,00" oninput="formatarMoedaInput(this)" style="width: 100%; padding: 16px 16px 16px 50px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 22px; font-weight: 700; color: #65a30d; transition: all 0.2s; box-sizing: border-box; background: #f9fafb;">
                                </div>
                            </div>
                            
                            <!-- Data do Recebimento -->
                            <div style="padding: 24px 28px; border-bottom: 1px solid #f3f4f6;">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                    <div style="width: 44px; height: 44px; background: #eff6ff; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-calendar-alt" style="color: #3b82f6; font-size: 18px;"></i>
                                    </div>
                                    <label style="font-size: 13px; font-weight: 600; color: #374151;">Data do Recebimento <span style="color: #ef4444;">*</span></label>
                                </div>
                                <input type="date" id="receberData" style="width: 100%; padding: 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; color: #374151; transition: all 0.2s; box-sizing: border-box; background: #f9fafb;">
                            </div>
                            
                            <!-- Conta Bancária -->
                            <div style="padding: 24px 28px; border-right: 1px solid #f3f4f6;">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                    <div style="width: 44px; height: 44px; background: #faf5ff; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-university" style="color: #8b5cf6; font-size: 18px;"></i>
                                    </div>
                                    <label style="font-size: 13px; font-weight: 600; color: #374151;">Conta Bancária</label>
                                </div>
                                <select id="receberConta" style="width: 100%; padding: 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; color: #374151; background: #f9fafb; cursor: pointer; transition: all 0.2s; box-sizing: border-box;">
                                    <option value="">Selecione a conta</option>
                                    <option value="itau">Itaú</option>
                                    <option value="bradesco">Bradesco</option>
                                    <option value="bb">Banco do Brasil</option>
                                    <option value="nubank">Nubank</option>
                                    <option value="caixa">Caixa Geral</option>
                                </select>
                            </div>
                            
                            <!-- Forma de Recebimento -->
                            <div style="padding: 24px 28px;">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                    <div style="width: 44px; height: 44px; background: #fef3c7; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-credit-card" style="color: #f59e0b; font-size: 18px;"></i>
                                    </div>
                                    <label style="font-size: 13px; font-weight: 600; color: #374151;">Forma de Recebimento</label>
                                </div>
                                <select id="receberFormaRecebimento" style="width: 100%; padding: 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; color: #374151; background: #f9fafb; cursor: pointer; transition: all 0.2s; box-sizing: border-box;">
                                    <option value="boleto">Boleto</option>
                                    <option value="pix">PIX</option>
                                    <option value="transferencia">Transferência</option>
                                    <option value="dinheiro">Dinheiro</option>
                                    <option value="cartao">Cartão</option>
                                    <option value="cheque">Cheque</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Juros/Multa e Desconto -->
                    <div style="margin-top: 24px; background: #ffffff; border-radius: 20px; border: 1px solid #e5e7eb; overflow: hidden;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr;">
                            <!-- Juros/Multa Recebidos -->
                            <div style="display: flex; align-items: center; padding: 24px 28px; border-right: 1px solid #f3f4f6;">
                                <div style="width: 44px; height: 44px; background: #f0fdf4; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px;">
                                    <i class="fas fa-percentage" style="color: #22c55e; font-size: 18px;"></i>
                                </div>
                                <div style="flex: 1;">
                                    <span style="font-size: 13px; color: #9ca3af; display: block; margin-bottom: 8px; font-weight: 600;">Juros/Multa Recebidos</span>
                                    <div style="position: relative;">
                                        <span style="position: absolute; left: 14px; top: 50%; transform: translateY(-50%); font-size: 14px; color: #9ca3af;">R$</span>
                                        <input type="text" id="receberJuros" placeholder="0,00" oninput="formatarMoedaInput(this)" style="width: 100%; padding: 14px 14px 14px 42px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; color: #22c55e; font-weight: 600; transition: all 0.2s; box-sizing: border-box; background: #f9fafb;">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Desconto Concedido -->
                            <div style="display: flex; align-items: center; padding: 24px 28px;">
                                <div style="width: 44px; height: 44px; background: #fef2f2; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-right: 16px;">
                                    <i class="fas fa-tag" style="color: #ef4444; font-size: 18px;"></i>
                                </div>
                                <div style="flex: 1;">
                                    <span style="font-size: 13px; color: #9ca3af; display: block; margin-bottom: 8px; font-weight: 600;">Desconto Concedido</span>
                                    <div style="position: relative;">
                                        <span style="position: absolute; left: 14px; top: 50%; transform: translateY(-50%); font-size: 14px; color: #9ca3af;">R$</span>
                                        <input type="text" id="receberDesconto" placeholder="0,00" oninput="formatarMoedaInput(this)" style="width: 100%; padding: 14px 14px 14px 42px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; color: #ef4444; font-weight: 600; transition: all 0.2s; box-sizing: border-box; background: #f9fafb;">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer SaaS - igual ação modal de detalhes -->
            <div class="modal-footer-saas" style="padding: 24px 48px; background: #ffffff; border-top: 1px solid #e5e7eb; display: flex; gap: 16px; justify-content: flex-end;">
                <button onclick="fecharModalReceber()" style="padding: 14px 28px; border: 1px solid #e5e7eb; background: #ffffff; border-radius: 12px; font-size: 15px; font-weight: 500; color: #6b7280; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-times" style="font-size: 14px;"></i> Cancelar
                </button>
                <button onclick="confirmarRecebimento()" style="padding: 14px 32px; border: none; background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); border-radius: 12px; font-size: 15px; font-weight: 600; color: #ffffff; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 10px; box-shadow: 0 4px 14px rgba(34, 197, 94, 0.4);">
                    <i class="fas fa-check" style="font-size: 14px;"></i> Confirmar Recebimento
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Visualizar Conta - Design SaaS Empresarial EXPANDIDO -->
    <div class="modal-overlay-padrão" id="modalVisualizarConta">
        <div class="modal-padrão" style="max-width: 900px; width: 95%; border-radius: 24px; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);">
            <!-- Header Verde Lima -->
            <div class="modal-header-padrão">
                <div class="modal-header-content-padrão">
                    <div class="modal-header-icon-padrão">
                        <i class="fas fa-file-invoice-dollar"></i>
                    </div>
                    <div class="modal-header-text-padrão">
                        <h2>Detalhes da Conta</h2>
                        <p>Contas a Receber</p>
                    </div>
                </div>
                <button class="modal-close-padrão" onclick="fecharModalVisualizar()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body-padrão" style="padding: 0; background: #f9fafb; max-height: 70vh; overflow-y: auto;">
                <!-- Card Principal com Status e Valor -->
                <div style="padding: 40px 48px; background: #ffffff;">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 32px;">
                        <div>
                            <span style="font-size: 13px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Status</span>
                            <div id="visualizarStatusBadge" style="margin-top: 12px;"></div>
                        </div>
                        <div style="text-align: right;">
                            <span style="font-size: 13px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600;">Valor Total</span>
                            <div id="visualizarValorDestaque" style="font-size: 48px; font-weight: 700; color: #84cc16; margin-top: 8px; font-family: 'Inter', system-ui, sans-serif;"></div>
                        </div>
                    </div>
                    
                    <!-- Linha de Informações Principais -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; padding-top: 24px; border-top: 1px solid #f3f4f6;">
                        <div>
                            <span style="font-size: 11px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 500; display: block; margin-bottom: 6px;">Cliente</span>
                            <div id="visualizarCliente" style="font-size: 15px; font-weight: 500; color: #374151;"></div>
                        </div>
                        <div>
                            <span style="font-size: 11px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 500; display: block; margin-bottom: 6px;">Vencimento</span>
                            <div id="visualizarVencimento" style="font-size: 15px; font-weight: 500; color: #374151;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Seção de Detalhes -->
                <div style="padding: 24px 32px;">
                    <span style="font-size: 11px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; display: block; margin-bottom: 14px;">Informações do Recebimento</span>
                    
                    <div style="background: #ffffff; border-radius: 12px; border: 1px solid #e5e7eb; overflow: hidden;">
                        <!-- Forma de Recebimento -->
                        <div style="display: flex; align-items: center; padding: 16px 20px; border-bottom: 1px solid #f3f4f6;">
                            <div style="width: 36px; height: 36px; background: #f7fee7; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 14px;">
                                <i class="fas fa-credit-card" style="color: #84cc16; font-size: 14px;"></i>
                            </div>
                            <div style="flex: 1;">
                                <span style="font-size: 11px; color: #9ca3af; display: block; margin-bottom: 2px;">Forma de Recebimento</span>
                                <span id="visualizarForma" style="font-size: 14px; font-weight: 500; color: #374151; text-transform: capitalize;"></span>
                            </div>
                        </div>
                        
                        <!-- Conta Bancária -->
                        <div style="display: flex; align-items: center; padding: 16px 20px; border-bottom: 1px solid #f3f4f6;">
                            <div style="width: 36px; height: 36px; background: #f7fee7; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 14px;">
                                <i class="fas fa-university" style="color: #84cc16; font-size: 14px;"></i>
                            </div>
                            <div style="flex: 1;">
                                <span style="font-size: 11px; color: #9ca3af; display: block; margin-bottom: 2px;">Conta Bancária</span>
                                <span id="visualizarConta" style="font-size: 14px; font-weight: 500; color: #374151;"></span>
                            </div>
                        </div>
                        
                        <!-- Categoria -->
                        <div style="display: flex; align-items: center; padding: 16px 20px;">
                            <div style="width: 36px; height: 36px; background: #fdf4ff; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin-right: 14px;">
                                <i class="fas fa-tag" style="color: #a855f7; font-size: 14px;"></i>
                            </div>
                            <div style="flex: 1;">
                                <span style="font-size: 11px; color: #9ca3af; display: block; margin-bottom: 2px;">Categoria</span>
                                <span id="visualizarCategoria" style="font-size: 14px; font-weight: 500; color: #374151; text-transform: capitalize;"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Info de Recebimento (quando recebido) -->
                    <div id="visualizarRecebimentoInfo" style="display: none; margin-top: 16px; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 12px; padding: 16px; border: 1px solid #bbf7d0;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
                            <i class="fas fa-check-circle" style="color: #22c55e;"></i>
                            <span style="font-size: 12px; font-weight: 600; color: #166534; text-transform: uppercase; letter-spacing: 0.5px;">Recebimento Realizado</span>
                        </div>
                        <div>
                            <span style="font-size: 11px; color: #15803d; display: block;">Data</span>
                            <span id="visualizarDataRecebimento" style="font-size: 14px; font-weight: 600; color: #166534;"></span>
                        </div>
                    </div>
                    
                    <!-- Descrição -->
                    <div style="margin-top: 20px;">
                        <span style="font-size: 11px; color: #9ca3af; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; display: block; margin-bottom: 10px;">Descrição</span>
                        <div style="background: #ffffff; border-radius: 12px; border: 1px solid #e5e7eb; padding: 16px 20px; min-height: 60px;">
                            <p id="visualizardescrição" style="margin: 0; font-size: 14px; color: #6b7280; line-height: 1.6;"></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer com Botes Modernos -->
            <div class="modal-footer-padrão" style="display: flex; gap: 12px; justify-content: flex-end;">
                <button class="btn-padrão-ghost" onclick="fecharModalVisualizar()">
                    <i class="fas fa-times"></i> Fechar
                </button>
                <button class="btn-padrão-ghost" id="btnEditarDoModal" onclick="editarDoModal()">
                    <i class="fas fa-pen"></i> Editar
                </button>
                <button class="btn-padrão-primary" id="btnReceberDoModal" onclick="receberDoModal()">
                    <i class="fas fa-check"></i> Receber
                </button>
            </div>
        </div>
    </div>

    <!-- API Client do Financeiro -->
    <script src="js/financeiro-api.js"></script>
    
    <script>
        // ===========================================
        // VARIVEIS GLOBAIS
        // ===========================================
        let contas = [];
        let contasOriginais = [];
        let filtroAtual = 'todas';
        let paginaAtual = 1;
        const itensPorPagina = 15;
        let contaEditando = null;
        let contaRecebendo = null;
        let isLoading = false;

        // ===========================================
        // INICIALIZAO
        // ===========================================
        document.addEventListener('DOMContentLoaded', async function() {
            carregarUsuario();
            await carregarContasDoServidor();
        });

        async function carregarUsuario() {
            try {
                const response = await fetch('/api/me', { credentials: 'include' });
                if (response.ok) {
                    const user = await response.json();
                    // Usar apelido se disponá­vel, seno primeiro nome
                    const userName = user.apelido || user.nome || 'Usuário';
                    const primeiroNome = user.apelido || (user.nome ? user.nome.split(' ')[0] : 'Usuário');

                    // Atualizar Saudação dinçmica baseada na hora
                    const greetingTextEl = document.getElementById('greeting-text');
                    if (greetingTextEl) {
                        const hour = new Date().getHours();
                        let greeting = 'Bom dia';
                        if (hour >= 12 && hour < 18) greeting = 'Boa tarde';
                        else if (hour >= 18 || hour < 5) greeting = 'Boa noite';
                        greetingTextEl.textContent = greeting;
                    }
                    document.getElementById('user-name').textContent = primeiroNome;
                    document.getElementById('user-initials').textContent = primeiroNome.charAt(0).toUpperCase();
                    
                    // Carregar foto do usuário - verificar mltiplos campos
                    const fotoUrl = user.avatar || user.foto || user.foto_perfil_url;
                    const fotoEl = document.getElementById('user-photo');
                    const inicialEl = document.getElementById('user-initials');
                    
                    if (fotoUrl && fotoUrl !== '/avatars/default.webp') {
                        fotoEl.src = fotoUrl;
                        fotoEl.onload = () => {
                            fotoEl.classList.add('visible');
                            fotoEl.style.display = 'block';
                            if (inicialEl) inicialEl.style.display = 'none';
                        };
                        fotoEl.onerror = () => {
                            fotoEl.style.display = 'none';
                            if (inicialEl) inicialEl.style.display = 'flex';
                        };
                    } else {
                        // Sem foto - mostrar iniciais
                        if (fotoEl) fotoEl.style.display = 'none';
                        if (inicialEl) inicialEl.style.display = 'flex';
                    }
                    
                    console.log('[Contas Receber] Usuário carregado:', primeiroNome, '| Foto:', fotoUrl ? 'Sim' : 'Não');
                }
            } catch (e) { console.log('Erro ao carregar usuário'); }
        }

        function formatarMoeda(valor) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor);
        }

        // Formata data ISO para formato yyyy-MM-dd (compatvel com input type="date")
        function formatarDataParaInput(dataISO) {
            if (!dataISO) return '';
            try {
                const data = new Date(dataISO);
                if (isNaN(data.getTime())) return '';
                return data.toISOString().split('T')[0];
            } catch (e) {
                console.warn('Erro ao formatar data:', dataISO, e);
                return '';
            }
        }

        // ===========================================
        // CARREGAR DADOS DO SERVIDOR
        // ===========================================
        async function carregarContasDoServidor() {
            if (isLoading) return;
            isLoading = true;
            
            const tbody = document.getElementById('contasTableBody');
            tbody.innerHTML = `
                <tr>
                    <td colspan="11" style="text-align: center; padding: 60px;">
                        <i class="fas fa-spinner fa-spin fa-2x" style="color: #22c55e;"></i>
                        <p style="margin-top: 16px; color: #64748b;">Carregando contas a receber...</p>
                    </td>
                </tr>
            `;
            
            try {
                const response = await fetch('/api/financeiro/contas-receber', { credentials: 'include' });
                
                if (!response.ok) {
                    throw new Error('Erro ao carregar contas');
                }
                
                const data = await response.json();
                const raw = data.data || data || [];
                contasOriginais = Array.isArray(raw) ? raw : [];
                
                // Normalizar dados do banco
                contas = contasOriginais.map(c => ({
                    id: c.id,
                    cliente: c.cliente_nome || c.descrição || 'Cliente não informado',
                    descrição: c.descrição || c.observacoes || '',
                    categoria: c.categoria || (c.categoria_id ? 'vendas' : 'outros'),
                    valor: parseFloat(c.valor || c.valor_total) || 0,
                    vencimento: extrairDataYMD(c.data_vencimento || c.vencimento),
                    status: calcularStatus(c),
                    forma: c.forma_recebimento || 'boleto',
                    conta: c.banco_id || '',
                    doc: '',
                    dataRecebimento: c.data_recebimento,
                    valorRecebido: parseFloat(c.valor_recebido) || 0,
                    parcelaNumero: c.parcela_numero || 1,
                    totalParcelas: c.total_parcelas || 1,
                    observacoes: c.observacoes || ''
                }));
                
                atualizarKPIs();
                renderizarTabela();
                
            } catch (error) {
                console.error('Erro ao carregar contas:', error);
                tbody.innerHTML = `
                    <tr>
                        <td colspan="11" style="text-align: center; padding: 60px;">
                            <i class="fas fa-exclamation-triangle fa-2x" style="color: #ef4444;"></i>
                            <p style="margin-top: 16px; color: #64748b;">Erro ao carregar dados. <a href="javascript:carregarContasDoServidor()" style="color: #22c55e;">Tentar novamente</a></p>
                        </td>
                    </tr>
                `;
            } finally {
                isLoading = false;
            }
        }
        
        function calcularStatus(conta) {
            if (conta.status === 'recebido' || conta.status === 'pago') return 'recebido';
            if (conta.status === 'parcial') return 'parcial';
            
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            const vencimento = new Date(conta.data_vencimento || conta.vencimento);
            vencimento.setHours(0, 0, 0, 0);
            
            if (vencimento < hoje && conta.status !== 'recebido') {
                return 'vencido';
            }
            
            return conta.status || 'pendente';
        }

        function formatarMoedaInput(input) {
            let valor = input.value.replace(/\D/g, '');
            if (!valor) { input.value = ''; return; }
            valor = (parseInt(valor) / 100).toFixed(2);
            input.value = formatarMoeda(valor);
        }

        function parseMoeda(str) {
            return parseFloat(str.replace(/[^\d,]/g, '').replace(',', '.')) || 0;
        }

        function formatarData(data) {
            if (!data) return '-';
            try {
                // Se a data j  um objeto Date ou ISO string completa
                const d = new Date(data);
                if (!isNaN(d.getTime())) {
                    return d.toLocaleDateString('pt-BR');
                }
                // Tenta como data simples YYYY-MM-DD
                const d2 = new Date(data + 'T00:00:00');
                if (!isNaN(d2.getTime())) {
                    return d2.toLocaleDateString('pt-BR');
                }
                return '-';
            } catch (e) {
                return '-';
            }
        }

        // Funo para extrair data no formato YYYY-MM-DD
        function extrairDataYMD(data) {
            if (!data) return null;
            try {
                const d = new Date(data);
                if (!isNaN(d.getTime())) {
                    return d.toISOString().split('T')[0];
                }
                return data.split('T')[0];
            } catch (e) {
                return null;
            }
        }

        function atualizarKPIs() {
            const hoje = new Date().toISOString().split('T')[0];
            const totalReceber = contas.filter(c => c.status !== 'recebido').reduce((s, c) => s + c.valor, 0);
            const vencidas = contas.filter(c => c.status === 'vencido' || (c.status === 'pendente' && c.vencimento < hoje)).reduce((s, c) => s + c.valor, 0);
            const venceHoje = contas.filter(c => c.status === 'pendente' && c.vencimento === hoje).reduce((s, c) => s + c.valor, 0);
            const recebidoMes = contas.filter(c => c.status === 'recebido').reduce((s, c) => s + c.valor, 0);

            document.getElementById('totalReceber').textContent = formatarMoeda(totalReceber);
            document.getElementById('vencidas').textContent = formatarMoeda(vencidas);
            document.getElementById('venceHoje').textContent = formatarMoeda(venceHoje);
            document.getElementById('recebidoMes').textContent = formatarMoeda(recebidoMes);
        }

        function getContasFiltradas() {
            const busca = document.getElementById('searchInput').value.toLowerCase();
            const hoje = new Date().toISOString().split('T')[0];
            
            return contas.filter(c => {
                // Atualiza status de vencidas
                if (c.status === 'pendente' && c.vencimento < hoje) c.status = 'vencido';
                
                // Filtro de status
                if (filtroAtual !== 'todas' && c.status !== filtroAtual) return false;
                
                // Filtro de busca
                if (busca && !c.cliente.toLowerCase().includes(busca) && !c.descrição.toLowerCase().includes(busca)) return false;
                
                return true;
            });
        }

        function renderizarTabela() {
            const contasFiltradas = getContasFiltradas();
            const inicio = (paginaAtual - 1) * itensPorPagina;
            const fim = inicio + itensPorPagina;
            const contasPagina = contasFiltradas.slice(inicio, fim);

            const tbody = document.getElementById('contasTableBody');
            tbody.innerHTML = contasPagina.map(c => {
                const valorTotal = parseFloat(c.valor || 0);
                const valorPago = parseFloat(c.valor_pago || c.pago || 0);
                const saldo = valorTotal - valorPago;
                const vencOriginal = c.data_vencimento_original || c.vencimento_original || c.vencimento;
                const vencAtualizado = c.data_vencimento || c.vencimento_atualizado || c.vencimento;
                const documento = c.numero_documento || c.documento || '-';
                
                return `
                <tr>
                    <td><input type="checkbox" class="conta-checkbox" data-id="${c.id}"></td>
                    <td><strong>${documento}</strong></td>
                    <td>${c.cliente || c.cliente_nome || '-'}</td>
                    <td><span style="text-transform: capitalize;">${c.categoria || '-'}</span></td>
                    <td>${formatarData(vencOriginal)}</td>
                    <td>${formatarData(vencAtualizado)}</td>
                    <td class="valor-cell positivo"><strong>${formatarMoeda(valorTotal)}</strong></td>
                    <td>${formatarMoeda(valorPago)}</td>
                    <td>${formatarMoeda(saldo)}</td>
                    <td><span class="status-badge ${c.status}">${c.status === 'pendente' ? 'Pendente' : c.status === 'vencido' ? 'Vencido' : c.status === 'recebido' ? 'Recebido' : 'Parcial'}</span></td>
                    <td>
                        <button class="btn-action view" title="Ver" onclick="verConta(${c.id})"><i class="fas fa-eye"></i></button>
                        ${c.status !== 'recebido' ? `<button class="btn-action receive" title="Receber" onclick="abrirModalReceber(${c.id})"><i class="fas fa-check"></i></button>` : ''}
                        <button class="btn-action edit" title="Editar" onclick="abrirEditarConta(${c.id})"><i class="fas fa-edit"></i></button>
                        <button class="btn-action delete" title="Excluir" onclick="excluirConta(${c.id})"><i class="fas fa-trash"></i></button>
                    </td>
                </tr>
            `}).join('');

            document.getElementById('paginaAtual').textContent = `${inicio + 1}-${Math.min(fim, contasFiltradas.length)}`;
            document.getElementById('totalRegistros').textContent = contasFiltradas.length;
            renderizarPaginacao(contasFiltradas.length);
        }

        function renderizarPaginacao(total) {
            const totalPaginas = Math.ceil(total / itensPorPagina);
            const container = document.getElementById('paginationControls');
            let html = `<button class="pagination-btn" onclick="mudarPagina(${paginaAtual - 1})" ${paginaAtual === 1 ? 'disabled' : ''}><i class="fas fa-chevron-left"></i></button>`;
            for (let i = 1; i <= totalPaginas; i++) {
                html += `<button class="pagination-btn ${i === paginaAtual ? 'active' : ''}" onclick="mudarPagina(${i})">${i}</button>`;
            }
            html += `<button class="pagination-btn" onclick="mudarPagina(${paginaAtual + 1})" ${paginaAtual === totalPaginas ? 'disabled' : ''}><i class="fas fa-chevron-right"></i></button>`;
            container.innerHTML = html;
        }

        function mudarPagina(pagina) {
            const totalPaginas = Math.ceil(getContasFiltradas().length / itensPorPagina);
            if (pagina >= 1 && pagina <= totalPaginas) {
                paginaAtual = pagina;
                renderizarTabela();
            }
        }

        function filtrarStatus(status, btn) {
            filtroAtual = status;
            paginaAtual = 1;
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            if (btn) btn.classList.add('active');
            renderizarTabela();
        }

        function filtrarContas() {
            paginaAtual = 1;
            renderizarTabela();
        }

        // Modal - Abre o modal de escolha do método (estilo Omie)
        function abrirModalNovo() {
            document.getElementById('modalEscolhaMetodo').classList.add('active');
        }

        function abrirEditarConta(id) {
            console.log('[DEBUG] abrirEditarConta chamado com id:', id);
            
            contaEditando = contas.find(c => c.id === id);
            
            if (!contaEditando) {
                alert('Conta não encontrada!');
                return;
            }
            
            document.getElementById('modalTitle').textContent = 'Editar Conta a Receber';
            document.getElementById('contaId').value = contaEditando.id;
            document.getElementById('cliente').value = contaEditando.cliente || '';
            document.getElementById('valor').value = formatarMoeda(contaEditando.valor || 0);
            document.getElementById('vencimento').value = formatarDataParaInput(contaEditando.vencimento);
            document.getElementById('categoria').value = contaEditando.categoria || '';
            
            // Campo observações no novo modal
            const observacoes = document.getElementById('observacoes');
            if (observacoes) observacoes.value = contaEditando.descrição || contaEditando.observacoes || '';
            
            const contaBancaria = document.getElementById('contaBancaria');
            if (contaBancaria) contaBancaria.value = contaEditando.conta || '';
            
            // Resetar para primeira aba
            document.querySelectorAll('.tab-conta').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-pane-conta').forEach(p => p.classList.remove('active'));
            const primeiraAba = document.querySelector('.tab-conta[data-tab="detalhes"]');
            if (primeiraAba) primeiraAba.classList.add('active');
            const primeiroPane = document.getElementById('tab-detalhes');
            if (primeiroPane) primeiroPane.classList.add('active');
            
            document.getElementById('modalConta').classList.add('active');
        }

        function fecharModal() {
            console.log('fecharModal() chamada - contas-receber.html');
            document.getElementById('modalConta').classList.remove('active');
        }
        
        // Atualizar resumo da conta (compatibilidade - agora não usado no novo modal)
        function atualizarResumo() {
            const cliente = document.getElementById('cliente')?.value || '-';
            const valor = document.getElementById('valor')?.value || 'R$ 0,00';
            const vencimento = document.getElementById('vencimento')?.value;
            
            const resumoCliente = document.getElementById('resumoCliente');
            const resumoValor = document.getElementById('resumoValor');
            const resumoVencimento = document.getElementById('resumoVencimento');
            
            if (resumoCliente) resumoCliente.textContent = cliente || '-';
            if (resumoValor) resumoValor.textContent = valor || 'R$ 0,00';
            if (resumoVencimento) resumoVencimento.textContent = vencimento ? formatarData(vencimento) : '-';
        }
        
        // Atualizar steps visuais
        function atualizarSteps() {
            const cliente = document.getElementById('cliente')?.value || '';
            const valor = document.getElementById('valor')?.value || '';
            const vencimento = document.getElementById('vencimento')?.value || '';
            const categoria = document.getElementById('categoria')?.value || '';
            
            const steps = document.querySelectorAll('.modal-step-saas');
            if (!steps || steps.length < 4) return; // Segurana se no encontrar os steps
            
            // Step 1: Cliente
            if (cliente) {
                steps[0].classList.add('completed');
                steps[0].classList.remove('active');
            } else {
                steps[0].classList.remove('completed');
                steps[0].classList.add('active');
            }
            
            // Step 2: Financeiro
            if (valor && parseMoeda(valor) > 0 && vencimento) {
                steps[1].classList.add('completed');
            } else {
                steps[1].classList.remove('completed');
                if (cliente) steps[1].classList.add('active');
            }
            
            // Step 3: Documento
            if (categoria) {
                steps[2].classList.add('completed');
            } else {
                steps[2].classList.remove('completed');
            }
            
            // Step 4: Confirmação
            if (cliente && valor && parseMoeda(valor) > 0 && vencimento && categoria) {
                steps[3].classList.add('active');
            } else {
                steps[3].classList.remove('active');
            }
        }
        
        // Formatar CNPJ/CPF
        function formatarCnpjCpf(input) {
            let valor = input.value.replace(/\D/g, '');
            
            if (valor.length <= 11) {
                // CPF: 000.000.000-00
                valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
                valor = valor.replace(/(\d{3})(\d)/, '$1.$2');
                valor = valor.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            } else {
                // CNPJ: 00.000.000/0000-00
                valor = valor.replace(/^(\d{2})(\d)/, '$1.$2');
                valor = valor.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                valor = valor.replace(/\.(\d{3})(\d)/, '.$1/$2');
                valor = valor.replace(/(\d{4})(\d)/, '$1-$2');
            }
            
            input.value = valor;
        }

        async function salvarContaLocal() {
            console.log('salvarContaLocal() chamada - contas-receber.html');
            // Coletar todos os dados do formulario - Novo modal estilo Omie
            const dados = {
                cliente: document.getElementById('cliente').value,
                valor: parseMoeda(document.getElementById('valor').value),
                vencimento: document.getElementById('vencimento').value,
                categoria: document.getElementById('categoria')?.value || '',
                descricao: document.getElementById('observacoes')?.value || '',
                conta: document.getElementById('contaBancaria')?.value || '',
                doc: document.getElementById('numeroDoc')?.value || '',
                dataEmissao: document.getElementById('dataEmissao')?.value || '',
                projeto: document.getElementById('projeto')?.value || '',
                numeroPedido: document.getElementById('numeroPedido')?.value || '',
                tipoDocumento: document.getElementById('tipoDocumento')?.value || 'outros',
                chaveNFe: document.getElementById('chaveNFeForm')?.value || '',
                codigoBarras: document.getElementById('codigoBarrasForm')?.value || '',
                vendedor: document.getElementById('vendedor')?.value || '',
                status: 'pendente'
            };

            // Validacao de campos obrigatorios
            if (!dados.cliente) {
                showToast('warning', 'Campo obrigatório', 'Por favor, informe o cliente.');
                document.getElementById('cliente').focus();
                return;
            }
            
            if (!dados.valor || dados.valor <= 0) {
                showToast('warning', 'Campo obrigatório', 'Por favor, informe um valor válido.');
                document.getElementById('valor').focus();
                return;
            }
            
            if (!dados.vencimento) {
                showToast('warning', 'Campo obrigatório', 'Por favor, informe a data de vencimento.');
                document.getElementById('vencimento').focus();
                return;
            }

            const isEdicao = !!contaEditando;
            
            // Animacao de loading no botao lateral
            const btnSalvar = document.querySelector('.btn-salvar-lateral');
            const btnTextoOriginal = btnSalvar ? btnSalvar.innerHTML : '';
            if (btnSalvar) {
                btnSalvar.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                btnSalvar.disabled = true;
            }
            
            try {
                const dadosAPI = {
                    descricao: dados.descricao || dados.cliente,
                    valor: dados.valor,
                    data_vencimento: dados.vencimento,
                    data_emissao: dados.dataEmissao || null,
                    forma_recebimento: 'boleto',
                    banco_id: dados.conta || null,
                    observacoes: dados.descricao,
                    categoria_id: null,
                    parcela_numero: 1,
                    total_parcelas: 1,
                    numero_documento: dados.doc || null,
                    numero_pedido: dados.numeroPedido || null,
                    projeto: dados.projeto || null,
                    tipo_documento: dados.tipoDocumento || 'outros',
                    chave_nfe: dados.chaveNFe || null,
                    codigo_barras: dados.codigoBarras || null,
                    vendedor_id: dados.vendedor || null
                };
                
                let response;
                if (isEdicao) {
                    response = await fetch(`/api/financeiro/contas-receber/${contaEditando.id}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify(dadosAPI)
                    });
                } else {
                    response = await fetch('/api/financeiro/contas-receber', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify(dadosAPI)
                    });
                }
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || 'Erro ao salvar conta');
                }
                
                fecharModal();
                await carregarContasDoServidor();
                
                if (isEdicao) {
                    showToast('success', 'Conta atualizada!', `A conta de ${dados.cliente} foi atualizada com sucesso.`);
                } else {
                    showToast('success', 'Conta cadastrada!', `Conta a receber de ${dados.cliente} no valor de ${formatarMoeda(dados.valor)} foi cadastrada.`);
                }
                
            } catch (error) {
                console.error('Erro ao salvar:', error);
                showToast('error', 'Erro ao salvar', error.message || 'Não foi possível salvar a conta. Tente novamente.');
            } finally {
                if (btnSalvar) {
                    btnSalvar.innerHTML = btnTextoOriginal;
                    btnSalvar.disabled = false;
                }
            }
        }

        // Sistema de Toast
        function showToast(type, title, message) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icon = type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-times-circle' : 'fa-exclamation-triangle';
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(toast);
            
            // Animar entrada
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Remover aps 4 segundos
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        // Receber
        function abrirModalReceber(id) {
            contaRecebendo = contas.find(c => c.id === id);
            if (!contaRecebendo) return;

            // Corrigido: usar textContent para elementos div, no value
            document.getElementById('receberCliente').textContent = contaRecebendo.cliente || 'Cliente não informado';
            document.getElementById('receberValorOriginal').textContent = formatarMoeda(contaRecebendo.valor);
            document.getElementById('receberValor').value = formatarMoeda(contaRecebendo.valor);
            document.getElementById('receberData').valueAsDate = new Date();
            document.getElementById('receberConta').value = contaRecebendo.conta || '';
            document.getElementById('modalReceber').classList.add('active');
        }

        function fecharModalReceber() {
            document.getElementById('modalReceber').classList.remove('active');
        }

        async function confirmarRecebimento() {
            if (!contaRecebendo) return;
            
            const cliente = contaRecebendo.cliente;
            const valorRecebido = parseMoeda(document.getElementById('receberValor').value);
            const dataRecebimento = document.getElementById('receberData').value;
            const contaBancaria = document.getElementById('receberConta').value;
            
            if (!valorRecebido || valorRecebido <= 0) {
                showToast('warning', 'Valor inválido', 'Por favor, informe o valor recebido.');
                return;
            }
            
            if (!dataRecebimento) {
                showToast('warning', 'Data inválida', 'Por favor, informe a data do recebimento.');
                return;
            }
            
            try {
                const response = await fetch(`/api/financeiro/contas-receber/${contaRecebendo.id}/receber`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({
                        valor_recebido: valorRecebido,
                        data_recebimento: dataRecebimento,
                        banco_id: contaBancaria
                    })
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || 'Erro ao registrar recebimento');
                }
                
                fecharModalReceber();
                await carregarContasDoServidor();
                
                showToast('success', 'Recebimento Confirmado!', `${formatarMoeda(valorRecebido)} de ${cliente} foi registrado.`);
                
            } catch (error) {
                console.error('Erro ao receber:', error);
                showToast('error', 'Erro ao registrar recebimento', error.message || 'Não foi possível registrar o recebimento. Tente novamente.');
            }
        }

        let contaVisualizando = null;

        function verConta(id) {
            const conta = contas.find(c => c.id === id);
            if (!conta) return;
            
            contaVisualizando = conta;
            
            // Preencher dados no modal
            document.getElementById('visualizarCliente').textContent = conta.cliente;
            document.getElementById('visualizarValorDestaque').textContent = formatarMoeda(conta.valor);
            document.getElementById('visualizarVencimento').textContent = formatarData(conta.vencimento);
            document.getElementById('visualizarForma').textContent = conta.forma || 'Não informado';
            document.getElementById('visualizarConta').textContent = conta.conta || 'Não informado';
            document.getElementById('visualizarCategoria').textContent = conta.categoria || 'Não informado';
            document.getElementById('visualizardescrição').textContent = conta.descrição || 'Sem descrição';
            
            // Status badge - Design SaaS
            const statusBadge = document.getElementById('visualizarStatusBadge');
            const statusConfig = {
                'pendente': { text: 'Pendente', icon: 'fa-clock' },
                'vencido': { text: 'Vencido', icon: 'fa-exclamation-triangle' },
                'recebido': { text: 'Recebido', icon: 'fa-check-circle' },
                'parcial': { text: 'Parcial', icon: 'fa-adjust' }
            };
            const config = statusConfig[conta.status] || statusConfig['pendente'];
            statusBadge.innerHTML = `<span class="status-badge-saas ${conta.status}"><i class="fas ${config.icon}"></i> ${config.text}</span>`;
            
            // Info de recebimento (se houver)
            const recebimentoInfo = document.getElementById('visualizarRecebimentoInfo');
            if (conta.status === 'recebido' && conta.dataRecebimento) {
                recebimentoInfo.style.display = 'block';
                document.getElementById('visualizarDataRecebimento').textContent = formatarData(conta.dataRecebimento);
            } else {
                recebimentoInfo.style.display = 'none';
            }
            
            // Mostrar/ocultar boto de receber
            const btnReceber = document.getElementById('btnReceberDoModal');
            btnReceber.style.display = conta.status === 'recebido' ? 'none' : 'flex';
            
            // Abrir modal
            document.getElementById('modalVisualizarConta').classList.add('active');
        }

        function fecharModalVisualizar() {
            document.getElementById('modalVisualizarConta').classList.remove('active');
            contaVisualizando = null;
        }

        function editarDoModal() {
            if (contaVisualizando) {
                fecharModalVisualizar();
                abrirEditarConta(contaVisualizando.id);
            }
        }

        function receberDoModal() {
            if (contaVisualizando) {
                fecharModalVisualizar();
                abrirModalReceber(contaVisualizando.id);
            }
        }

        async function excluirConta(id) {
            const conta = contas.find(c => c.id === id);
            const cliente = conta ? conta.cliente : 'Conta';
            
            // Modal de confirmação profissional
            const confirmado = await showConfirmModal({
                type: 'danger',
                title: 'Excluir Conta a Receber',
                message: `Deseja realmente excluir a conta de "${cliente}"? Esta ação não pode ser desfeita.`,
                confirmText: 'Excluir',
                cancelText: 'Cancelar'
            });
            if (!confirmado) return;
            
            try {
                const response = await fetch(`/api/financeiro/contas-receber/${id}`, {
                    method: 'DELETE',
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.message || 'Erro ao excluir conta');
                }
                
                await carregarContasDoServidor();
                showToast('success', 'Conta excluída!', `A conta de ${cliente} foi removida com sucesso.`);
                
            } catch (error) {
                console.error('Erro ao excluir:', error);
                showToast('error', 'Erro ao excluir', error.message || 'Não foi possível excluir a conta. Tente novamente.');
            }
        }

        function toggleSelectAll() {
            const checked = document.getElementById('selectAll').checked;
            document.querySelectorAll('.conta-checkbox').forEach(cb => cb.checked = checked);
        }

        async function excluirSelecionados() {
            const ids = [...document.querySelectorAll('.conta-checkbox:checked')].map(cb => parseInt(cb.dataset.id));
            if (ids.length === 0) {
                showToast('warning', 'Nenhuma seleção', 'Selecione pelo menos uma conta para excluir.');
                return;
            }
            
            // Modal de confirmação profissional
            const confirmado = await showConfirmModal({
                type: 'danger',
                title: 'Excluir Contas Selecionadas',
                message: `Deseja excluir ${ids.length} conta(s) selecionada(s)? Esta ação não pode ser desfeita.`,
                confirmText: 'Excluir Todas',
                cancelText: 'Cancelar'
            });
            if (!confirmado) return;
            
            try {
                let erros = 0;
                for (const id of ids) {
                    try {
                        const response = await fetch(`/api/financeiro/contas-receber/${id}`, {
                            method: 'DELETE',
                            credentials: 'include'
                        });
                        if (!response.ok) erros++;
                    } catch (e) {
                        erros++;
                    }
                }
                
                await carregarContasDoServidor();
                
                if (erros === 0) {
                    showToast('success', 'Contas excluídas!', `${ids.length} conta(s) foram removidas com sucesso.`);
                } else {
                    showToast('warning', 'Parcialmente excluído', `${ids.length - erros} conta(s) excluídas, ${erros} erro(s).`);
                }
            } catch (error) {
                console.error('Erro ao excluir:', error);
                showToast('error', 'Erro ao excluir', 'Não foi possível excluir as contas. Tente novamente.');
            }
        }

        function exportarDados() {
            const contasFiltradas = getContasFiltradas();
            if (contasFiltradas.length === 0) {
                showToast('warning', 'Nenhum dado', 'Não há dados para exportar.');
                return;
            }
            
            // Criar CSV
            const headers = ['ID', 'Cliente', 'Descrição', 'Categoria', 'Valor', 'Vencimento', 'Status', 'Forma Recebimento'];
            const rows = contasFiltradas.map(c => [
                c.id,
                `"${c.cliente}"`,
                `"${c.descrição}"`,
                c.categoria,
                c.valor,
                c.vencimento,
                c.status,
                c.forma
            ]);
            
            const csv = [headers.join(';'), ...rows.map(r => r.join(';'))].join('\n');
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `contas-receber-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
            URL.revokeObjectURL(url);
            
            showToast('success', 'Exportado!', `${contasFiltradas.length} contas exportadas para CSV.`);
        }

        // Fechar modal ação pressionar ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });

        // Atualizar resumo ação digitar
        document.getElementById('cliente')?.addEventListener('input', function() {
            atualizarResumo();
            atualizarSteps();
        });

        document.getElementById('valor')?.addEventListener('input', function() {
            atualizarResumo();
            atualizarSteps();
        });

        document.getElementById('vencimento')?.addEventListener('change', function() {
            atualizarResumo();
            atualizarSteps();
        });

        document.getElementById('categoria')?.addEventListener('change', function() {
            atualizarSteps();
        });

        // Validação visual dos campos obrigatórios
        function validarCamposObrigatorios() {
            let valido = true;
            const camposObrigatorios = [
                { id: 'cliente', nome: 'Cliente' },
                { id: 'valor', nome: 'Valor' },
                { id: 'vencimento', nome: 'Data de Vencimento' }
            ];
            
            camposObrigatorios.forEach(campo => {
                const elemento = document.getElementById(campo.id);
                const grupo = elemento.closest('.form-group');
                const valor = elemento.value.trim();
                
                if (!valor || valor === 'R$ 0,00') {
                    grupo.classList.add('has-error');
                    valido = false;
                } else {
                    grupo.classList.remove('has-error');
                }
            });
            
            return valido;
        }

        // Remover Erro ao digitar
        document.querySelectorAll('#formConta input, #formConta select, #formConta textarea').forEach(input => {
            input.addEventListener('input', function() {
                this.closest('.form-group')?.classList.remove('has-error');
            });
        });
    </script>

    <script src="financeiro.js"></script>
    <script src="public/js/financeiro-user-loader.js?v=20251227"></script>
    
    <!-- Sistema de Notificaçáµes Global -->
    <script src="/js/notifications-manager.js?v=20251227"></script>
    <script src="/js/notification-button.js?v=20251227"></script>
    
    <!-- Sistema de Chat e Suporte -->
    <script src="/js/chat-suporte-widgets.js?v=20260103"></script>
    
    <!-- Sistema de MonitOrçamento de Conexo -->
    <script src="../_shared/connection-monitor.js?v=20251227"></script>
    <script src="/js/popup-confirmacao.js"></script>
    <script src="/js/confirm-modal.js?v=20260110"></script>
    <script src="/js/modal-fix-global.js?v=20260111"></script>
    
    <!-- Sistema de Importação XLSX -->
    <script src="public/js/importar-xlsx.js?v=20260131"></script>
    <script src="public/js/financeiro-shared.js?v=20260217"></script>
    <script src="/js/mobile-auto-enhance.js?v=20260202" defer></script>
    <!-- Chat Widget BOB AI -->
    <script src="/chat/widget.js?v=20260218" defer></script>
    <script src="/_shared/accessibility-widget.js?v=20260226"></script>
</body>
</html>



