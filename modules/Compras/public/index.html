<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#1a1a2e">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Aluforce: Compras</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    
    <!-- Preconnect para recursos externos -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Fonte Inter (Padrão SaaS) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous">
    
    <!-- CSS Compartilhado - Header e Sidebar Padrão -->
    <link rel="stylesheet" href="/modules/_shared/header-sidebar.css?v=20260131">
    
    <!-- CSS SaaS Padrão do Módulo Compras -->
    <link rel="stylesheet" href="../css/compras-saas.css?v=20260131">
    <link rel="stylesheet" href="/css/popup-confirmacao.css">
    
    <!-- CSP Fix -->
    <script src="/js/csp-fix.js" defer></script>
    <!-- Performance: Skeleton Loaders -->
    <link rel="stylesheet" href="/css/skeleton-loader.css">
    <link rel="stylesheet" href="/css/global-header-sidebar.css?v=20260216">
    <script src="/js/tooltips-professional.js?v=20260216"></script>
    
    <style>
        /* Estilos mínimos adicionais para Compras */
        .logo-section {
            display: flex;
            align-items: center;
        }
        
        /* Badges extras */
        .badge-success { background: #d1fae5; color: #065f46; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .badge-info { background: #dbeafe; color: #1e40af; }
        
        /* Botões do módulo */
        .btn-modern {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            font-size: 14px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .btn-compras-primary {
            background: linear-gradient(135deg, var(--compras-primary), var(--compras-secondary));
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }

        .btn-compras-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }
        
        /* Notification badge no header */
        .notification-badge {
            min-width: 18px;
        }
        
        .notification-badge:empty,
        .notification-badge[data-count="0"] {
            display: none;
        }
    </style>
    
    <script src="/js/anti-copy-protection.js"></script>
    <script src="/js/modal-title.js?v=20260210"></script>
    <!-- Chat Widget BOB AI -->
    <link rel="stylesheet" href="/chat/widget.css?v=20260218">
</head>
<body>
    <!-- Container Principal — Padrão ALUFORCE -->
    <div class="app-container">

        <!-- Overlay para Sidebar Mobile -->
        <div class="sidebar-overlay" id="sidebar-overlay" onclick="toggleMobileSidebar()"></div>

        <!-- Sidebar — Padrão ALUFORCE -->
        <aside class="sidebar" id="mobile-sidebar">
            <a href="/dashboard" class="sidebar-logo" title="Voltar ao Painel">
                <i class="fas fa-home"></i>
            </a>

            <nav class="sidebar-nav">
                <button class="sidebar-btn nav-link active" title="Dashboard" data-section="dashboard" onclick="navigateSection('dashboard', this)">
                    <i class="fas fa-chart-line"></i>
                </button>
                <button class="sidebar-btn nav-link" title="Pedidos de Compra" data-section="pedidos" onclick="navigateSection('pedidos', this)">
                    <i class="fas fa-shopping-cart"></i>
                </button>
                <button class="sidebar-btn nav-link" title="Cotações" data-section="cotacoes" onclick="navigateSection('cotacoes', this)">
                    <i class="fas fa-file-invoice-dollar"></i>
                </button>
                <button class="sidebar-btn nav-link" title="Fornecedores" data-section="fornecedores" onclick="navigateSection('fornecedores', this)">
                    <i class="fas fa-truck"></i>
                </button>
                <button class="sidebar-btn nav-link" title="Materiais" data-section="materiais" onclick="navigateSection('materiais', this)">
                    <i class="fas fa-cubes"></i>
                </button>
                <button class="sidebar-btn nav-link" title="Recebimento" data-section="recebimento" onclick="navigateSection('recebimento', this)">
                    <i class="fas fa-truck-loading"></i>
                </button>
                <button class="sidebar-btn nav-link" title="Estoque" data-section="estoque" onclick="navigateSection('estoque', this)">
                    <i class="fas fa-boxes"></i>
                </button>
                <button class="sidebar-btn nav-link" title="Relatórios" data-section="relatorios" onclick="navigateSection('relatorios', this)">
                    <i class="fas fa-chart-bar"></i>
                </button>
            </nav>

            <div class="sidebar-bottom">
                <button class="sidebar-btn" title="Configurações" onclick="window.location.href='/dashboard'">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </aside>

        <!-- Main Area -->
        <main class="main-area">
            <!-- Header — Padrão ALUFORCE -->
            <header class="header">
                <div class="header-left">
                    <button class="mobile-menu-btn" onclick="toggleMobileSidebar()" title="Menu">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="header-brand" style="display:flex;align-items:center;gap:10px;">
                        <img src="/images/Logo Monocromatico - Branco - Aluforce.png" alt="ALUFORCE" style="height:22px;object-fit:contain;">
                        <span style="color:rgba(255,255,255,0.2);font-weight:300;font-size:18px;user-select:none;">|</span>
                        <img src="/images/zyntra-branco.png" alt="Zyntra" style="height:22px;object-fit:contain;">
                        <span style="color:rgba(255,255,255,0.18);font-weight:200;font-size:16px;user-select:none;margin:0 2px;">—</span>
                        <span class="page-title" style="font-size:13px;font-weight:500;color:rgba(255,255,255,0.85);letter-spacing:0.3px;">Compras</span>
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn" title="Atualizar" onclick="location.reload()">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <div class="notification-container">
                        <button class="header-btn notification-btn" title="Notificações" onclick="toggleNotificacoes()">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge" id="notification-count" style="display:none;">0</span>
                        </button>
                        <div class="notification-panel" id="notification-panel">
                            <div class="notification-header">
                                <h3><i class="fas fa-bell"></i> Notificações</h3>
                                <div class="notification-actions">
                                    <button onclick="marcarTodasLidas()" title="Marcar todas como lidas"><i class="fas fa-check-double"></i></button>
                                    <button onclick="limparNotificacoes()" title="Limpar todas"><i class="fas fa-trash-alt"></i></button>
                                </div>
                            </div>
                            <div class="notification-list" id="notification-list">
                                <div class="notification-empty">
                                    <i class="fas fa-check-circle"></i>
                                    <p>Nenhuma notificação</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="user-greeting">
                        <span><span id="greeting-text">Bom dia</span>, <strong id="user-name">Usuário</strong></span>
                        <div class="user-avatar" id="user-avatar">
                            <img src="" alt="Foto do usuário" id="user-photo">
                            <span id="user-initials">U</span>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Área Principal de Conteúdo -->
            <div class="content-area">
        <main class="main-content">

                <!-- Dashboard Section -->
                <div id="dashboard-section" class="content-section active">
                    <div class="dashboard-grid" id="dashboardContainer">
                        <!-- Cards serão inseridos aqui via JavaScript -->
                    </div>
                </div>

                <!-- Pedidos Section -->
                <div id="pedidos-section" class="content-section">
                    <div class="page-header-modern">
                        <h2><i class="fas fa-shopping-cart"></i> Pedidos de Compra</h2>
                        <button class="btn btn-primary" onclick="novoPedido()">
                            <i class="fas fa-plus"></i>
                            Novo Pedido
                        </button>
                    </div>
                    <div id="pedidosContainer"></div>
                </div>

                <!-- Cotações Section -->
                <div id="cotacoes-section" class="content-section">
                    <div class="page-header-modern">
                        <h2><i class="fas fa-file-invoice-dollar"></i> Cotações</h2>
                        <button class="btn btn-primary" onclick="novaCotacao()">
                            <i class="fas fa-plus"></i>
                            Nova Cotação
                        </button>
                    </div>
                    <div id="cotacoesContainer"></div>
                </div>

                <!-- Fornecedores Section -->
                <div id="fornecedores-section" class="content-section">
                    <div class="page-header-modern">
                        <h2><i class="fas fa-truck"></i> Fornecedores</h2>
                        <button class="btn btn-primary" onclick="novoFornecedor()">
                            <i class="fas fa-plus"></i>
                            Novo Fornecedor
                        </button>
                    </div>
                    <div id="fornecedoresContainer"></div>
                </div>

                <!-- Materiais Section -->
                <div id="materiais-section" class="content-section">
                    <div class="page-header-modern">
                        <h2><i class="fas fa-cubes"></i> Materiais</h2>
                        <button class="btn btn-primary" onclick="novoMaterial()">
                            <i class="fas fa-plus"></i>
                            Novo Material
                        </button>
                    </div>
                    <div id="materiaisContainer"></div>
                </div>

                <!-- Recebimento Section -->
                <div id="recebimento-section" class="content-section">
                    <div class="page-header-modern">
                        <h2><i class="fas fa-truck-loading"></i> Recebimento</h2>
                        <button class="btn btn-primary" onclick="novoRecebimento()">
                            <i class="fas fa-plus"></i>
                            Registrar Recebimento
                        </button>
                    </div>
                    <div id="recebimentoContainer"></div>
                </div>

                <!-- Estoque Section -->
                <div id="estoque-section" class="content-section">
                    <div class="page-header-modern">
                        <h2><i class="fas fa-boxes"></i> Estoque</h2>
                    </div>
                    <div id="estoqueContainer"></div>
                </div>

                <!-- Relatórios Section -->
                <div id="relatorios-section" class="content-section">
                    <div class="page-header-modern">
                        <h2><i class="fas fa-chart-bar"></i> Relatórios</h2>
                    </div>
                    <div id="relatoriosContainer"></div>
                </div>
            </main>
            </div><!-- /.content-area -->
        </main><!-- /.main-area -->
    </div><!-- /.app-container -->

    <!-- Auth Check -->
    <script src="/js/auth-unified.js"></script>
    <script src="../../modules/PCP/auth-check-pcp.js"></script>
    
    <!-- Scripts do Módulo -->
    <script src="js/compras-main.js"></script>
    <script src="js/dashboard-compras-novo.js"></script>
    <script src="js/pedidos-compras-novo.js"></script>
    <script src="js/cotacoes-compras-novo.js"></script>
    <script src="js/fornecedores-compras-novo.js"></script>
    <script src="js/materiais-compras-novo.js"></script>
    <script src="js/recebimento-compras-novo.js"></script>
    <script src="js/estoque-compras-novo.js"></script>
    <script src="js/relatorios-compras-novo.js"></script>
    
    <script>
        // =============================================
        // SISTEMA DE NAVEGAÇÃO E UI - LAYOUT PADRÃO ALUFORCE
        // =============================================
        
        // Títulos das seções para breadcrumb
        const sectionTitles = {
            'dashboard': 'Dashboard',
            'pedidos': 'Pedidos de Compra',
            'cotacoes': 'Cotações',
            'fornecedores': 'Fornecedores',
            'materiais': 'Materiais',
            'recebimento': 'Recebimento',
            'estoque': 'Estoque',
            'relatorios': 'Relatórios'
        };
        
        // Carregar dados do usuário no header — Padrão ALUFORCE
        function carregarDadosUsuario() {
            try {
                const userData = localStorage.getItem('userData');
                if (!userData) return;
                
                const user = JSON.parse(userData);
                const nome = (user.nome || user.nome_completo || 'Usuário').trim();
                const partes = nome.split(/\s+/);
                const primeiroNome = partes.length > 1 ? partes[0] + ' ' + partes[partes.length - 1] : partes[0];
                
                // Atualizar saudação baseada na hora
                const hora = new Date().getHours();
                const saudacao = hora < 12 ? 'Bom dia' : hora < 18 ? 'Boa tarde' : 'Boa noite';
                const greetingEl = document.getElementById('greeting-text');
                if (greetingEl) greetingEl.textContent = saudacao;

                // Atualizar nome do usuário
                const userNameEl = document.getElementById('user-name');
                if (userNameEl) userNameEl.textContent = primeiroNome;
                
                // Atualizar avatar e iniciais
                const userPhoto = document.getElementById('user-photo');
                const userInitials = document.getElementById('user-initials');
                if (userPhoto) {
                    const avatarPath = `/avatars/${primeiroNome}.webp`;
                    const img = new Image();
                    img.onload = function() {
                        userPhoto.src = avatarPath;
                        userPhoto.style.display = 'block';
                        if (userInitials) userInitials.style.display = 'none';
                    };
                    img.onerror = function() {
                        userPhoto.style.display = 'none';
                        if (userInitials) {
                            userInitials.textContent = primeiroNome.charAt(0).toUpperCase();
                            userInitials.style.display = 'flex';
                        }
                    };
                    img.src = avatarPath;
                }
            } catch (error) {
                console.error('Erro ao carregar dados do usuário:', error);
            }
        }

        // Navegação entre seções — Padrão ALUFORCE (sidebar-btn + data-section)
        function navigateSection(sectionId, btn) {
            const navItems = document.querySelectorAll('.sidebar-btn.nav-link[data-section]');
            const sections = document.querySelectorAll('.content-section');
            
            // Remove active de todos
            navItems.forEach(nav => nav.classList.remove('active'));
            sections.forEach(sec => sec.classList.remove('active'));
            
            // Ativa o clicado
            if (btn) btn.classList.add('active');
            
            // Mostra seção
            const section = document.getElementById(`${sectionId}-section`);
            if (section) section.classList.add('active');
            
            // Fecha sidebar mobile
            closeMobileSidebar();
        }

        function setupNavigation() {
            // Navegação já via onclick nos botões, mas adicionar fallback
            const navItems = document.querySelectorAll('.sidebar-btn.nav-link[data-section]');
            navItems.forEach(item => {
                if (!item.getAttribute('onclick')) {
                    item.addEventListener('click', () => {
                        navigateSection(item.getAttribute('data-section'), item);
                    });
                }
            });
        }

        // Toggle Mobile Sidebar — Padrão ALUFORCE
        function toggleMobileSidebar() {
            const sidebar = document.getElementById('mobile-sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (sidebar) sidebar.classList.toggle('open');
            if (overlay) overlay.classList.toggle('active');
        }

        function closeMobileSidebar() {
            const sidebar = document.getElementById('mobile-sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            if (sidebar) sidebar.classList.remove('open');
            if (overlay) overlay.classList.remove('active');
        }

        // Notificações — Padrão ALUFORCE
        function toggleNotificacoes() {
            const panel = document.getElementById('notification-panel');
            if (panel) panel.classList.toggle('open');
        }
        function marcarTodasLidas() {
            const badge = document.getElementById('notification-count');
            if (badge) { badge.textContent = '0'; badge.style.display = 'none'; }
        }
        function limparNotificacoes() {
            const list = document.getElementById('notification-list');
            if (list) list.innerHTML = '<div class="notification-empty"><i class="fas fa-check-circle"></i><p>Nenhuma notificação</p></div>';
            marcarTodasLidas();
        }

        // Inicializar tudo quando DOM estiver pronto
        document.addEventListener('DOMContentLoaded', () => {
            carregarDadosUsuario();
            setupNavigation();
            
            // Fechar notificações ao clicar fora
            document.addEventListener('click', (e) => {
                const panel = document.getElementById('notification-panel');
                const btn = document.querySelector('.notification-btn');
                if (panel && panel.classList.contains('open') && !panel.contains(e.target) && btn && !btn.contains(e.target)) {
                    panel.classList.remove('open');
                }
            });
        });
    </script>
    
    <!-- Sistema de Notificações Global -->
    <script src="/js/notification-manager.js?v=20260129"></script>
    
    <!-- Serviço de Dados da Empresa para Impressões -->
    <script src="/js/empresa-service.js?v=20260120"></script>
    
    <!-- Chat Widget BOB AI -->
    <script src="/chat/widget.js?v=20260218" defer></script>
    <script src="/js/popup-confirmacao.js"></script>
    <script src="/js/mobile-auto-enhance.js?v=20260202" defer></script>
    <!-- Performance Utilities -->
    <script src="/js/performance-utils.js" defer></script>
    <script src="/js/user-dropdown.js?v=20260223" defer></script>

    <!-- Sidebar Click Animation -->
    <script src="/js/sidebar-click-animation.js?v=20260224"></script>
    <script src="/_shared/accessibility-widget.js?v=20260226"></script>
</body>
</html>